---
title: 9. Conflit & merge
layout: home
nav_order: 9
parent: 4.1. Git & GitFlow
permalink: /git-gitflow/conflit-merge/
code: 4.1.9
competence: C4
autoformation: "C4.1"
ua: "4.1.U3"
duree_h: 2
objectif: "Résoudre un conflit localement, finaliser la PR en squash et taguer si nécessaire puis back-merger."
notions_nouvelles: ["Conflit Git", "Mergetool", "Squash merge", "Tag (SemVer)", "Back-merge"]
fil_rouge: "Gestion propre des conflits sur fonctionnalités Blog/API"
livrable_chapitre: "Cas de conflit résolu (marqueurs supprimés), push `--force-with-lease`, PR mergée, tag/release (optionnel)"
alimentation_prototype: "Intégrations sans marqueurs résiduels ni régressions N2"
alimentation_miniprojet: "Politique de résolution + release/retour vers develop maîtrisée N3"
---


# 📘 4.1.9 - Conflit simple & merge

## 📒 Glossaire minute
- **Conflit Git** : deux commits modifient la **même portion** d’un fichier.
- **Rebase** : réapplique tes commits au-dessus d’une base à jour (historique linéaire).
- **Squash merge** : fusionne une PR en **un seul commit** (historique propre).
- **Tag** : pointeur immuable sur un commit (ex. `v1.2.0`, utile pour releases).

---

## ✅ Objectif
Savoir **résoudre un conflit localement** (rebase/merge), **finaliser une PR** en *squash merge*, puis **taguer** une release (optionnel) et **back-merger** vers `develop`.

---

## 🔧 Pré-requis
- Avoir lu : 4.1.4 (stratégie branches), 4.1.6 (sync propre), 4.1.7 (ouvrir PR).
- `git` configuré, CI verte sur la PR avant le merge.

---

## 1) Détecter & préparer la résolution

```bash
# Mettre à jour la base
git fetch origin
git checkout feature/321-recherche-filtrage
git rebase origin/develop      # ou: git merge origin/develop
# => Conflit détecté (si affiché)
````

> Si le conflit vient d’une PR, **évite** le bouton “Resolve conflicts” sur la plateforme pour les cas non triviaux : **résous en local** → push.

---

## 2) Résoudre un conflit **dans un fichier**

Git insère des **marqueurs** :

```text
<<<<<<< HEAD
// Ta version locale
=======
/* Version distante (origin/develop) */
>>>>>>> origin/develop
```

### Étapes

1. **Ouvrir** le fichier en conflit.
2. **Choisir/fusionner** le contenu attendu (garder une seule version).
3. **Enregistrer** puis marquer comme résolu :

   ```bash
   git add path/to/file
   ```
4. **Continuer** l’opération :

   * Si rebase : `git rebase --continue`
   * Si merge : `git commit` (un commit de merge sera créé)

### Outil d’aide (facultatif)

```bash
git mergetool
# configured tool launches (ex: vscode, meld, kdiff3)
```

---

## 3) Conflit fréquent (exemples & fixes)

### 3.1. `composer.json` / `package.json` (versions & scripts)

* Fusionner **scripts** (ne pas écraser).
* Conserver les **versions** les plus récentes compatibles.
* Re-générer le lock si nécessaire :

  ```bash
  composer update --lock
  npm install
  ```

### 3.2. Vues Blade / JS (duplication de logique)

* Extraire les **conditions** communes.
* Factoriser en **partial**/composant si le diff est important.

### 3.3. Migrations Laravel

* **Ne pas** réécrire une migration existante déjà mergée.
* Créer une **nouvelle** migration complémentaire si besoin.
* Vérifier `migrate:fresh --seed` en local.

---

## 4) Finaliser : push propre vers la PR

```bash
# Après rebase réussi
git push --force-with-lease
# (sécurisé : refuse si quelqu’un d’autre a poussé entre-temps)
```

> La CI se relance. Si **verte**, la PR peut être mergée.

---

## 5) Choisir le type de merge (PR)

* **Par défaut : `Squash merge`** ✅
  Avantages : historique **propre** (1 commit/PR), reverts plus simples.
* **Merge commit** : à éviter pour les features (bruit).
* **Rebase & merge** : uniquement si l’équipe le maîtrise (cohérence stricte).

---

## 6) Tag & Release (optionnel mais recommandé)

### Quand taguer ?

* Après merge d’une **release branch** (`release/x.y.z`) vers `main`.
* Après un **hotfix** mergé sur `main`.

### Comment ?

```bash
git checkout main
git pull
git tag v1.2.0 -m "Release 1.2.0: Recherche + filtres tag/sort"
git push origin v1.2.0
```

> Pense à publier une **Release** (notes, changelog) sur la plateforme.

---

## 7) Back-merge (garder `develop` aligné)

Après **release** ou **hotfix** :

```bash
git checkout develop
git pull
git merge --no-ff main
git push
```

> Le *merge no-ff* garde la **trace** du retour de prod → dev.

---

## 🧪 Vérifier localement (avant/après merge)

```bash
# Tests unitaires/HTTP
composer test

# Lint/format
composer lint:php
npm run lint:js

# Build (si pertinent)
npm run build
```

---

## 🧰 Conseils pratiques

* Commits **petits & fréquents** → conflits plus simples.
* Rebase **régulier** sur `origin/develop` (voir 4.1.6).
* Éviter de **refactorer massivement** dans la même PR que la feature.
* Documenter dans la PR les **décisions de résolution** (pour reviewers).

---

## 📦 Livrables attendus

* Conflits **résolus localement**, push avec `--force-with-lease`.
* PR mergée en **squash**.
* (Optionnel) **Tag** SemVer poussé (`vX.Y.Z`) + **Release notes**.
* Back-merge **main → develop** effectué après release/hotfix.

---

## ✅ DoD — Definition of Done

* [ ] Aucun **marqueur de conflit** restant dans le code.
* [ ] **CI verte** après résolution & push.
* [ ] Merge PR en **squash** ; branche supprimée.
* [ ] (Release) **Tag** créé & notes publiées.
* [ ] **Back-merge** réalisé (develop à jour).

---

## 🩹 Erreurs fréquentes & correctifs

* ❌ Résolution via plateforme avec gros conflits → **faire en local**.
* ❌ `git push --force` brut → préférer `--force-with-lease`.
* ❌ Oublier le back-merge après release/hotfix → **aligner develop**.
* ❌ Modifier une migration déjà déployée → **nouvelle** migration.
* ❌ Lock files ignorés → regénérer & committer (`composer.lock`, `package-lock.json`).

---

## ⚡ Cheatsheet

```bash
# Rebase + résolution
git fetch origin
git rebase origin/develop
# ... résoudre fichiers ...
git add .
git rebase --continue
git push --force-with-lease

# Merge PR en squash (via CLI GitHub)
gh pr merge --squash

# Tag release
git checkout main && git pull
git tag v1.2.0 -m "Release 1.2.0"
git push origin v1.2.0

# Back-merge
git checkout develop && git pull
git merge --no-ff main && git push
```

