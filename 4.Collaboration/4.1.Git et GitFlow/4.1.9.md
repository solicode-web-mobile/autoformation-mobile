---
title: 9. Conflit & merge
layout: home
nav_order: 9
parent: 4.1. Git & GitFlow
permalink: /git-gitflow/conflit-merge/
code: 4.1.9
competence: C4
autoformation: "C4.1"
ua: "4.1.U3"
duree_h: 2
objectif: "RÃ©soudre un conflit localement, finaliser la PR en squash et taguer si nÃ©cessaire puis back-merger."
notions_nouvelles: ["Conflit Git", "Mergetool", "Squash merge", "Tag (SemVer)", "Back-merge"]
fil_rouge: "Gestion propre des conflits sur fonctionnalitÃ©s Blog/API"
livrable_chapitre: "Cas de conflit rÃ©solu (marqueurs supprimÃ©s), push `--force-with-lease`, PR mergÃ©e, tag/release (optionnel)"
alimentation_prototype: "IntÃ©grations sans marqueurs rÃ©siduels ni rÃ©gressions N2"
alimentation_miniprojet: "Politique de rÃ©solution + release/retour vers develop maÃ®trisÃ©e N3"
---


# ğŸ“˜ 4.1.9 - Conflit simple & merge

## ğŸ“’ Glossaire minute
- **Conflit Git** : deux commits modifient la **mÃªme portion** dâ€™un fichier.
- **Rebase** : rÃ©applique tes commits au-dessus dâ€™une base Ã  jour (historique linÃ©aire).
- **Squash merge** : fusionne une PR en **un seul commit** (historique propre).
- **Tag** : pointeur immuable sur un commit (ex. `v1.2.0`, utile pour releases).

---

## âœ… Objectif
Savoir **rÃ©soudre un conflit localement** (rebase/merge), **finaliser une PR** en *squash merge*, puis **taguer** une release (optionnel) et **back-merger** vers `develop`.

---

## ğŸ”§ PrÃ©-requis
- Avoir lu : 4.1.4 (stratÃ©gie branches), 4.1.6 (sync propre), 4.1.7 (ouvrir PR).
- `git` configurÃ©, CI verte sur la PR avant le merge.

---

## 1) DÃ©tecter & prÃ©parer la rÃ©solution

```bash
# Mettre Ã  jour la base
git fetch origin
git checkout feature/321-recherche-filtrage
git rebase origin/develop      # ou: git merge origin/develop
# => Conflit dÃ©tectÃ© (si affichÃ©)
````

> Si le conflit vient dâ€™une PR, **Ã©vite** le bouton â€œResolve conflictsâ€ sur la plateforme pour les cas non triviaux : **rÃ©sous en local** â†’ push.

---

## 2) RÃ©soudre un conflit **dans un fichier**

Git insÃ¨re des **marqueurs** :

```text
<<<<<<< HEAD
// Ta version locale
=======
/* Version distante (origin/develop) */
>>>>>>> origin/develop
```

### Ã‰tapes

1. **Ouvrir** le fichier en conflit.
2. **Choisir/fusionner** le contenu attendu (garder une seule version).
3. **Enregistrer** puis marquer comme rÃ©solu :

   ```bash
   git add path/to/file
   ```
4. **Continuer** lâ€™opÃ©ration :

   * Si rebase : `git rebase --continue`
   * Si merge : `git commit` (un commit de merge sera crÃ©Ã©)

### Outil dâ€™aide (facultatif)

```bash
git mergetool
# configured tool launches (ex: vscode, meld, kdiff3)
```

---

## 3) Conflit frÃ©quent (exemples & fixes)

### 3.1. `composer.json` / `package.json` (versions & scripts)

* Fusionner **scripts** (ne pas Ã©craser).
* Conserver les **versions** les plus rÃ©centes compatibles.
* Re-gÃ©nÃ©rer le lock si nÃ©cessaire :

  ```bash
  composer update --lock
  npm install
  ```

### 3.2. Vues Blade / JS (duplication de logique)

* Extraire les **conditions** communes.
* Factoriser en **partial**/composant si le diff est important.

### 3.3. Migrations Laravel

* **Ne pas** rÃ©Ã©crire une migration existante dÃ©jÃ  mergÃ©e.
* CrÃ©er une **nouvelle** migration complÃ©mentaire si besoin.
* VÃ©rifier `migrate:fresh --seed` en local.

---

## 4) Finaliser : push propre vers la PR

```bash
# AprÃ¨s rebase rÃ©ussi
git push --force-with-lease
# (sÃ©curisÃ© : refuse si quelquâ€™un dâ€™autre a poussÃ© entre-temps)
```

> La CI se relance. Si **verte**, la PR peut Ãªtre mergÃ©e.

---

## 5) Choisir le type de merge (PR)

* **Par dÃ©faut : `Squash merge`** âœ…
  Avantages : historique **propre** (1 commit/PR), reverts plus simples.
* **Merge commit** : Ã  Ã©viter pour les features (bruit).
* **Rebase & merge** : uniquement si lâ€™Ã©quipe le maÃ®trise (cohÃ©rence stricte).

---

## 6) Tag & Release (optionnel mais recommandÃ©)

### Quand taguer ?

* AprÃ¨s merge dâ€™une **release branch** (`release/x.y.z`) vers `main`.
* AprÃ¨s un **hotfix** mergÃ© sur `main`.

### Comment ?

```bash
git checkout main
git pull
git tag v1.2.0 -m "Release 1.2.0: Recherche + filtres tag/sort"
git push origin v1.2.0
```

> Pense Ã  publier une **Release** (notes, changelog) sur la plateforme.

---

## 7) Back-merge (garder `develop` alignÃ©)

AprÃ¨s **release** ou **hotfix** :

```bash
git checkout develop
git pull
git merge --no-ff main
git push
```

> Le *merge no-ff* garde la **trace** du retour de prod â†’ dev.

---

## ğŸ§ª VÃ©rifier localement (avant/aprÃ¨s merge)

```bash
# Tests unitaires/HTTP
composer test

# Lint/format
composer lint:php
npm run lint:js

# Build (si pertinent)
npm run build
```

---

## ğŸ§° Conseils pratiques

* Commits **petits & frÃ©quents** â†’ conflits plus simples.
* Rebase **rÃ©gulier** sur `origin/develop` (voir 4.1.6).
* Ã‰viter de **refactorer massivement** dans la mÃªme PR que la feature.
* Documenter dans la PR les **dÃ©cisions de rÃ©solution** (pour reviewers).

---

## ğŸ“¦ Livrables attendus

* Conflits **rÃ©solus localement**, push avec `--force-with-lease`.
* PR mergÃ©e en **squash**.
* (Optionnel) **Tag** SemVer poussÃ© (`vX.Y.Z`) + **Release notes**.
* Back-merge **main â†’ develop** effectuÃ© aprÃ¨s release/hotfix.

---

## âœ… DoD â€” Definition of Done

* [ ] Aucun **marqueur de conflit** restant dans le code.
* [ ] **CI verte** aprÃ¨s rÃ©solution & push.
* [ ] Merge PR en **squash** ; branche supprimÃ©e.
* [ ] (Release) **Tag** crÃ©Ã© & notes publiÃ©es.
* [ ] **Back-merge** rÃ©alisÃ© (develop Ã  jour).

---

## ğŸ©¹ Erreurs frÃ©quentes & correctifs

* âŒ RÃ©solution via plateforme avec gros conflits â†’ **faire en local**.
* âŒ `git push --force` brut â†’ prÃ©fÃ©rer `--force-with-lease`.
* âŒ Oublier le back-merge aprÃ¨s release/hotfix â†’ **aligner develop**.
* âŒ Modifier une migration dÃ©jÃ  dÃ©ployÃ©e â†’ **nouvelle** migration.
* âŒ Lock files ignorÃ©s â†’ regÃ©nÃ©rer & committer (`composer.lock`, `package-lock.json`).

---

## âš¡ Cheatsheet

```bash
# Rebase + rÃ©solution
git fetch origin
git rebase origin/develop
# ... rÃ©soudre fichiers ...
git add .
git rebase --continue
git push --force-with-lease

# Merge PR en squash (via CLI GitHub)
gh pr merge --squash

# Tag release
git checkout main && git pull
git tag v1.2.0 -m "Release 1.2.0"
git push origin v1.2.0

# Back-merge
git checkout develop && git pull
git merge --no-ff main && git push
```

