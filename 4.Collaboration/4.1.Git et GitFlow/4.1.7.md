---
title: 7. Ouvrir une PR 
permalink: /git-gitflow/ouvrir-pr/
layout: home
nav_order: 7
parent: 4.1. Git & GitFlow
---

# 📘 4.1.7 - Ouvrir une PR 

## 📒 Glossaire minute
- **PR/MR** : demande de fusion pour relire et intégrer du code.
- **Draft PR** : PR brouillon, non prête à merger (collecte de feedback).
- **Owner/Reviewer** : auteur / relecteur(s) de la PR.
- **Checks** : validations CI (lint, tests) obligatoires avant merge.

---

## ✅ Objectif
Créer une **PR claire, testée et vérifiable** : description concise, **captures**, **checklist** cochée, **issue liée** (`Closes #ID`) et **CI verte** pour permettre un **squash merge** sans risque.

---

## 🔧 Pré-requis
- Stratégie de branches (voir **4.1.4**).
- Conventions commits/lint/format (voir **4.1.2**).
- Scripts & setup projet OK (voir **4.1.3**).
- Sync propre via rebase avant PR (voir **4.1.6**).

---

## 1) Avant d’ouvrir la PR (auto-revue rapide)
- [ ] Rebase sur `origin/develop` et push avec `--force-with-lease`.  
- [ ] Lancer les tests **en local** : `composer test`.  
- [ ] Lint/format : `composer lint:php`, `npm run lint:js`.  
- [ ] Vérifier la taille de la PR (viser petit : **≤ 300 lignes** modifiées, **≤ 5–7 fichiers**).  
- [ ] Mettre à jour **README/Docs/Migrations** si nécessaire.

---

## 2) Titre & description de la PR

**Titre (pattern recommandé)**
```

feat(scope): courte phrase impact utilisateur (Closes #321)

```

**Exemples**
```

feat(search): filtres q/tag/sort (Closes #321)
fix(auth): empêcher brute force login (Closes #512)
docs(readme): procédure setup Docker

````

**Description (sections minimales)**
```md
## Objet
[Quoi / Pourquoi] — valeur livrée, contexte court.

## Issue liée
Closes #321

## Captures / Démo
Avant/Après, GIF court (si UI)

## Notes techniques
Migrations, services, endpoints, perf, breaking changes éventuels.

## Tests
Cas couverts (unitaires/HTTP/e2e) + commandes.

## Checklist
- [ ] Lint/format OK (PHP/JS)
- [ ] Tests passent en local + CI verte
- [ ] Docs/README mis à jour si besoin
- [ ] Pas de secret dans le code / logs
````

---

## 3) Captures & démo (si UI)

* Inclure **2–3 captures** maximum (Avant/Après).
* GIF ≤ 10s pour une interaction clé.
* Si API : coller **exemples de requêtes/réponses** (curl ou Postman export mini).

---

## 4) Lier l’issue (fermeture auto)

* Fermer automatiquement : `Closes #321` (dans **la PR**).
* Référencer sans fermer : `Refs #654`.
* Plusieurs issues : `Closes #1, Closes #2`.

---

## 5) Review : attentes & réponses

* Demander **1+ reviewer**.
* Répondre point par point, pousser des **commits ciblés**.
* Préférer les **suggestions de code** quand c’est trivial.
* Si la PR devient trop grosse → **scinder**.

---

## 6) Labels, milestones, protection

* Labeliser : `feature`, `bug`, `docs`, `hotfix`, `breaking`.
* Milestone : associer à la **release** en cours.
* Branches `main/develop` **protégées** : PR obligatoire + CI verte.

---

## 7) CI & checks attendus

* **Obligatoires** : lint PHP/JS, tests (Pest/PHPUnit, HTTP).
* Optionnels : coverage snapshot, build preview.
* Relancer un job flaky : “Re-run jobs” (éviter de merger CI rouge).

---

## 8) Merge & nettoyage

* Politique par défaut : **Squash merge**.
* Supprimer la branche **après merge**.
* Release/Hotfix : tag sur `main` + **back-merge** vers `develop`.

---

## 9) Modèle de PR (fichier recommandé)

Créer `.github/pull_request_template.md` :

```md
## Objet
[Quoi / Pourquoi — impact utilisateur]

## Issue liée
Closes #ID

## Captures / Démo
[Avant/Après, GIF ≤10s]

## Notes techniques
[Migrations / endpoints / perfs / risques / breaking]

## Tests
- [ ] Unitaires
- [ ] HTTP/Feature
- [ ] e2e (si pertinent)

## Checklist
- [ ] Lint/format OK (PHP/JS)
- [ ] CI verte
- [ ] Docs/README à jour si besoin
- [ ] Pas de secrets / credentials
- [ ] Migration réversible (up/down)
```

---

## 📦 Livrables attendus

* PR avec **titre** conventionnel + **description** structurée.
* **Captures/Démo** quand l’UI change.
* **Checklist** cochée, **issue liée**.
* **CI verte**, prête pour **squash merge**.

---

## ✅ DoD — Definition of Done

* [ ] `Closes #ID` présent dans le **titre** ou la **description**.
* [ ] PR **petite**, **focus**, CI **verte**.
* [ ] Captures/Exemples fournis si UI/API.
* [ ] Squash merge effectué + branche supprimée.

---

## 🩹 Erreurs fréquentes & correctifs

* ❌ PR trop large → découper en **plusieurs PR**.
* ❌ Pas de lien issue → ajouter `Closes #ID`.
* ❌ CI rouge → corriger localement, push, **re-run**.
* ❌ Manque de contexte → compléter **Objet** + **Notes techniques**.
* ❌ Migrations non réversibles → ajouter `down()` correct.

---

## ⚡ Cheatsheet (GitHub CLI)

```bash
# Créer une PR depuis la branche courante vers develop
gh pr create --base develop \
  --title "feat(search): filtres q/tag/sort (Closes #321)" \
  --body-file .github/PR_BODY.md \
  --label feature

# Marquer en draft / prêt pour review
gh pr ready --undo   # repasse en Draft
gh pr ready         # passe en Ready for review

# Assigner reviewers
gh pr edit --add-reviewer username1 --add-reviewer username2

# Merger en squash (CI verte requise)
gh pr merge --squash
```
