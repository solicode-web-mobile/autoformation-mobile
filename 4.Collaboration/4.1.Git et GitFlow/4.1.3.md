---
title: 3. Scripts & setup
layout: home
nav_order: 3
parent: 4.1. Git & GitFlow
permalink: /git-gitflow/scripts-setup/
code: 4.1.3
competence: C4
autoformation: "C4.1"
ua: "4.1.U1"
duree_h: 2
objectif: "Standardiser les scripts Composer/NPM et documenter un démarrage rapide reproductible."
notions_nouvelles: ["Scripts Composer", "Scripts NPM", ".env.testing", "Docker compose (MySQL)", "Makefile"]
fil_rouge: "Lancer Blog Laravel + Vite en 1 commande, tests prêts"
livrable_chapitre: "composer.json et package.json (dev/build/test), README démarrage, .env.testing, docker-compose.yml"
alimentation_prototype: "Pipeline dev/build/test opérationnel pour N2"
alimentation_miniprojet: "Onboarding accéléré et procédures identiques pour toute l’équipe N3"
---

# 📘 4.1.3 - Scripts & setup 

## 📒 Glossaire minute
- **Setup** : étapes pour rendre le projet **exécutable** en local.
- **Dev** : lancement du serveur applicatif + bundler front.
- **Build** : génération des **assets** de production.
- **Test** : exécution automatisée des **tests** (unitaire/intégration).

---

## ✅ Objectif
Standardiser les **scripts Composer/NPM** et livrer une **documentation d’installation** claire pour que *tout nouvel arrivant* puisse cloner, installer, lancer, tester et builder le projet **sans aide**.

---

## 🔧 Pré-requis
- PHP 8.2+, Composer  
- Node.js 18/20+, NPM  
- MySQL 8.x (ou Docker)  
- Git installé

---

## 1) Scripts Composer (backend Laravel)

> Ajoute/complète ces scripts dans `composer.json`.

```json
{
  "scripts": {
    "post-autoload-dump": [
      "@php artisan package:discover --ansi"
    ],
    "app:key": "php artisan key:generate",
    "migrate": "php artisan migrate --force",
    "seed": "php artisan db:seed --force",
    "refresh": "php artisan migrate:fresh --seed",
    "serve": "php artisan serve",
    "test": "php artisan test --env=testing --colors=always",
    "lint:php": "vendor/bin/pint --test",
    "format:php": "vendor/bin/pint"
  }
}
````

---

## 2) Scripts NPM (frontend/outillage)

> Ajoute/complète ces scripts dans `package.json`.
> *On utilise `concurrently` pour démarrer PHP + Vite en parallèle.*

```bash
npm i -D concurrently
```

```json
{
  "scripts": {
    "dev": "concurrently \"php artisan serve\" \"vite\"",
    "build": "vite build",
    "preview": "vite preview",
    "lint:js": "eslint . --ext .js,.ts --ignore-path .gitignore",
    "format:js": "prettier --write \"**/*.{js,ts,json,md,yml,yaml}\"",
    "lint": "npm run lint:js && composer lint:php",
    "format": "npm run format:js && composer format:php",
    "test": "composer test"
  }
}
```

---

## 3) Fichiers d’environnement (dev & test)

### `.env.example` (extrait utile)

```dotenv
APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=my_project
DB_USERNAME=root
DB_PASSWORD=
```

### `.env.testing` (isole la base de test)

```dotenv
APP_ENV=testing
APP_DEBUG=true

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=my_project_test
DB_USERNAME=root
DB_PASSWORD=
```

> Pense à **créer** `my_project_test` dans MySQL (ou utiliser Docker).

---

## 4) Docker (optionnel, pour MySQL local rapide)

`docker-compose.yml` minimal :

```yml
version: "3.9"
services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: my_project
      MYSQL_USER: laravel
      MYSQL_PASSWORD: laravel
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    command: --default-authentication-plugin=mysql_native_password
volumes:
  mysql_data:
```

---

## 5) README — Doc d’installation (modèle)

> Ajoute cette section dans `README.md`.

````md
## 🚀 Démarrage rapide

```bash
git clone <repo-url> && cd <repo-folder>

cp .env.example .env
composer install
php artisan key:generate

# Base de données
php artisan migrate --seed

# Lancer en dev (PHP + Vite en parallèle)
npm ci
npm run dev
````

## 🧪 Tests

```bash
# Base test (si nécessaire)
# créer la DB my_project_test dans MySQL

# Lancer les tests
composer test
# ou en parallèle (si activé)
# php artisan test --parallel
```

## 🏗️ Build de production

```bash
npm run build
# puis déployer / configurer serveur web + APP_ENV=production
```

````

---

## 6) Makefile (optionnel)

> Simplifie les commandes courantes (macOS/Linux).

```Makefile
.PHONY: setup dev build test fresh

setup:
\tcp -n .env.example .env || true
\tcomposer install
\tphp artisan key:generate
\tnpm ci

dev:
\tnpm run dev

build:
\tnpm run build

test:
\tcomposer test

fresh:
\tphp artisan migrate:fresh --seed
````

---

## 📦 Livrables attendus

* Scripts **Composer/NPM** fonctionnels (`dev`, `build`, `test`, `lint`, `format`)
* `.env.example` & `.env.testing` complets
* Section **README – Démarrage rapide / Tests / Build**
* (Optionnel) `docker-compose.yml` MySQL et `Makefile`

---

## ✅ DoD — Definition of Done

* [ ] `npm run dev` démarre **Vite + PHP** en local
* [ ] `npm run build` produit des assets en `public/build`
* [ ] `composer test` s’exécute avec une DB **isolée** (`.env.testing`)
* [ ] Un nouveau membre lance le projet **sans aide** via le README

---

## 🩹 Erreurs fréquentes & correctifs

* ❌ Clé APP manquante → `php artisan key:generate`
* ❌ Mélange DB dev/test → configurer **`.env.testing`** dédié
* ❌ Vite non lancé → utiliser `npm run dev` (ou `concurrently`)
* ❌ Permissions `storage/` → `php artisan storage:link` + droits d’écriture

---

## ⚡ Cheatsheet

```bash
# Setup complet
cp .env.example .env && composer install && php artisan key:generate && npm ci

# DB dev
php artisan migrate --seed

# Dev (PHP + Vite)
npm run dev

# Tests
composer test

# Build prod
npm run build
```

