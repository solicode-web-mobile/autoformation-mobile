---
title: 8. Revue de code
permalink: /git-gitflow/revue-code/
layout: home
nav_order: 8
parent: 4.1. Git & GitFlow
---

# 📘 4.1.8 - Revue de code

## 📒 Glossaire minute
- **Reviewer** : personne qui relit la PR, vérifie forme/fond, approuve ou demande des changements.
- **Blocking / Non-blocking** : remarque **bloquante** (à corriger avant merge) vs **suggestion** (amélioration).
- **Suggestion GitHub** : bloc de code proposé que l’auteur peut **appliquer en 1 clic**.
- **DoD (Definition of Done)** : critères pour considérer la PR prête au **merge**.

---

## ✅ Objectif
Conduire des **revues rapides, utiles et respectueuses** : des **commentaires factuels**, des **suggestions appliquables**, et un **process DoD** clair pour décider *Approve / Request changes / Comment*.

---

## 🔧 Pré-requis
- PR **petite** et **focus** (≤ 300 lignes modifiées, ≤ 5–7 fichiers).
- **CI verte** (lint/tests) & description PR complète (captures/notes techniques).
- PR **rebasée** sur `origin/develop` (voir 4.1.6).

---

## 👥 Rôles & responsabilités

**Auteur**
- Prépare une PR **lisible** (template rempli, captures, tests).
- Répond à **chaque fil** de commentaires, pousse des commits ciblés.
- Convertit en **Ready for review** quand c’est stable.

**Reviewer**
- Lit le **contexte** (issue, objectifs, scope).
- Vérifie **impact** (fonctionnel, sécurité, perfs, lisibilité, testabilité).
- Laisse des **commentaires factuels**, propose des **suggestions**,
  décide **Approve / Request changes / Comment**.

---

## 🧭 Process de review (pas à pas)

1) **Lire la PR** : description, issue liée, captures, fichiers modifiés.  
2) **Parcourir par couches** :  
   - Public API / Contrats / Schéma DB,  
   - Flux métier / contrôleurs / services,  
   - Implémentation / vues / assets,  
   - Tests & docs.  
3) **Commenter** : commencer par **non-blocking**, marquer **blocking** quand nécessaire.  
4) **Valider** :  
   - **Approve** si OK,  
   - **Request changes** si corrections indispensables,  
   - **Comment** pour feedback non bloquant.  
5) **Boucle** : l’auteur pousse, vous relisez uniquement les **diffs nouveaux**.

---

## 🧱 Catégories de vérification

- **Fonctionnel** : la PR respecte l’issue & critères GWT ? cas limites ?  
- **Sécurité** : autorisations, validation d’entrées, exposition de données, CSRF.  
- **Perfs** : N+1, indexes, tailles de réponses, caches.  
- **Lisibilité** : noms clairs, duplication, fonctions trop longues, dead code.  
- **Tests** : cas heureux + erreurs, DB isolée (`.env.testing`), assertions utiles.  
- **DX** : logs, messages d’erreur, doc/README mis à jour.  

---

## 💬 Commentaires factuels (exemples)

**✅ Bien**
> *Factuel + pourquoi + action claire*  
> « `ArticleController@index` déclenche 3 requêtes N+1 (tags, author, comments).  
> Proposer `with(['tags','author','comments'])` ou un `Resource` pour paginer les relations. » *(Blocking)*

**⚠️ À éviter**
> « Pas clair. » / « Mauvais code. » *(jugement flou, non actionnable)*

---

## 💡 Suggestions applicables (GitHub)

Utilisez les **suggestions** pour les retouches triviales (import, naming, guard clause).

```suggestion
if (! $user->isActive()) {
    abort(403);
}
````

```suggestion
// Préférer l'early return pour éviter l'indentation profonde
if (! $request->filled('q')) {
    return $query;
}
```

---

## 🏷️ Sévérité & décision

* **Blocking** (Request changes) : bug, faille, rupture contrat API, dette majeure.
* **Major non-blocking** : amélioration importante mais merge possible.
* **Nit** : forme (formatage que les outils peuvent corriger).

---

## 🧪 Checklists de review

**Checklist Reviewer**

* [ ] Scope conforme à l’issue, **pas de creep**
* [ ] **CI verte**, migrations réversibles (`down`)
* [ ] Pas de secret / clé / dump dans le code
* [ ] **N+1** évité / index ajoutés si besoin
* [ ] **Tests** pertinents (succès/erreur)
* [ ] **Nommer** clairement (méthodes, variables, commits)
* [ ] **Docs/README** mis à jour si impact

**Checklist Auteur (avant re-review)**

* [ ] Chaque fil commenté / résolu
* [ ] Commits **petits** et **propres** (Conventional)
* [ ] Rebase sur `origin/develop` + push `--force-with-lease`
* [ ] PR relue en local + tests OK

---

## 🧭 Modèles de réponses

**Approve**

```md
✅ LGTM. Couverture tests OK, perfs contrôlées. Merci !
```

**Request changes**

```md
❗ Bloquant : endpoint `/api/articles` expose `email` en clair.
Action : masquer via Resource + test HTTP 200/403.
```

**Comment (non-blocking)**

```md
💡 Suggestion : extraire `FilterBuilder` pour isoler la logique de requêtes.
```

---

## ⚙️ Outils & configuration utiles

**CODEOWNERS** (auto-assignation reviewers)

```
# Exemples
/resources/views/   @ui-team
/app/Http/          @backend-team
```

**Rappels CI requis**

* Status checks : `lint`, `tests` **obligatoires** avant merge.
* Merge policy : **Squash** + suppression de branche.

---

## 🧰 GitHub CLI (review rapide)

```bash
# Voir diff de la PR
gh pr diff 123

# Laisser une review "comment"
gh pr review 123 --comment -b "Deux suggestions non-bloquantes."

# Demander des changements (blocking)
gh pr review 123 --request-changes -b "Corriger N+1 + test 403 manquant."

# Approuver
gh pr review 123 --approve
```

---

## 📦 Livrables attendus

* Fils de discussion **clairs**, chacun avec **action** et **statut**.
* Suggestions utilisées pour les retouches triviales.
* Décision **Approve / Request changes / Comment** documentée.

---

## ✅ DoD — Definition of Done (review)

* [ ] Tous les **bloquants résolus** et re-testés.
* [ ] **CI verte** après derniers commits.
* [ ] Au moins **1 approbation** (ou owners requis).
* [ ] PR prête pour **squash merge** + branche supprimée.

---

## 🩹 Erreurs fréquentes & correctifs

* ❌ *Bike-shedding* → laisser **Prettier/Pint** trancher la forme.
* ❌ PR trop large → **scinder** par sujets.
* ❌ Conflits tardifs → rebase **régulier** pendant la review.
* ❌ Ton agressif → **factuel**, proposer une **alternative**.
* ❌ Manque de tests → exiger **cas d’erreur** + succès.

---
