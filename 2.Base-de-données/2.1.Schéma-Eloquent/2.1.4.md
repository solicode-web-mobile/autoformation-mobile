---
title: 4. Requ√™tes CRUD avec Eloquent
layout: home
nav_order: 4
parent: 2.1. Sch√©ma & Eloquent
permalink: /schema-eloquent/crud-eloquent/
code: 2.1.4
competence: C2
autoformation: "C2.1"
ua: "2.1.U2"
duree_h: 3
objectif: "Savoir manipuler les donn√©es avec Eloquent : cr√©er, lire, mettre √† jour et supprimer des enregistrements (CRUD) directement depuis Tinker."
notions_nouvelles: ["CRUD", "Query Builder", "Tinker", "Scope", "Query chaining"]
fil_rouge: "Blog Laravel : manipulation directe des articles, tags et utilisateurs en base."
livrable_chapitre: "Requ√™tes CRUD ex√©cut√©es et v√©rifi√©es dans Tinker (capture d‚Äô√©cran des op√©rations)."
alimentation_prototype: "Base ma√Ætris√©e et pr√™te pour l‚Äôint√©gration API (chapitres suivants)."
alimentation_miniprojet: "Capacit√© √† manipuler les donn√©es du projet depuis Eloquent."
---

# üìò 2.1.4 ‚Äî Requ√™tes CRUD avec Eloquent

> ‚ÑπÔ∏è **Pr√©requis :** la base de donn√©es doit d√©j√† √™tre remplie avec les seeders du chapitre **2.1.3**.  
> Vous allez maintenant apprendre √† **manipuler les donn√©es directement** √† travers Eloquent, sans passer par d‚Äôinterface graphique.

---

## üìí Glossaire minute

- **CRUD** : op√©rations de base sur une ressource (*Create, Read, Update, Delete*).  
- **Eloquent** : ORM (Object Relational Mapper) de Laravel permettant d‚Äôinteragir avec la base de donn√©es via des objets PHP.  
- **Tinker** : console interactive pour ex√©cuter des commandes Laravel.  
- **Scope** : filtre r√©utilisable sur un mod√®le.  
- **Query chaining** : encha√Ænement fluide de m√©thodes (`where()->orderBy()->get()`).

---

## üéØ Objectif p√©dagogique

Savoir manipuler la base de donn√©es du Blog Laravel √† partir de **Tinker** en utilisant les m√©thodes Eloquent :  
1. Cr√©er (`create`, `save`)  
2. Lire (`all`, `find`, `where`, `with`)  
3. Mettre √† jour (`update`, `save`)  
4. Supprimer (`delete`)  
5. G√©rer les **relations** et les **requ√™tes cha√Æn√©es**

---

## üß† D√©finition th√©orique

Eloquent agit comme une couche interm√©diaire entre **PHP** et **MySQL** :  
chaque **mod√®le** repr√©sente une **table**, et chaque **instance** correspond √† une ligne de cette table.

| Action | SQL classique | √âquivalent Eloquent |
|--------|----------------|---------------------|
| Lire | `SELECT * FROM articles;` | `Article::all();` |
| Filtrer | `WHERE user_id = 1;` | `Article::where('user_id', 1)->get();` |
| Ins√©rer | `INSERT INTO articles ...` | `Article::create([...]);` |
| Modifier | `UPDATE articles ...` | `$article->update([...]);` |
| Supprimer | `DELETE FROM articles ...` | `$article->delete();` |

---

## üõ† Tutoriel pratique

### √âtape 1 : Lancer Tinker

> Tinker permet d‚Äôex√©cuter du code Laravel sans passer par un fichier PHP.

```bash
php artisan tinker
````

---

### √âtape 2 : Cr√©er des donn√©es (Create)

> On peut ins√©rer une nouvelle donn√©e avec `create()` ou en instanciant un objet puis en appelant `save()`.

#### üß© M√©thode 1 ‚Äî Avec `create()`

```php
>>> use App\Models\Article;
>>> $article = Article::create([
... 'user_id' => 1,
... 'title' => 'Premier article manuel',
... 'slug' => 'premier-article',
... 'excerpt' => 'Introduction √† Eloquent CRUD',
... 'content' => 'Ceci est un test d‚Äôajout via Tinker.'
... ]);
```

üí° Les champs utilis√©s doivent √™tre d√©clar√©s dans `$fillable` du mod√®le.

#### üß© M√©thode 2 ‚Äî Avec `new` et `save()`

```php
>>> $a = new Article;
>>> $a->user_id = 1;
>>> $a->title = 'Deuxi√®me article';
>>> $a->slug = 'deuxieme-article';
>>> $a->save();
```

‚úÖ V√©rification :

```php
>>> Article::count();
```

---

### √âtape 3 : Lire les donn√©es (Read)

> On peut lire toutes les donn√©es, filtrer ou charger des relations.

#### üìã Lister tous les articles

```php
>>> Article::all();
```

#### üîç Trouver un article pr√©cis

```php
>>> Article::find(1);
```

#### üéØ Filtrer par mot-cl√©

```php
>>> Article::where('title', 'like', '%article%')->get();
```

#### üîó Lire avec les relations (user, tags)

```php
>>> Article::with(['user','tags'])->first();
```

#### üìä Compter les articles par utilisateur

```php
>>> \App\Models\User::withCount('articles')->get();
```

---

### √âtape 4 : Modifier des donn√©es (Update)

> Eloquent permet de modifier directement un ou plusieurs enregistrements.

#### üß© Exemple simple

```php
>>> $article = Article::find(1);
>>> $article->update(['title' => 'Titre modifi√©']);
```

#### Variante :

```php
>>> $article->title = 'Nouveau titre modifi√©';
>>> $article->save();
```

‚úÖ V√©rifiez que la mise √† jour a bien √©t√© prise en compte :

```php
>>> Article::find(1)->title;
```

---

### √âtape 5 : Supprimer des donn√©es (Delete)

> Une simple m√©thode `delete()` supprime l‚Äôenregistrement courant.

```php
>>> $article = Article::find(1);
>>> $article->delete();
```

üí° V√©rification :

```php
>>> Article::find(1);
null
```

---

### √âtape 6 : Manipuler les relations

#### üß© Ajouter un tag √† un article

```php
>>> $a = Article::first();
>>> $a->tags()->attach(1);
```

#### üß© Retirer un tag

```php
>>> $a->tags()->detach(1);
```

#### üß© Remplacer tous les tags

```php
>>> $a->tags()->sync([2,3,4]);
```

---

### √âtape 7 : Filtrer et trier (Query Builder)

> Eloquent permet d‚Äôencha√Æner plusieurs conditions facilement.

#### üîΩ Trier par date

```php
>>> Article::orderBy('created_at','desc')->take(5)->get();
```

#### üéØ S√©lectionner certains champs

```php
>>> Article::select('id','title','slug')->get();
```

#### üîó Combiner plusieurs conditions

```php
>>> Article::where('user_id',1)->orderBy('title')->limit(3)->get();
```

---

### √âtape 8 : Cr√©er un *scope* personnalis√© (optionnel)

> Un *scope* permet de cr√©er une requ√™te r√©utilisable dans le mod√®le.

**Dans `app/Models/Article.php` :**
{% raw %}

```php
public function scopeRecent($query)
{
    return $query->orderBy('created_at', 'desc')->take(5);
}
```

{% endraw %}

**Dans Tinker :**

```php
>>> Article::recent()->get();
```

---

## üìò Bonus ‚Äî Combiner Eloquent et Query Builder

> Vous pouvez ex√©cuter des requ√™tes avanc√©es directement sur Eloquent.

```php
>>> Article::where('title','like','%laravel%')
... ->selectRaw('user_id, count(*) as total')
... ->groupBy('user_id')
... ->get();
```

---

## üßæ R√©sum√© et points-cl√©s

| Action            | M√©thode Eloquent               | Exemple                              |
| ----------------- | ------------------------------ | ------------------------------------ |
| **Cr√©er**         | `create()` / `save()`          | `Article::create([...])`             |
| **Lire**          | `all()`, `find()`, `where()`   | `Article::where('user_id',1)->get()` |
| **Mettre √† jour** | `update()`                     | `$article->update([...])`            |
| **Supprimer**     | `delete()`                     | `$article->delete()`                 |
| **Relations**     | `with()`, `attach()`, `sync()` | `$a->tags()->sync([1,2])`            |
| **Scopes**        | `scopeNom()`                   | `Article::recent()->get()`           |

---

## üéÅ Livrable attendu

* Requ√™tes CRUD ex√©cut√©es et test√©es dans **Tinker**.
* Manipulation des relations (`attach`, `sync`, `detach`).
* Capture d‚Äô√©cran des r√©sultats de `Article::count()` et `Article::with('tags')->get()`.

---

## üîó Suite du parcours

> Prochain module ‚Üí **2.2. API & Contr√¥leurs REST**
> Vous apprendrez √† **exposer vos donn√©es** via des routes REST et √† **renvoyer des r√©ponses JSON** structur√©es.

