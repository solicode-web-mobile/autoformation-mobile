---
title: 4. Requ√™tes CRUD avec Eloquent
layout: home
nav_order: 4
parent: 2.1. Sch√©ma & Eloquent
permalink: /schema-eloquent/crud-eloquent/
code: 2.1.4
competence: C2
autoformation: "C2.1"
ua: "2.1.U2"
duree_h: 3
objectif: "Savoir manipuler les donn√©es avec Eloquent : cr√©er, lire, mettre √† jour et supprimer des enregistrements (CRUD) directement depuis Tinker."
notions_nouvelles: ["CRUD", "Query Builder", "Tinker", "Scope", "Query chaining"]
fil_rouge: "Blog Laravel : manipulation directe des articles, tags et utilisateurs en base."
livrable_chapitre: "Requ√™tes CRUD ex√©cut√©es et v√©rifi√©es dans Tinker (capture d‚Äô√©cran des op√©rations)."
alimentation_prototype: "Base ma√Ætris√©e et pr√™te pour l‚Äôint√©gration API (chapitres suivants)."
alimentation_miniprojet: "Capacit√© √† manipuler les donn√©es du projet depuis Eloquent."
---

# üìò 2.1.4 ‚Äî Requ√™tes CRUD avec Eloquent

> ‚ÑπÔ∏è **Pr√©requis :** les donn√©es doivent d√©j√† √™tre g√©n√©r√©es via les seeders (chapitre 2.1.3).  
> Vous allez apprendre √† **interagir avec la base** gr√¢ce √† Eloquent, directement dans **Tinker**.

---

## üìí Glossaire minute

- **CRUD** ‚Üí *Create, Read, Update, Delete* (op√©rations de base sur une table).  
- **Eloquent** ‚Üí ORM (Object Relational Mapper) de Laravel, qui simplifie les requ√™tes SQL.  
- **Tinker** ‚Üí console interactive permettant d‚Äôex√©cuter des commandes PHP/Laravel.  
- **Scope** ‚Üí condition r√©utilisable sur un mod√®le (ex. : articles publi√©s).  
- **Query chaining** ‚Üí encha√Ænement fluide des m√©thodes (`where()->orderBy()->get()`).

---

## üéØ Objectif p√©dagogique

Apprendre √† effectuer les **4 op√©rations CRUD** avec Eloquent :  
1. **Cr√©er** une donn√©e (`create`, `save`)  
2. **Lire** les donn√©es (`all`, `find`, `where`, `with`)  
3. **Mettre √† jour** (`update`)  
4. **Supprimer** (`delete`)  

üëâ Tout cela sans interface Blade, uniquement via **Tinker** ou des scripts simples.

---

## üß† D√©finition th√©orique

Chaque mod√®le Eloquent (`User`, `Article`, `Tag`) repr√©sente une **table SQL**.  
Les instances des mod√®les correspondent √† **des lignes** dans cette table.

Eloquent vous permet de manipuler ces donn√©es sans √©crire de SQL :

| Op√©ration | SQL classique | Eloquent |
|------------|----------------|------------|
| Lecture | `SELECT * FROM articles;` | `Article::all();` |
| Filtrage | `SELECT * FROM articles WHERE user_id=1;` | `Article::where('user_id',1)->get();` |
| Insertion | `INSERT INTO articles (...) VALUES (...);` | `Article::create([...]);` |
| Mise √† jour | `UPDATE articles SET ... WHERE id=1;` | `$article->update([...]);` |
| Suppression | `DELETE FROM articles WHERE id=1;` | `$article->delete();` |

---

## üõ† Tutoriel pratique

### √âtape 1 ‚Äî Ouvrir Tinker

```bash
php artisan tinker
````

---

### √âtape 2 ‚Äî Cr√©er (Create)

> On peut cr√©er un enregistrement avec `create()` ou `save()`.

#### M√©thode 1 ‚Äî `create()` (plus rapide)

```php
>>> use App\Models\Article;
>>> $article = Article::create([
...     'user_id' => 1,
...     'title' => 'Premier article manuel',
...     'slug' => 'premier-article',
...     'excerpt' => 'Introduction √† Eloquent CRUD',
...     'content' => 'Ceci est un test d‚Äôajout via Tinker.'
... ]);
```

üí° Assurez-vous que les champs soient dans `$fillable` du mod√®le.

#### M√©thode 2 ‚Äî `new` + `save()`

```php
>>> $a = new Article;
>>> $a->user_id = 1;
>>> $a->title = 'Deuxi√®me article';
>>> $a->slug = 'deuxieme-article';
>>> $a->save();
```

‚úÖ V√©rification :

```php
>>> Article::count();
```

---

### √âtape 3 ‚Äî Lire (Read)

#### Lister tous les articles

```php
>>> Article::all();
```

#### Trouver un article par ID

```php
>>> Article::find(1);
```

#### Requ√™tes filtr√©es

```php
>>> Article::where('title', 'like', '%article%')->get();
```

#### Lecture avec relations

```php
>>> Article::with(['user','tags'])->first();
```

#### Compter les articles par utilisateur

```php
>>> \App\Models\User::withCount('articles')->get();
```

---

### √âtape 4 ‚Äî Mettre √† jour (Update)

#### Modifier un seul enregistrement

```php
>>> $article = Article::find(1);
>>> $article->update(['title' => 'Titre mis √† jour']);
```

#### Autre forme

```php
>>> $article->title = 'Nouvelle version du titre';
>>> $article->save();
```

---

### √âtape 5 ‚Äî Supprimer (Delete)

```php
>>> $article = Article::find(1);
>>> $article->delete();
```

üí° V√©rification :

```php
>>> Article::find(1);
null
```

---

### √âtape 6 ‚Äî Manipuler les relations

#### Ajouter un tag √† un article

```php
>>> $a = Article::first();
>>> $a->tags()->attach(1);
```

#### Supprimer un tag

```php
>>> $a->tags()->detach(1);
```

#### Remplacer tous les tags (sync)

```php
>>> $a->tags()->sync([2,3,4]);
```

---

### √âtape 7 ‚Äî Trier, limiter, grouper (Query Builder)

#### Trier par date

```php
>>> Article::orderBy('created_at','desc')->take(5)->get();
```

#### S√©lectionner uniquement certains champs

```php
>>> Article::select('id','title','slug')->get();
```

#### Requ√™tes cha√Æn√©es

```php
>>> Article::where('user_id',1)->orderBy('title')->limit(3)->get();
```

---

### √âtape 8 ‚Äî Cr√©er un *scope* personnalis√© (optionnel)

> Un **scope** permet de d√©finir un filtre r√©utilisable.

**Dans `app/Models/Article.php` :**
{% raw %}

```php
public function scopeRecent($query)
{
    return $query->orderBy('created_at', 'desc')->take(5);
}
```

{% endraw %}

**Dans Tinker :**

```php
>>> Article::recent()->get();
```

---

## üìò Bonus ‚Äî Combiner Eloquent et Query Builder

üí° Eloquent est construit au-dessus du **Query Builder**, donc on peut m√©langer les deux :

```php
>>> Article::where('title','like','%laravel%')
... ->selectRaw('user_id, count(*) as total')
... ->groupBy('user_id')
... ->get();
```

---

## üßæ R√©sum√© et points-cl√©s

| Action            | M√©thode Eloquent             | Exemple                              |
| ----------------- | ---------------------------- | ------------------------------------ |
| Cr√©er             | `create()` / `save()`        | `Article::create([...])`             |
| Lire              | `all()`, `find()`, `where()` | `Article::where('user_id',1)->get()` |
| Mettre √† jour     | `update()`                   | `$article->update([...])`            |
| Supprimer         | `delete()`                   | `$article->delete()`                 |
| Charger relations | `with()` / `withCount()`     | `Article::with('tags')->first()`     |
| Lier des tags     | `attach()` / `sync()`        | `$article->tags()->sync([1,2])`      |

---

## üéÅ Livrable attendu

* Ex√©cution des **4 op√©rations CRUD** dans Tinker (captures ou transcript).
* Manipulation de **relations** (`attach`, `sync`, `detach`) r√©ussie.
* V√©rification via **`Article::count()`** et **`Article::with('tags')->get()`**.

---

## üîó Suite du parcours

> Prochain module ‚Üí **2.2. API & Contr√¥leurs REST**
> Vous apprendrez √† exposer vos donn√©es Eloquent via des **routes API**, √† structurer des **contr√¥leurs REST** et √† renvoyer vos donn√©es sous forme **JSON**.

