---
title: 4. RequÃªtes CRUD avec Eloquent
layout: home
nav_order: 4
parent: 2.1. SchÃ©ma & Eloquent
permalink: /schema-eloquent/crud-eloquent/
code: 2.1.4
competence: C2
autoformation: "C2.1"
ua: "2.1.U2"
duree_h: 3
objectif: "Savoir manipuler les donnÃ©es avec Eloquent : crÃ©er, lire, mettre Ã  jour et supprimer des enregistrements (CRUD) directement depuis Tinker."
notions_nouvelles: ["CRUD", "Query Builder", "Tinker", "Scope", "Query chaining"]
fil_rouge: "Blog Laravel : manipulation directe des articles, tags et utilisateurs en base."
livrable_chapitre: "RequÃªtes CRUD exÃ©cutÃ©es et vÃ©rifiÃ©es dans Tinker (capture dâ€™Ã©cran des opÃ©rations)."
alimentation_prototype: "Base maÃ®trisÃ©e et prÃªte pour lâ€™intÃ©gration API (tutoriels suivants)."
alimentation_miniprojet: "CapacitÃ© Ã  manipuler les donnÃ©es du projet depuis Eloquent."
---

# ğŸ“˜ 2.1.4 â€” RequÃªtes CRUD avec Eloquent

> â„¹ï¸ **PrÃ©requis :** la base de donnÃ©es doit dÃ©jÃ  Ãªtre remplie avec les seeders du chapitre **2.1.3**.  
> Vous allez maintenant apprendre Ã  **manipuler les donnÃ©es directement** Ã  travers Eloquent, sans passer par dâ€™interface graphique.

---

## ğŸ“’ Glossaire minute

- **CRUD** : opÃ©rations de base sur une ressource (*Create, Read, Update, Delete*).  
- **Eloquent** : ORM (Object Relational Mapper) de Laravel permettant dâ€™interagir avec la base de donnÃ©es via des objets PHP.  
- **Tinker** : console interactive pour exÃ©cuter des commandes Laravel.  
- **Scope** : filtre rÃ©utilisable sur un modÃ¨le.  
- **Query chaining** : enchaÃ®nement fluide de mÃ©thodes (`where()->orderBy()->get()`).

---

## ğŸ¯ Objectif pÃ©dagogique

Savoir manipuler la base de donnÃ©es du Blog Laravel Ã  partir de **Tinker** en utilisant les mÃ©thodes Eloquent :  
1. CrÃ©er (`create`, `save`)  
2. Lire (`all`, `find`, `where`, `with`)  
3. Mettre Ã  jour (`update`, `save`)  
4. Supprimer (`delete`)  
5. GÃ©rer les **relations** et les **requÃªtes chaÃ®nÃ©es**

---

## ğŸ§  DÃ©finition thÃ©orique

Eloquent agit comme une couche intermÃ©diaire entre **PHP** et **MySQL** :  
chaque **modÃ¨le** reprÃ©sente une **table**, et chaque **instance** correspond Ã  une ligne de cette table.

| Action | SQL classique | Ã‰quivalent Eloquent |
|--------|----------------|---------------------|
| Lire | `SELECT * FROM articles;` | `Article::all();` |
| Filtrer | `WHERE user_id = 1;` | `Article::where('user_id', 1)->get();` |
| InsÃ©rer | `INSERT INTO articles ...` | `Article::create([...]);` |
| Modifier | `UPDATE articles ...` | `$article->update([...]);` |
| Supprimer | `DELETE FROM articles ...` | `$article->delete();` |

---

## ğŸ›  Tutoriel pratique

### Ã‰tape 1 : Lancer Tinker

> Tinker permet dâ€™exÃ©cuter du code Laravel sans passer par un fichier PHP.

```bash
php artisan tinker
````

---

### Ã‰tape 2 : CrÃ©er des donnÃ©es (Create)

> On peut insÃ©rer une nouvelle donnÃ©e avec `create()` ou en instanciant un objet puis en appelant `save()`.

#### ğŸ§© MÃ©thode 1 â€” Avec `create()`

```php
>>> use App\Models\Article;
>>> $article = Article::create([
... 'user_id' => 1,
... 'title' => 'Premier article manuel',
... 'slug' => 'premier-article',
... 'excerpt' => 'Introduction Ã  Eloquent CRUD',
... 'content' => 'Ceci est un test dâ€™ajout via Tinker.'
... ]);
```

ğŸ’¡ Les champs utilisÃ©s doivent Ãªtre dÃ©clarÃ©s dans `$fillable` du modÃ¨le.

#### ğŸ§© MÃ©thode 2 â€” Avec `new` et `save()`

```php
>>> $a = new Article;
>>> $a->user_id = 1;
>>> $a->title = 'DeuxiÃ¨me article';
>>> $a->slug = 'deuxieme-article';
>>> $a->save();
```

âœ… VÃ©rification :

```php
>>> Article::count();
```

---

### Ã‰tape 3 : Lire les donnÃ©es (Read)

> On peut lire toutes les donnÃ©es, filtrer ou charger des relations.

#### ğŸ“‹ Lister tous les articles

```php
>>> Article::all();
```

#### ğŸ” Trouver un article prÃ©cis

```php
>>> Article::find(1);
```

#### ğŸ¯ Filtrer par mot-clÃ©

```php
>>> Article::where('title', 'like', '%article%')->get();
```

#### ğŸ”— Lire avec les relations (user, tags)

```php
>>> Article::with(['user','tags'])->first();
```

#### ğŸ“Š Compter les articles par utilisateur

```php
>>> \App\Models\User::withCount('articles')->get();
```

---

### Ã‰tape 4 : Modifier des donnÃ©es (Update)

> Eloquent permet de modifier directement un ou plusieurs enregistrements.

#### ğŸ§© Exemple simple

```php
>>> $article = Article::find(1);
>>> $article->update(['title' => 'Titre modifiÃ©']);
```

#### Variante :

```php
>>> $article->title = 'Nouveau titre modifiÃ©';
>>> $article->save();
```

âœ… VÃ©rifiez que la mise Ã  jour a bien Ã©tÃ© prise en compte :

```php
>>> Article::find(1)->title;
```

---

### Ã‰tape 5 : Supprimer des donnÃ©es (Delete)

> Une simple mÃ©thode `delete()` supprime lâ€™enregistrement courant.

```php
>>> $article = Article::find(1);
>>> $article->delete();
```

ğŸ’¡ VÃ©rification :

```php
>>> Article::find(1);
null
```

---

### Ã‰tape 6 : Manipuler les relations

#### ğŸ§© Ajouter un tag Ã  un article

```php
>>> $a = Article::first();
>>> $a->tags()->attach(1);
```

#### ğŸ§© Retirer un tag

```php
>>> $a->tags()->detach(1);
```

#### ğŸ§© Remplacer tous les tags

```php
>>> $a->tags()->sync([2,3,4]);
```

---

### Ã‰tape 7 : Filtrer et trier (Query Builder)

> Eloquent permet dâ€™enchaÃ®ner plusieurs conditions facilement.

#### ğŸ”½ Trier par date

```php
>>> Article::orderBy('created_at','desc')->take(5)->get();
```

#### ğŸ¯ SÃ©lectionner certains champs

```php
>>> Article::select('id','title','slug')->get();
```

#### ğŸ”— Combiner plusieurs conditions

```php
>>> Article::where('user_id',1)->orderBy('title')->limit(3)->get();
```

---

### Ã‰tape 8 : CrÃ©er un *scope* personnalisÃ© (optionnel)

> Un *scope* permet de crÃ©er une requÃªte rÃ©utilisable dans le modÃ¨le.

**Dans `app/Models/Article.php` :**
{% raw %}

```php
public function scopeRecent($query)
{
    return $query->orderBy('created_at', 'desc')->take(5);
}
```

{% endraw %}

**Dans Tinker :**

```php
>>> Article::recent()->get();
```

---

## ğŸ“˜ Bonus â€” Combiner Eloquent et Query Builder

> Vous pouvez exÃ©cuter des requÃªtes avancÃ©es directement sur Eloquent.

```php
>>> Article::where('title','like','%laravel%')
... ->selectRaw('user_id, count(*) as total')
... ->groupBy('user_id')
... ->get();
```

---

## ğŸ§¾ RÃ©sumÃ© et points-clÃ©s

| Action            | MÃ©thode Eloquent               | Exemple                              |
| ----------------- | ------------------------------ | ------------------------------------ |
| **CrÃ©er**         | `create()` / `save()`          | `Article::create([...])`             |
| **Lire**          | `all()`, `find()`, `where()`   | `Article::where('user_id',1)->get()` |
| **Mettre Ã  jour** | `update()`                     | `$article->update([...])`            |
| **Supprimer**     | `delete()`                     | `$article->delete()`                 |
| **Relations**     | `with()`, `attach()`, `sync()` | `$a->tags()->sync([1,2])`            |
| **Scopes**        | `scopeNom()`                   | `Article::recent()->get()`           |

