---
title: 1. Tables & contraintes
layout: home
nav_order: 1
parent: 2.1. Sch√©ma & Eloquent
permalink: /schema-eloquent/tables-contraintes/
code: 2.1.1
competence: C2
autoformation: "C2.1"
ua: "2.1.U1"
duree_h: 1.5
objectif: "Cr√©er des tables avec PK/FK et contraintes (unicit√©, cascade) puis ex√©cuter les migrations proprement."
notions_nouvelles: ["PK", "FK", "Contrainte"]
fil_rouge: "Blog Laravel + App Mobile (liste, d√©tail, tags)"
livrable_chapitre: "Migrations `articles`, `tags`, `article_tag` + capture de `php artisan migrate`"
alimentation_prototype: "Sch√©ma minimal pr√™t pour routes/DTOs du prototype N2."
alimentation_miniprojet: "Base relationnelle propre (PK/FK + pivot) pour N3."
---

# üìò 2.1.1 ‚Äî Cr√©ation de tables avec PK/FK et contraintes


> ‚ÑπÔ∏è Avant de commencer : assurez-vous d‚Äôavoir un projet Laravel 11 install√© (ex. : `blog-laravel`) et une base MySQL configur√©e.

---

## üìí Glossaire minute

- **PK (Primary Key)** ‚Üí identifiant unique d‚Äôune ligne dans une table.  
- **FK (Foreign Key)** ‚Üí cl√© faisant r√©f√©rence √† une PK d‚Äôune autre table.  
- **Contrainte** ‚Üí r√®gle d‚Äôint√©grit√© garantissant la coh√©rence des donn√©es (unicit√©, non-null, cascade‚Ä¶).  
- **Mod√®le Eloquent** ‚Üí classe PHP repr√©sentant une table et permettant d‚Äôy acc√©der facilement.

---

## üéØ Objectif p√©dagogique

Apprendre √† :
1. Cr√©er les **tables** avec leurs **cl√©s primaires, √©trang√®res et contraintes**,  
2. Comprendre le **lien entre tables et mod√®les Eloquent**,  
3. G√©n√©rer les **mod√®les correspondants** (`Article`, `Tag`) pour manipuler les donn√©es dans les prochains chapitres.

---

## üß† D√©finition th√©orique

Un **sch√©ma relationnel** d√©crit la structure physique des donn√©es (tables, colonnes, relations).  
Les **mod√®les Eloquent**, eux, repr√©sentent ces tables dans le code :  
chaque mod√®le agit comme une **interface objet** vers une table.

> Exemple :
> - Table SQL : `articles`
> - Mod√®le PHP : `App\Models\Article`
> - Chaque ligne devient une **instance** de `Article`.

Laravel associe automatiquement les deux gr√¢ce aux conventions :
- Nom du mod√®le au singulier (`Article`)  
- Nom de la table au pluriel (`articles`)

Ainsi, les **FK** assurent la coh√©rence des relations,  
et les **mod√®les** permettent de manipuler ces relations facilement dans le code.

---

## üõ† Tutoriel pratique

### üìÅ Arborescence du projet

```

database/
‚îî‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ 2014_10_12_000000_create_users_table.php   ‚Üê d√©j√† cr√©√©e par Laravel
‚îú‚îÄ‚îÄ 2025_10_24_000001_create_articles_table.php
‚îú‚îÄ‚îÄ 2025_10_24_000002_create_tags_table.php
‚îî‚îÄ‚îÄ 2025_10_24_000003_create_article_tag_table.php

```

---

### √âtape 1 : Cr√©er la migration

> Cette commande cr√©e un fichier vide dans le dossier `database/migrations`.  
> Chaque migration correspond √† une **modification du sch√©ma** (cr√©ation, suppression ou mise √† jour d‚Äôune table).

```bash
php artisan make:migration create_articles_table
````

---

### üß© √Ä savoir : la table `users` existe d√©j√†

> Laravel cr√©e automatiquement la table `users` dans tout nouveau projet.
> Elle se trouve dans la migration :
> `database/migrations/2014_10_12_000000_create_users_table.php`

{% raw %}

```php
Schema::create('users', function (Blueprint $table) {
    $table->id(); // cl√© primaire
    $table->string('name');
    $table->string('email')->unique();
    $table->timestamp('email_verified_at')->nullable();
    $table->string('password');
    $table->rememberToken();
    $table->timestamps();
});
```

{% endraw %}

> Cette table g√®re les **comptes utilisateurs** de l‚Äôapplication (nom, email, mot de passe, etc.).
> Vous pouvez donc la **r√©utiliser directement** pour vos relations, par exemple avec la colonne `user_id` dans la table `articles`.

---

### √âtape 2 : D√©finir la table `articles`

> On d√©finit la structure de la table principale du blog.
> On y ajoute une **cl√© primaire**, une **cl√© √©trang√®re** vers `users`, et des **contraintes** d‚Äôunicit√©.

{% raw %}

```php
Schema::create('articles', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->string('title', 180);
    $table->string('slug', 200)->unique();
    $table->timestamps();
});
```

{% endraw %}

---

### √âtape 3 : D√©finir la table `tags`

{% raw %}

```php
Schema::create('tags', function (Blueprint $table) {
    $table->id();
    $table->string('name')->unique();
    $table->timestamps();
});
```

{% endraw %}

---

### √âtape 4 : Cr√©er la table pivot `article_tag`

{% raw %}

```php
Schema::create('article_tag', function (Blueprint $table) {
    $table->foreignId('article_id')->constrained()->cascadeOnDelete();
    $table->foreignId('tag_id')->constrained()->cascadeOnDelete();
    $table->primary(['article_id', 'tag_id']);
});
```

{% endraw %}

---

### √âtape 5 : Ex√©cuter les migrations

```bash
php artisan migrate
```

> üí° Pour v√©rifier :

```sql
SHOW TABLES;
SHOW CREATE TABLE articles;
```

---

### √âtape 6 : Cr√©er les mod√®les Eloquent

> Chaque mod√®le Eloquent repr√©sente une table.
> Nous allons cr√©er les mod√®les `Article` et `Tag`.

```bash
php artisan make:model Article
php artisan make:model Tag
```

> üí° Le mod√®le `User` existe d√©j√† (`App\Models\User`).

#### Structure minimale

{% raw %}

```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Article extends Model
{
    use HasFactory;

    protected $fillable = ['user_id', 'title', 'slug'];
}
```

{% endraw %}

{% raw %}

```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tag extends Model
{
    use HasFactory;

    protected $fillable = ['name'];
}
```

{% endraw %}

> Ces mod√®les seront utilis√©s dans les chapitres suivants pour :
>
> * ins√©rer des donn√©es (**2.1.2 Seeders**),
> * faire un CRUD (**2.1.3**),
> * et g√©rer les relations (**2.1.4**).

---

## üìò Bonus ‚Äî Les principaux types de colonnes Laravel

| Type                     | Exemple                                          | Description           |
| ------------------------ | ------------------------------------------------ | --------------------- |
| `string`                 | `$table->string('title', 255);`                  | Texte court           |
| `text`                   | `$table->text('content');`                       | Texte long            |
| `integer` / `bigInteger` | `$table->integer('age');`                        | Nombre entier         |
| `boolean`                | `$table->boolean('is_active');`                  | Bool√©en               |
| `decimal` / `float`      | `$table->decimal('price', 8, 2);`                | Nombre avec d√©cimales |
| `date` / `timestamp`     | `$table->timestamp('published_at');`             | Date                  |
| `enum`                   | `$table->enum('status', ['draft','published']);` | Liste de choix        |
| `json`                   | `$table->json('meta');`                          | Donn√©es structur√©es   |
| `foreignId`              | `$table->foreignId('user_id')->constrained();`   | Cl√© √©trang√®re         |
| `softDeletes`            | `$table->softDeletes();`                         | Suppression logique   |

---

## üßæ R√©sum√© et points-cl√©s

* La table **`users`** est d√©j√† fournie par Laravel.
* Chaque table cr√©√©e doit avoir un **mod√®le Eloquent** associ√©.
* Les **PK/FK** assurent l‚Äôint√©grit√© des donn√©es.
* Les **mod√®les** permettent de manipuler facilement les enregistrements.
* Ce sch√©ma et ces mod√®les forment la **base du projet fil rouge** avant les seeders.

