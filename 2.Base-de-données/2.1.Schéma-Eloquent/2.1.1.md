---
title: 1. Migrations & mod√®les Eloquent
layout: home
nav_order: 1
parent: 2.1. Sch√©ma & Eloquent
permalink: /schema-eloquent/migrations-modeles/
code: 2.1.1
competence: C2
autoformation: "C2.1"
ua: "2.1.U1"
duree_h: 2
objectif: "Cr√©er les tables avec PK/FK et contraintes (unicit√©, cascade), puis associer √† chaque table un mod√®le Eloquent pr√™t √† manipuler les donn√©es."
notions_nouvelles: ["PK", "FK", "Contrainte", "Mod√®le Eloquent", "Migration"]
fil_rouge: "Blog Laravel (tables users, articles, tags, article_tag)"
livrable_chapitre: "Migrations + mod√®les Eloquent (`Article`, `Tag`) ex√©cutables et v√©rifi√©s dans Tinker"
alimentation_prototype: "Sch√©ma et mod√®les pr√™ts pour les relations du prototype N2."
alimentation_miniprojet: "Base relationnelle et mod√®les coh√©rents pour N3."
---

# üìò 2.1.1 ‚Äî Migrations & mod√®les Eloquent

> ‚ÑπÔ∏è **Pr√©requis :** avoir un projet Laravel 11 fonctionnel (ex. : `blog-laravel`) et une base MySQL configur√©e dans le fichier `.env`.

---

## üìí Glossaire minute

- **PK (Primary Key)** ‚Üí identifiant unique d‚Äôune ligne dans une table.  
- **FK (Foreign Key)** ‚Üí cl√© faisant r√©f√©rence √† une PK d‚Äôune autre table.  
- **Contrainte** ‚Üí r√®gle d‚Äôint√©grit√© garantissant la coh√©rence des donn√©es (unicit√©, non-null, cascade‚Ä¶).  
- **Migration** ‚Üí fichier versionn√© d√©crivant la structure d‚Äôune table.  
- **Mod√®le Eloquent** ‚Üí classe PHP repr√©sentant une table et permettant de la manipuler par le code.

---

## üéØ Objectif p√©dagogique

Cr√©er un **sch√©ma relationnel complet** pour le Blog Laravel :
- D√©finir les tables et leurs relations physiques (PK/FK).  
- Appliquer les contraintes d‚Äôint√©grit√© (`unique`, `cascadeOnDelete`).  
- G√©n√©rer les **mod√®les Eloquent** correspondants (`Article`, `Tag`).  
- V√©rifier la coh√©rence dans **Tinker**.

---

## üß† D√©finition th√©orique

Un **sch√©ma relationnel** d√©crit la structure des donn√©es dans une base MySQL :  
chaque **table** poss√®de une **cl√© primaire (PK)** et peut contenir des **cl√©s √©trang√®res (FK)** vers d‚Äôautres tables.  

Laravel permet de cr√©er ce sch√©ma √† l‚Äôaide de **migrations** versionn√©es.  
Les **mod√®les Eloquent** repr√©sentent ces tables sous forme d‚Äôobjets PHP.  

> üß© Exemple :  
> La table `articles` devient le mod√®le `App\Models\Article`.  
> Chaque ligne de la table devient une **instance** du mod√®le manipulable avec Eloquent.

---

## üõ† Tutoriel pratique

### üìÅ Structure du projet

```

database/
‚îî‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ 2014_10_12_000000_create_users_table.php   ‚Üê g√©n√©r√©e automatiquement
‚îú‚îÄ‚îÄ 2025_10_24_000001_create_articles_table.php
‚îú‚îÄ‚îÄ 2025_10_24_000002_create_tags_table.php
‚îî‚îÄ‚îÄ 2025_10_24_000003_create_article_tag_table.php

````

---

### √âtape 1 ‚Äî Cr√©er les migrations

> Chaque migration correspond √† la cr√©ation (ou modification) d‚Äôune table.

```bash
php artisan make:migration create_articles_table
php artisan make:migration create_tags_table
php artisan make:migration create_article_tag_table
````

---

### √âtape 2 ‚Äî Comprendre la table `users`

> Laravel fournit d√©j√† une table `users` pour la gestion des comptes.
> Elle servira de table parente pour les articles.

{% raw %}

```php
Schema::create('users', function (Blueprint $table) {
    $table->id(); // cl√© primaire
    $table->string('name');
    $table->string('email')->unique();
    $table->timestamp('email_verified_at')->nullable();
    $table->string('password');
    $table->rememberToken();
    $table->timestamps();
});
```

{% endraw %}

---

### √âtape 3 ‚Äî Cr√©er la table `articles`

> Chaque article appartient √† un utilisateur (`user_id`) et poss√®de un `slug` unique.

{% raw %}

```php
Schema::create('articles', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->cascadeOnDelete();
    $table->string('title', 180);
    $table->string('slug', 200)->unique();
    $table->text('excerpt')->nullable();
    $table->longText('content')->nullable();
    $table->timestamps();
});
```

{% endraw %}

---

### √âtape 4 ‚Äî Cr√©er la table `tags`

{% raw %}

```php
Schema::create('tags', function (Blueprint $table) {
    $table->id();
    $table->string('name')->unique();
    $table->string('slug')->unique();
    $table->timestamps();
});
```

{% endraw %}

---

### √âtape 5 ‚Äî Cr√©er la table pivot `article_tag`

> Une table pivot relie deux entit√©s dans une relation **n‚Äìn** (`Article` ‚Üî `Tag`).

{% raw %}

```php
Schema::create('article_tag', function (Blueprint $table) {
    $table->foreignId('article_id')->constrained()->cascadeOnDelete();
    $table->foreignId('tag_id')->constrained()->cascadeOnDelete();
    $table->primary(['article_id', 'tag_id']); // √©vite les doublons
});
```

{% endraw %}

---

### √âtape 6 ‚Äî Ex√©cuter les migrations

> Cette commande applique toutes les migrations et cr√©e les tables dans MySQL.

```bash
php artisan migrate
```

üí° V√©rification MySQL :

```sql
SHOW TABLES;
SHOW CREATE TABLE articles;
```

---

### √âtape 7 ‚Äî Cr√©er les mod√®les Eloquent

> Chaque table (sauf la pivot) doit avoir son **mod√®le Eloquent** associ√©.

```bash
php artisan make:model Article
php artisan make:model Tag
```

üí° Le mod√®le `User` existe d√©j√† dans `app/Models/User.php`.

#### Exemple : `app/Models/Article.php`

{% raw %}

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Article extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id', 'title', 'slug', 'excerpt', 'content'
    ];
}
```

{% endraw %}

#### Exemple : `app/Models/Tag.php`

{% raw %}

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tag extends Model
{
    use HasFactory;

    protected $fillable = [
        'name', 'slug'
    ];
}
```

{% endraw %}

---

### √âtape 8 ‚Äî V√©rification rapide avec Tinker

> On v√©rifie que les mod√®les et tables communiquent bien.

```bash
php artisan tinker
```

```php
>>> App\Models\Article::count();
0
>>> App\Models\Tag::create(['name' => 'Laravel', 'slug' => 'laravel']);
>>> App\Models\Tag::all();
```

‚úÖ Si la cr√©ation fonctionne, le sch√©ma et les mod√®les sont bien synchronis√©s.

---

## üìò Bonus ‚Äî Les principaux types de colonnes Laravel

> Voici les types de colonnes les plus utilis√©s dans les migrations Laravel :

| Type                              | Exemple                                          | Description                                   |
| --------------------------------- | ------------------------------------------------ | --------------------------------------------- |
| `string`                          | `$table->string('title', 255);`                  | Texte court (VARCHAR)                         |
| `text`                            | `$table->text('content');`                       | Texte long                                    |
| `integer` / `bigInteger`          | `$table->integer('age');`                        | Nombre entier                                 |
| `boolean`                         | `$table->boolean('is_active');`                  | Bool√©en (Vrai/Faux)                           |
| `decimal` / `float`               | `$table->decimal('price', 8, 2);`                | Nombre avec d√©cimales                         |
| `date` / `datetime` / `timestamp` | `$table->timestamp('published_at');`             | Date et heure                                 |
| `enum`                            | `$table->enum('status', ['draft','published']);` | Choix dans une liste                          |
| `json`                            | `$table->json('meta');`                          | Donn√©es structur√©es (tableau/objet JSON)      |
| `foreignId`                       | `$table->foreignId('user_id')->constrained();`   | FK vers une autre table                       |
| `softDeletes`                     | `$table->softDeletes();`                         | Colonne `deleted_at` pour suppression logique |

üí° **Bon r√©flexe :** choisissez le type de colonne adapt√© √† la nature de la donn√©e (performance + coh√©rence).

---

## üßæ R√©sum√© et points-cl√©s

| Concept             | Description                                    | Exemple                               |
| ------------------- | ---------------------------------------------- | ------------------------------------- |
| **Migration**       | Fichier PHP d√©crivant la structure d‚Äôune table | `create_articles_table`               |
| **PK / FK**         | Cl√©s pour assurer l‚Äôint√©grit√© r√©f√©rentielle    | `foreignId('user_id')->constrained()` |
| **Mod√®le Eloquent** | Classe repr√©sentant une table                  | `Article`, `Tag`                      |
| **$fillable**       | Liste des champs modifiables en masse          | `['title', 'slug']`                   |
| **Tinker**          | Console interactive pour tester Eloquent       | `php artisan tinker`                  |

---

## üîó Suite du parcours

> Prochain chapitre ‚Üí **2.1.2 ‚Äî D√©claration des relations Eloquent**
> Vous apprendrez √† relier les mod√®les entre eux (`User ‚Üí Article`, `Article ‚Üî Tag`) et √† interroger ces relations dans Tinker.

