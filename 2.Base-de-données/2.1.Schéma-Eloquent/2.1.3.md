---
title: 3. CRUD basique
layout: home
nav_order: 3
parent: 2.1. Sch√©ma & Eloquent
permalink: /schema-eloquent/crud/
code: 2.1.3
competence: C2
autoformation: "C2.1"
ua: "2.1.U2"
duree_h: 2
objectif: "Mettre en place un CRUD complet (routes REST, contr√¥leur resource, vues minimales, validation/flash) pour Article."
notions_nouvelles: ["CRUD", "Resource controller", "Resource route", "Route Model Binding", "Mass assignment"]
fil_rouge: "Article du Blog (migr√© au 2.1.1) avec √©crans liste/d√©tail"
livrable_chapitre: "7 routes REST (`Route::resource`) + vues (`index/create/edit/show` + `_form`) + message de succ√®s"
alimentation_prototype: "Flux CRUD op√©rationnel pour d√©mo N2."
alimentation_miniprojet: "Base du back-office Article (validations + vues) pour N3."
---

#  üìò2.1.3 ‚Äî CRUD basique avec un mod√®le simple

> ‚ÑπÔ∏è Objectif : apprendre √† cr√©er, afficher, modifier et supprimer une ressource Laravel (`Article`) √† l‚Äôaide d‚Äôun contr√¥leur resource et de vues simples.

---

## üìí Glossaire minute

- **CRUD** : ensemble d‚Äôop√©rations de base ‚Äî *Create, Read, Update, Delete*.  
- **Resource controller** : contr√¥leur Laravel dont les m√©thodes suivent la convention CRUD.  
- **Resource route** : raccourci `Route::resource()` qui g√©n√®re les routes REST.  
- **Route Model Binding** : injection automatique d‚Äôun mod√®le √† partir de son `id`.  
- **Mass assignment** : remplissage massif d‚Äôattributs autoris√© via `$fillable`.

---

## üéØ Objectif p√©dagogique

Mettre en place un **CRUD complet** pour `Article` : routes REST, contr√¥leur resource, vues Blade minimales, validation basique et messages de succ√®s.

---

## üß† D√©finition th√©orique

Laravel adopte une architecture **MVC** :

- **Mod√®le Eloquent** ‚Üí g√®re la base de donn√©es.  
- **Contr√¥leur resource** ‚Üí re√ßoit les requ√™tes et ex√©cute les actions CRUD.  
- **Vues Blade** ‚Üí affichent formulaires et listes.

L‚Äôappel suivant cr√©e automatiquement 7 routes REST standard :

```php
Route::resource('articles', ArticleController::class);
````

---

## üîç Exemple appliqu√© au fil rouge

Nous g√©rons ici la ressource **Article**, d√©j√† cr√©√©e au chapitre *2.1.1 (Migrations)*.
Le CRUD permettra de manipuler ses champs : `title`, `slug`, `excerpt`, `content`.

---

## üõ† Tutoriel pratique

### üìÅ Arborescence cible

```
app/
‚îú‚îÄ Models/Article.php
‚îú‚îÄ Http/Controllers/ArticleController.php
resources/views/articles/
‚îú‚îÄ index.blade.php
‚îú‚îÄ create.blade.php
‚îú‚îÄ edit.blade.php
‚îú‚îÄ show.blade.php
‚îî‚îÄ _form.blade.php
routes/web.php
```

---

### √âtape 1 ‚Äî G√©n√©rer mod√®le & contr√¥leur

> On cr√©e un mod√®le `Article` et un contr√¥leur REST associ√©.

```bash
php artisan make:model Article
php artisan make:controller ArticleController --resource --model=Article
```

> üí° En version modulaire (ex. nWidart) :
> `php artisan module:make-controller ArticleController PkgBlog --resource`

---

### √âtape 2 ‚Äî Mod√®le `Article` (fillable + relation + slug auto)

> Le mod√®le d√©finit les colonnes modifiables (`$fillable`), les relations (`user()`) et la g√©n√©ration automatique d‚Äôun **slug unique** √† l‚Äôenregistrement.

{% raw %}

```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Support\Str;

class Article extends Model
{
    use HasFactory;

    protected $fillable = ['user_id','title','slug','excerpt','content'];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    protected static function booted(): void
    {
        static::saving(function (Article $article) {
            if (blank($article->slug) && filled($article->title)) {
                $base = Str::slug($article->title);
                $slug = $base;
                $i = 1;
                while (static::where('slug', $slug)
                        ->whereKeyNot($article->getKey())
                        ->exists()) {
                    $slug = $base . '-' . (++$i);
                }
                $article->slug = $slug;
            }
        });
    }
}
```

{% endraw %}

---

### √âtape 3 ‚Äî D√©clarer les routes REST

> `Route::resource()` g√©n√®re les 7 routes CRUD automatiquement (`index`, `create`, `store`, `show`, `edit`, `update`, `destroy`).

{% raw %}

```php
// routes/web.php
use App\Http\Controllers\ArticleController;

Route::resource('articles', ArticleController::class);
```

{% endraw %}

---

### √âtape 4 ‚Äî Contr√¥leur `ArticleController`

> Le contr√¥leur centralise la logique CRUD.
> Chaque m√©thode correspond √† une action REST : afficher, cr√©er, enregistrer, √©diter, mettre √† jour, supprimer.

{% raw %}

```php
<?php
namespace App\Http\Controllers;

use App\Models\Article;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule;

class ArticleController extends Controller
{
    public function index()
    {
        $articles = Article::latest('created_at')->paginate(10);
        return view('articles.index', compact('articles'));
    }

    public function create()
    {
        $article = new Article();
        return view('articles.create', compact('article'));
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'title'   => ['required','string','max:180'],
            'slug'    => ['nullable','string','max:200','unique:articles,slug'],
            'excerpt' => ['nullable','string'],
            'content' => ['nullable','string'],
        ]);

        $data['user_id'] = auth()->id() ?? 1;

        $article = Article::create($data);

        return redirect()
            ->route('articles.show', $article)
            ->with('success', 'Article cr√©√© avec succ√®s.');
    }

    public function show(Article $article)
    {
        return view('articles.show', compact('article'));
    }

    public function edit(Article $article)
    {
        return view('articles.edit', compact('article'));
    }

    public function update(Request $request, Article $article)
    {
        $data = $request->validate([
            'title'   => ['required','string','max:180'],
            'slug'    => ['nullable','string','max:200', Rule::unique('articles','slug')->ignore($article->id)],
            'excerpt' => ['nullable','string'],
            'content' => ['nullable','string'],
        ]);

        $article->update($data);

        return redirect()
            ->route('articles.show', $article)
            ->with('success', 'Article mis √† jour.');
    }

    public function destroy(Article $article)
    {
        $article->delete();

        return redirect()
            ->route('articles.index')
            ->with('success', 'Article supprim√©.');
    }
}
```

{% endraw %}

---

### √âtape 5 ‚Äî Cr√©er les vues Blade

> Les vues suivantes permettent de visualiser et modifier les articles.
> On utilise un fichier `_form.blade.php` commun pour √©viter la r√©p√©tition de code.

#### `resources/views/articles/index.blade.php`

{% raw %}

```php
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Articles</title></head>
<body>
@if(session('success')) <p style="color:green">{{ session('success') }}</p> @endif

<h1>Articles</h1>
<p><a href="{{ route('articles.create') }}">Cr√©er</a></p>

<table border="1" cellpadding="6">
  <thead><tr><th>ID</th><th>Titre</th><th>Slug</th><th>Actions</th></tr></thead>
  <tbody>
  @foreach($articles as $a)
    <tr>
      <td>{{ $a->id }}</td>
      <td><a href="{{ route('articles.show',$a) }}">{{ $a->title }}</a></td>
      <td>{{ $a->slug }}</td>
      <td>
        <a href="{{ route('articles.edit',$a) }}">√âditer</a>
        <form action="{{ route('articles.destroy',$a) }}" method="post" style="display:inline">
          @csrf @method('DELETE')
          <button type="submit" onclick="return confirm('Supprimer ?')">Supprimer</button>
        </form>
      </td>
    </tr>
  @endforeach
  </tbody>
</table>

{{ $articles->links() }}
</body>
</html>
```

{% endraw %}

#### `_form.blade.php`

{% raw %}

```php
@csrf
<p>
  <label>Titre<br>
    <input type="text" name="title" value="{{ old('title', $article->title) }}">
  </label>
  @error('title') <small style="color:red">{{ $message }}</small> @enderror
</p>

<p>
  <label>Slug (optionnel)<br>
    <input type="text" name="slug" value="{{ old('slug', $article->slug) }}">
  </label>
  @error('slug') <small style="color:red">{{ $message }}</small> @enderror
</p>

<p>
  <label>Extrait<br>
    <textarea name="excerpt" rows="3">{{ old('excerpt', $article->excerpt) }}</textarea>
  </label>
</p>

<p>
  <label>Contenu<br>
    <textarea name="content" rows="6">{{ old('content', $article->content) }}</textarea>
  </label>
</p>

<p><button type="submit">Enregistrer</button></p>
```

{% endraw %}

#### `create.blade.php`

{% raw %}

```php
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Cr√©er un article</title></head>
<body>
<h1>Cr√©er un article</h1>
<form action="{{ route('articles.store') }}" method="post">
  @include('articles._form')
</form>
<p><a href="{{ route('articles.index') }}">‚Üê Retour</a></p>
</body>
</html>
```

{% endraw %}

#### `edit.blade.php`

{% raw %}

```php
<!doctype html>
<html>
<head><meta charset="utf-8"><title>√âditer un article</title></head>
<body>
<h1>√âditer : {{ $article->title }}</h1>
<form action="{{ route('articles.update', $article) }}" method="post">
  @method('PUT')
  @include('articles._form')
</form>
<p><a href="{{ route('articles.show', $article) }}">‚Üê Retour</a></p>
</body>
</html>
```

{% endraw %}

#### `show.blade.php`

{% raw %}

```php
<!doctype html>
<html>
<head><meta charset="utf-8"><title>{{ $article->title }}</title></head>
<body>
@if(session('success')) <p style="color:green">{{ session('success') }}</p> @endif

<h1>{{ $article->title }}</h1>
<p><em>Slug :</em> {{ $article->slug }}</p>
<p>{{ $article->excerpt }}</p>
<article>{!! nl2br(e($article->content)) !!}</article>

<p>
  <a href="{{ route('articles.edit',$article) }}">√âditer</a> |
  <a href="{{ route('articles.index') }}">Liste</a>
</p>
</body>
</html>
```

{% endraw %}

---

### √âtape 6 ‚Äî Test rapide

> D√©marrez le serveur et testez votre CRUD complet :

```bash
php artisan serve
```

> Puis ouvrez [http://localhost:8000/articles](http://localhost:8000/articles).

---

## üßæ R√©sum√© et points-cl√©s

* `Route::resource()` ‚Üí g√©n√®re 7 routes RESTful.
* `ArticleController` ‚Üí g√®re les actions CRUD.
* `$fillable` ‚Üí √©vite les erreurs de **mass assignment**.
* `with('success', ...)` ‚Üí affiche les **messages flash**.
* Vues simples mais fonctionnelles pour la d√©mo **N2**.

---

## ü©∫ D√©pannage courant

| Probl√®me                | Cause                       | Solution                                                         |
| ----------------------- | --------------------------- | ---------------------------------------------------------------- |
| 419 Page Expired        | Token CSRF manquant         | Ajouter `@csrf` dans chaque formulaire                           |
| Route non trouv√©e       | Mauvaise ressource d√©clar√©e | V√©rifier `Route::resource('articles', ArticleController::class)` |
| MassAssignmentException | `$fillable` absent          | D√©clarer `$fillable` dans le mod√®le                              |
| Slug dupliqu√©           | R√®gle `unique` trop stricte | Utiliser `Rule::unique(...)->ignore($article->id)`               |

---

## ‚úÖ Checklist

* [ ] Les 7 routes REST r√©pondent (`php artisan route:list`)
* [ ] Cr√©ation / √©dition / suppression fonctionnent
* [ ] Pagination active sur la liste
* [ ] Slug auto-g√©n√©r√© et unique

> üîú Chapitre suivant ‚Üí **2.1.4 Relations 1-n et n-n (pivots, `attach` / `sync`)**

