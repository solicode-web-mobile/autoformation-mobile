---
title: 3. Seeders & factories Eloquent
layout: home
nav_order: 3
parent: 2.1. SchÃ©ma & Eloquent
permalink: /schema-eloquent/seeders-factories/
code: 2.1.3
competence: C2
autoformation: "C2.1"
ua: "2.1.U2"
duree_h: 3
objectif: "GÃ©nÃ©rer automatiquement des donnÃ©es cohÃ©rentes et liÃ©es via les factories et seeders Eloquent (User â†’ Article â†” Tag)."
notions_nouvelles: ["Factory", "Seeder", "Faker", "firstOrCreate", "sync"]
fil_rouge: "Blog Laravel : gÃ©nÃ©ration de jeux de donnÃ©es cohÃ©rents (users, articles, tags, pivots)."
livrable_chapitre: "Factories + Seeders exÃ©cutables via DatabaseSeeder, testÃ©s dans Tinker."
alimentation_prototype: "Base de donnÃ©es rÃ©aliste pour les futures requÃªtes CRUD et API."
alimentation_miniprojet: "DonnÃ©es de test reproductibles avec relations cohÃ©rentes."
---

# ğŸ“˜ 2.1.3 â€” Seeders & Factories Eloquent

> â„¹ï¸ **PrÃ©requis :** les modÃ¨les et relations `User`, `Article`, `Tag` doivent dÃ©jÃ  Ãªtre dÃ©clarÃ©s (tutoriels 2.1.1 et 2.1.2).

---

## ğŸ“’ Glossaire minute

- **Factory** â†’ modÃ¨le de gÃ©nÃ©ration de fausses donnÃ©es rÃ©alistes (grÃ¢ce Ã  Faker).  
- **Seeder** â†’ script dâ€™initialisation de la base de donnÃ©es (insertion automatique).  
- **Faker** â†’ gÃ©nÃ©rateur intÃ©grÃ© de noms, emails, textes, dates alÃ©atoires.  
- **firstOrCreate()** â†’ crÃ©e une entrÃ©e seulement si elle nâ€™existe pas encore (idempotent).  
- **sync()** â†’ associe une liste dâ€™Ã©lÃ©ments dans une relation nâ€“n (`article â†” tags`).

---

## ğŸ¯ Objectif pÃ©dagogique

CrÃ©er des **factories et seeders** permettant de remplir automatiquement la base de donnÃ©es du **Blog Laravel** avec des donnÃ©es cohÃ©rentes :

1. GÃ©nÃ©rer des utilisateurs (`UserFactory`)  
2. GÃ©nÃ©rer des tags (`TagFactory`)  
3. GÃ©nÃ©rer des articles reliÃ©s Ã  un utilisateur (`ArticleFactory`)  
4. Associer les articles et les tags (`sync()` dans le seeder)  

---

## ğŸ§  DÃ©finition thÃ©orique

Les **factories** dÃ©finissent la *forme* des donnÃ©es Ã  gÃ©nÃ©rer.  
Les **seeders** orchestrent *lâ€™ordre et la quantitÃ©* dâ€™insertion.  
Ensemble, ils permettent de reconstituer une base complÃ¨te Ã  tout moment grÃ¢ce Ã  la commande :

```bash
php artisan migrate:fresh --seed
````

ğŸ’¡ Chaque modÃ¨le Eloquent peut avoir sa propre **factory** dans `database/factories`.

---

## ğŸ›  Tutoriel pratique

### ğŸ“ Structure du projet

```
database/
â”œâ”€ factories/
â”‚  â”œâ”€ UserFactory.php
â”‚  â”œâ”€ TagFactory.php
â”‚  â””â”€ ArticleFactory.php
â”œâ”€ seeders/
â”‚  â”œâ”€ DatabaseSeeder.php
â”‚  â”œâ”€ UserSeeder.php
â”‚  â”œâ”€ TagSeeder.php
â”‚  â”œâ”€ ArticleSeeder.php
â”‚  â””â”€ PivotArticleTagSeeder.php
```

---

### Ã‰tape 1 â€” CrÃ©er les factories

```bash
php artisan make:factory UserFactory --model=User
php artisan make:factory TagFactory --model=Tag
php artisan make:factory ArticleFactory --model=Article
```

---

#### ğŸ§© Exemple : `database/factories/UserFactory.php`

{% raw %}

```php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;

class UserFactory extends Factory
{
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => bcrypt('password'), // mot de passe par dÃ©faut
            'remember_token' => Str::random(10),
        ];
    }
}
```

{% endraw %}

---

#### ğŸ§© Exemple : `database/factories/TagFactory.php`

{% raw %}

```php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;

class TagFactory extends Factory
{
    public function definition(): array
    {
        $name = fake()->unique()->word();
        return [
            'name' => ucfirst($name),
            'slug' => Str::slug($name),
        ];
    }
}
```

{% endraw %}

---

#### ğŸ§© Exemple : `database/factories/ArticleFactory.php`

{% raw %}

```php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;
use App\Models\User;

class ArticleFactory extends Factory
{
    public function definition(): array
    {
        $title = fake()->unique()->sentence(4);
        return [
            'user_id' => User::inRandomOrder()->value('id') ?? 1,
            'title' => $title,
            'slug' => Str::slug($title),
            'excerpt' => fake()->sentence(12),
            'content' => fake()->paragraphs(3, true),
        ];
    }
}
```

{% endraw %}

---

### Ã‰tape 2 â€” CrÃ©er les seeders

```bash
php artisan make:seeder UserSeeder
php artisan make:seeder TagSeeder
php artisan make:seeder ArticleSeeder
php artisan make:seeder PivotArticleTagSeeder
```

---

#### ğŸ§© Exemple : `database/seeders/UserSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;

class UserSeeder extends Seeder
{
    public function run(): void
    {
        User::factory()->count(5)->create(); // 5 utilisateurs
    }
}
```

{% endraw %}

---

#### ğŸ§© Exemple : `database/seeders/TagSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Tag;

class TagSeeder extends Seeder
{
    public function run(): void
    {
        Tag::factory()->count(10)->create();
    }
}
```

{% endraw %}

---

#### ğŸ§© Exemple : `database/seeders/ArticleSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Article;

class ArticleSeeder extends Seeder
{
    public function run(): void
    {
        Article::factory()->count(20)->create();
    }
}
```

{% endraw %}

---

#### ğŸ§© Exemple : `database/seeders/PivotArticleTagSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Article;
use App\Models\Tag;

class PivotArticleTagSeeder extends Seeder
{
    public function run(): void
    {
        $tagIds = Tag::pluck('id');

        Article::all()->each(function ($article) use ($tagIds) {
            $article->tags()->sync($tagIds->random(rand(1, 4))->all());
        });
    }
}
```

{% endraw %}

---

### Ã‰tape 3 â€” Orchestration avec `DatabaseSeeder`

> Ce fichier regroupe tous les seeders dans le bon ordre dâ€™exÃ©cution.

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call([
            UserSeeder::class,
            TagSeeder::class,
            ArticleSeeder::class,
            PivotArticleTagSeeder::class,
        ]);
    }
}
```

{% endraw %}

---

### Ã‰tape 4 â€” ExÃ©cuter les seeders

> On vide et recharge complÃ¨tement la base :

```bash
php artisan migrate:fresh --seed
```

âœ… Vous devriez voir apparaÃ®tre dans la console :

```
Seeding: UserSeeder
Seeding: TagSeeder
Seeding: ArticleSeeder
Seeding: PivotArticleTagSeeder
```

---

### Ã‰tape 5 â€” VÃ©rification dans Tinker

```bash
php artisan tinker
```

```php
>>> App\Models\User::count();       // 5 utilisateurs
>>> App\Models\Article::count();    // 20 articles
>>> App\Models\Tag::count();        // 10 tags
>>> App\Models\Article::first()->tags->pluck('name');
>>> App\Models\User::first()->articles->count();
```

âœ… Toutes les relations devraient fonctionner.

---

## ğŸ“˜ Bonus â€” Rejouer seulement un seeder

> Pour exÃ©cuter un seul seeder :

```bash
php artisan db:seed --class=ArticleSeeder
```

> Pour combiner migration + seed dâ€™un module prÃ©cis :

```bash
php artisan migrate:fresh --seeder=DatabaseSeeder
```

---

## ğŸ§¾ RÃ©sumÃ© et points-clÃ©s

| Ã‰lÃ©ment            | RÃ´le                                          | Exemple                         |
| ------------------ | --------------------------------------------- | ------------------------------- |
| **Factory**        | DÃ©finit la structure des donnÃ©es fictives     | `TagFactory`                    |
| **Seeder**         | ExÃ©cute la crÃ©ation en base dans le bon ordre | `TagSeeder`                     |
| **DatabaseSeeder** | Centralise tous les seeders                   | `$this->call([...])`            |
| **Faker**          | Fournit des valeurs rÃ©alistes                 | `fake()->sentence()`            |
| **sync()**         | Associe des IDs dans une relation nâ€“n         | `$article->tags()->sync([...])` |

---

## ğŸ Livrable attendu

* Fichiers `UserFactory`, `TagFactory`, `ArticleFactory`.
* Fichiers `UserSeeder`, `TagSeeder`, `ArticleSeeder`, `PivotArticleTagSeeder`.
* VÃ©rification rÃ©ussie via **Tinker** (comptages, associations).
* Capture de la sortie de `php artisan migrate:fresh --seed`.

---

## ğŸ”— Suite du parcours

> Prochain chapitre â†’ **2.1.4 â€” RequÃªtes CRUD avec Eloquent**
> Vous apprendrez Ã  manipuler directement vos donnÃ©es (`create`, `read`, `update`, `delete`) depuis Tinker ou un script PHP.

