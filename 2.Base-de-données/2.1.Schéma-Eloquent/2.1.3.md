---
title: 3. CRUD basique
layout: home
nav_order: 3
parent: 2.1. Sch√©ma & Eloquent
permalink: /schema-eloquent-bases/2-1-3-crud-basique/
---

# üìò Chapitre 2.1.3 ‚Äî CRUD basique avec un mod√®le simple

## üìí Glossaire minute
- **CRUD** : op√©rations de base sur une ressource : *Create, Read, Update, Delete*.
- **Resource controller** : contr√¥leur Laravel dont les m√©thodes suivent la convention CRUD.
- **Resource route** : raccourci `Route::resource()` qui g√©n√®re les routes REST.
- **Route Model Binding** : injection automatique d‚Äôun mod√®le √† partir de l‚Äô`id` d‚ÄôURL.
- **Mass assignment** : remplissage massif d‚Äôattributs via `$fillable` ou `$guarded`.

## üéØ Objectif p√©dagogique
Mettre en place un **CRUD complet** pour `Article` : routes REST, contr√¥leur resource, vues Blade minimales, validation basique et messages de succ√®s.

## üß† D√©finition th√©orique
Laravel encourage un **flux MVC** clair :  
- **Mod√®le Eloquent** pour la persistance,  
- **Contr√¥leur resource** pour les actions CRUD,  
- **Vues** pour afficher formulaires et listes.  
`Route::resource('articles', ArticleController::class)` cr√©e 7 routes RESTful standard (`index`, `create`, `store`, `show`, `edit`, `update`, `destroy`).

---

## üîç Exemple appliqu√© au fil rouge
Ressource : **Article** (d√©j√† migr√©e au chapitre 2.1.1).  
On ajoute : **mod√®le**, **contr√¥leur** et **vues** pour g√©rer les articles (titre, slug, extrait, contenu).

---

## üõ† Tutoriel pratique

**Arborescence cible :**
```

app/
‚îú‚îÄ Models/
‚îÇ  ‚îî‚îÄ Article.php
app/Http/Controllers/
‚îÇ  ‚îî‚îÄ ArticleController.php
resources/views/articles/
‚îú‚îÄ index.blade.php
‚îú‚îÄ create.blade.php
‚îú‚îÄ edit.blade.php
‚îú‚îÄ show\.blade.php
‚îî‚îÄ \_form.blade.php
routes/
‚îî‚îÄ web.php

````

### √âtape 1 ‚Äî G√©n√©rer mod√®le & contr√¥leur

```bash
# Projet Laravel (app)
php artisan make:model Article
php artisan make:controller ArticleController --resource --model=Article

# Variante module (nWidart)
php artisan module:make-model Article PkgBlog
php artisan module:make-controller ArticleController PkgBlog --resource
````

### √âtape 2 ‚Äî Mod√®le `Article` (fillable + relation + slug auto)

```php
<?php
// app/Models/Article.php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Support\Str;

class Article extends Model
{
    use HasFactory;

    protected $fillable = ['user_id','title','slug','excerpt','content'];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    protected static function booted(): void
    {
        static::saving(function (Article $article) {
            if (blank($article->slug) && filled($article->title)) {
                $base = Str::slug($article->title);
                $try  = $base;
                $i    = 1;
                while (static::where('slug', $try)->whereKeyNot($article->getKey())->exists()) {
                    $try = $base.'-'.(++$i);
                }
                $article->slug = $try;
            }
        });
    }
}
```

### √âtape 3 ‚Äî Routes REST

```php
// routes/web.php
use App\Http\Controllers\ArticleController;

Route::resource('articles', ArticleController::class);
```

### √âtape 4 ‚Äî Contr√¥leur `ArticleController`

```php
<?php
namespace App\Http\Controllers;

use App\Models\Article;
use Illuminate\Http\Request;
use Illuminate\Validation\Rule;

class ArticleController extends Controller
{
    public function index()
    {
        $articles = Article::query()->latest('created_at')->paginate(10);
        return view('articles.index', compact('articles'));
    }

    public function create()
    {
        $article = new Article();
        return view('articles.create', compact('article'));
    }

    public function store(Request $request)
    {
        $data = $request->validate([
            'title'   => ['required','string','max:180'],
            'slug'    => ['nullable','string','max:200','unique:articles,slug'],
            'excerpt' => ['nullable','string'],
            'content' => ['nullable','string'],
        ]);

        $data['user_id'] = auth()->id() ?? 1;

        $article = Article::create($data);

        return redirect()
            ->route('articles.show', $article)
            ->with('success', 'Article cr√©√© avec succ√®s.');
    }

    public function show(Article $article)
    {
        return view('articles.show', compact('article'));
    }

    public function edit(Article $article)
    {
        return view('articles.edit', compact('article'));
    }

    public function update(Request $request, Article $article)
    {
        $data = $request->validate([
            'title'   => ['required','string','max:180'],
            'slug'    => ['nullable','string','max:200', Rule::unique('articles','slug')->ignore($article->id)],
            'excerpt' => ['nullable','string'],
            'content' => ['nullable','string'],
        ]);

        $article->update($data);

        return redirect()
            ->route('articles.show', $article)
            ->with('success', 'Article mis √† jour.');
    }

    public function destroy(Article $article)
    {
        $article->delete();

        return redirect()
            ->route('articles.index')
            ->with('success', 'Article supprim√©.');
    }
}
```

### √âtape 5 ‚Äî Vues Blade minimales

{% raw %}
```php
{{-- resources/views/articles/index.blade.php --}}
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Articles</title></head>
<body>
@if(session('success')) <p style="color:green">{{ session('success') }}</p> @endif

<h1>Articles</h1>
<p><a href="{{ route('articles.create') }}">Cr√©er</a></p>

<table border="1" cellpadding="6">
  <thead><tr><th>ID</th><th>Titre</th><th>Slug</th><th>Actions</th></tr></thead>
  <tbody>
  @foreach($articles as $a)
    <tr>
      <td>{{ $a->id }}</td>
      <td><a href="{{ route('articles.show',$a) }}">{{ $a->title }}</a></td>
      <td>{{ $a->slug }}</td>
      <td>
        <a href="{{ route('articles.edit',$a) }}">√âditer</a>
        <form action="{{ route('articles.destroy',$a) }}" method="post" style="display:inline">
          @csrf @method('DELETE')
          <button type="submit" onclick="return confirm('Supprimer ?')">Supprimer</button>
        </form>
      </td>
    </tr>
  @endforeach
  </tbody>
</table>

{{ $articles->links() }}
</body>
</html>
```
{% endraw %}


{% raw %}
```php
{{-- resources/views/articles/_form.blade.php --}}
@csrf
<p>
  <label>Titre<br>
    <input type="text" name="title" value="{{ old('title', $article->title) }}">
  </label>
  @error('title') <small style="color:red">{{ $message }}</small> @enderror
</p>

<p>
  <label>Slug (optionnel)<br>
    <input type="text" name="slug" value="{{ old('slug', $article->slug) }}">
  </label>
  @error('slug') <small style="color:red">{{ $message }}</small> @enderror
</p>

<p>
  <label>Extrait<br>
    <textarea name="excerpt" rows="3">{{ old('excerpt', $article->excerpt) }}</textarea>
  </label>
</p>

<p>
  <label>Contenu<br>
    <textarea name="content" rows="6">{{ old('content', $article->content) }}</textarea>
  </label>
</p>

<p><button type="submit">Enregistrer</button></p>
```
{% endraw %}

{% raw %}
```php
{{-- resources/views/articles/create.blade.php --}}
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Cr√©er un article</title></head>
<body>
<h1>Cr√©er un article</h1>
<form action="{{ route('articles.store') }}" method="post">
  @include('articles._form')
</form>
<p><a href="{{ route('articles.index') }}">‚Üê Retour</a></p>
</body>
</html>
```
{% endraw %}

{% raw %}
```php
{{-- resources/views/articles/edit.blade.php --}}
<!doctype html>
<html>
<head><meta charset="utf-8"><title>√âditer un article</title></head>
<body>
<h1>√âditer : {{ $article->title }}</h1>
<form action="{{ route('articles.update', $article) }}" method="post">
  @method('PUT')
  @include('articles._form')
</form>
<p><a href="{{ route('articles.show', $article) }}">‚Üê Retour</a></p>
</body>
</html>
```
{% endraw %}

{% raw %}
```php
{{-- resources/views/articles/show.blade.php --}}
<!doctype html>
<html>
<head><meta charset="utf-8"><title>{{ $article->title }}</title></head>
<body>
@if(session('success')) <p style="color:green">{{ session('success') }}</p> @endif

<h1>{{ $article->title }}</h1>
<p><em>Slug :</em> {{ $article->slug }}</p>
<p>{{ $article->excerpt }}</p>
<article>{!! nl2br(e($article->content)) !!}</article>

<p>
  <a href="{{ route('articles.edit',$article) }}">√âditer</a> |
  <a href="{{ route('articles.index') }}">Liste</a>
</p>
</body>
</html>
```
{% endraw %}

### √âtape 6 ‚Äî Test rapide

```bash
php artisan serve
# Naviguez vers /articles puis cr√©ez, √©ditez, supprimez.
```

---

## üßæ R√©sum√© et points-cl√©s

* `Route::resource()` g√©n√®re les **7 routes REST** standard.
* **Route Model Binding** simplifie le code (`Article $article` inject√©).
* Utiliser `$fillable` pour √©viter les **MassAssignmentException**.
* G√©rer les **messages flash** apr√®s `store/update/destroy`.

---

## ü©∫ D√©pannage (fr√©quents)

| Probl√®me                            | Cause                           | Solution                                                         |
| ----------------------------------- | ------------------------------- | ---------------------------------------------------------------- |
| 419 Page Expired                    | CSRF manquant                   | Ajouter `@csrf` dans chaque `<form>`                             |
| Route \[articles.index] not defined | Mauvaise d√©claration des routes | V√©rifier `Route::resource('articles', ArticleController::class)` |
| MassAssignmentException             | `$fillable` non d√©fini          | D√©finir `$fillable` ou `$guarded = []` en dev                    |
| Unique slug lors de l‚Äôupdate        | R√®gle `unique` stricte          | `Rule::unique(...)->ignore($article->id)`                        |

---

## ‚úÖ Checklist d‚Äôacceptation

* [ ] Les 7 routes REST r√©pondent (`php artisan route:list`).
* [ ] Cr√©ation/√©dition/suppression fonctionnent avec messages flash.
* [ ] Pagination OK sur la liste (10/pg).
* [ ] Slug auto-g√©n√©r√© si champ vide, **unique**.

> Prochain chapitre ‚Üí **2.1.4 Relations 1-n et n-n (pivots, `attach/sync`)**.


