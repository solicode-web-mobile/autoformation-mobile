---
title: 3. Seeders & factories Eloquent
layout: home
nav_order: 3
parent: 2.1. Schéma & Eloquent
permalink: /schema-eloquent/seeders-factories/
code: 2.1.3
competence: C2
autoformation: "C2.1"
ua: "2.1.U2"
duree_h: 3
objectif: "Générer automatiquement des données cohérentes et liées via les factories et seeders Eloquent (User → Article ↔ Tag)."
notions_nouvelles: ["Factory", "Seeder", "Faker", "firstOrCreate", "sync"]
fil_rouge: "Blog Laravel : génération de jeux de données cohérents (users, articles, tags, pivots)."
livrable_chapitre: "Factories + Seeders exécutables via DatabaseSeeder, testés dans Tinker."
alimentation_prototype: "Base de données réaliste pour les futures requêtes CRUD et API."
alimentation_miniprojet: "Données de test reproductibles avec relations cohérentes."
---

# 📘 2.1.3 — Seeders & Factories Eloquent

> ℹ️ **Prérequis :** les modèles et relations `User`, `Article`, `Tag` doivent déjà être déclarés (tutoriels 2.1.1 et 2.1.2).

---

## 📒 Glossaire minute

- **Factory** → modèle de génération de fausses données réalistes (grâce à Faker).  
- **Seeder** → script d’initialisation de la base de données (insertion automatique).  
- **Faker** → générateur intégré de noms, emails, textes, dates aléatoires.  
- **firstOrCreate()** → crée une entrée seulement si elle n’existe pas encore (idempotent).  
- **sync()** → associe une liste d’éléments dans une relation n–n (`article ↔ tags`).

---

## 🎯 Objectif pédagogique

Créer des **factories et seeders** permettant de remplir automatiquement la base de données du **Blog Laravel** avec des données cohérentes :

1. Générer des utilisateurs (`UserFactory`)  
2. Générer des tags (`TagFactory`)  
3. Générer des articles reliés à un utilisateur (`ArticleFactory`)  
4. Associer les articles et les tags (`sync()` dans le seeder)  

---

## 🧠 Définition théorique

Les **factories** définissent la *forme* des données à générer.  
Les **seeders** orchestrent *l’ordre et la quantité* d’insertion.  
Ensemble, ils permettent de reconstituer une base complète à tout moment grâce à la commande :

```bash
php artisan migrate:fresh --seed
````

💡 Chaque modèle Eloquent peut avoir sa propre **factory** dans `database/factories`.

---

## 🛠 Tutoriel pratique

### 📁 Structure du projet

```
database/
├─ factories/
│  ├─ UserFactory.php
│  ├─ TagFactory.php
│  └─ ArticleFactory.php
├─ seeders/
│  ├─ DatabaseSeeder.php
│  ├─ UserSeeder.php
│  ├─ TagSeeder.php
│  ├─ ArticleSeeder.php
│  └─ PivotArticleTagSeeder.php
```

---

### Étape 1 — Créer les factories

```bash
php artisan make:factory UserFactory --model=User
php artisan make:factory TagFactory --model=Tag
php artisan make:factory ArticleFactory --model=Article
```

---

#### 🧩 Exemple : `database/factories/UserFactory.php`

{% raw %}

```php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;

class UserFactory extends Factory
{
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => bcrypt('password'), // mot de passe par défaut
            'remember_token' => Str::random(10),
        ];
    }
}
```

{% endraw %}

---

#### 🧩 Exemple : `database/factories/TagFactory.php`

{% raw %}

```php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;

class TagFactory extends Factory
{
    public function definition(): array
    {
        $name = fake()->unique()->word();
        return [
            'name' => ucfirst($name),
            'slug' => Str::slug($name),
        ];
    }
}
```

{% endraw %}

---

#### 🧩 Exemple : `database/factories/ArticleFactory.php`

{% raw %}

```php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;
use App\Models\User;

class ArticleFactory extends Factory
{
    public function definition(): array
    {
        $title = fake()->unique()->sentence(4);
        return [
            'user_id' => User::inRandomOrder()->value('id') ?? 1,
            'title' => $title,
            'slug' => Str::slug($title),
            'excerpt' => fake()->sentence(12),
            'content' => fake()->paragraphs(3, true),
        ];
    }
}
```

{% endraw %}

---

### Étape 2 — Créer les seeders

```bash
php artisan make:seeder UserSeeder
php artisan make:seeder TagSeeder
php artisan make:seeder ArticleSeeder
php artisan make:seeder PivotArticleTagSeeder
```

---

#### 🧩 Exemple : `database/seeders/UserSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;

class UserSeeder extends Seeder
{
    public function run(): void
    {
        User::factory()->count(5)->create(); // 5 utilisateurs
    }
}
```

{% endraw %}

---

#### 🧩 Exemple : `database/seeders/TagSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Tag;

class TagSeeder extends Seeder
{
    public function run(): void
    {
        Tag::factory()->count(10)->create();
    }
}
```

{% endraw %}

---

#### 🧩 Exemple : `database/seeders/ArticleSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Article;

class ArticleSeeder extends Seeder
{
    public function run(): void
    {
        Article::factory()->count(20)->create();
    }
}
```

{% endraw %}

---

#### 🧩 Exemple : `database/seeders/PivotArticleTagSeeder.php`

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Article;
use App\Models\Tag;

class PivotArticleTagSeeder extends Seeder
{
    public function run(): void
    {
        $tagIds = Tag::pluck('id');

        Article::all()->each(function ($article) use ($tagIds) {
            $article->tags()->sync($tagIds->random(rand(1, 4))->all());
        });
    }
}
```

{% endraw %}

---

### Étape 3 — Orchestration avec `DatabaseSeeder`

> Ce fichier regroupe tous les seeders dans le bon ordre d’exécution.

{% raw %}

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call([
            UserSeeder::class,
            TagSeeder::class,
            ArticleSeeder::class,
            PivotArticleTagSeeder::class,
        ]);
    }
}
```

{% endraw %}

---

### Étape 4 — Exécuter les seeders

> On vide et recharge complètement la base :

```bash
php artisan migrate:fresh --seed
```

✅ Vous devriez voir apparaître dans la console :

```
Seeding: UserSeeder
Seeding: TagSeeder
Seeding: ArticleSeeder
Seeding: PivotArticleTagSeeder
```

---

### Étape 5 — Vérification dans Tinker

```bash
php artisan tinker
```

```php
>>> App\Models\User::count();       // 5 utilisateurs
>>> App\Models\Article::count();    // 20 articles
>>> App\Models\Tag::count();        // 10 tags
>>> App\Models\Article::first()->tags->pluck('name');
>>> App\Models\User::first()->articles->count();
```

✅ Toutes les relations devraient fonctionner.

---

## 📘 Bonus — Rejouer seulement un seeder

> Pour exécuter un seul seeder :

```bash
php artisan db:seed --class=ArticleSeeder
```

> Pour combiner migration + seed d’un module précis :

```bash
php artisan migrate:fresh --seeder=DatabaseSeeder
```

---

## 🧾 Résumé et points-clés

| Élément            | Rôle                                          | Exemple                         |
| ------------------ | --------------------------------------------- | ------------------------------- |
| **Factory**        | Définit la structure des données fictives     | `TagFactory`                    |
| **Seeder**         | Exécute la création en base dans le bon ordre | `TagSeeder`                     |
| **DatabaseSeeder** | Centralise tous les seeders                   | `$this->call([...])`            |
| **Faker**          | Fournit des valeurs réalistes                 | `fake()->sentence()`            |
| **sync()**         | Associe des IDs dans une relation n–n         | `$article->tags()->sync([...])` |

---

## 🎁 Livrable attendu

* Fichiers `UserFactory`, `TagFactory`, `ArticleFactory`.
* Fichiers `UserSeeder`, `TagSeeder`, `ArticleSeeder`, `PivotArticleTagSeeder`.
* Vérification réussie via **Tinker** (comptages, associations).
* Capture de la sortie de `php artisan migrate:fresh --seed`.

---

## 🔗 Suite du parcours

> Prochain chapitre → **2.1.4 — Requêtes CRUD avec Eloquent**
> Vous apprendrez à manipuler directement vos données (`create`, `read`, `update`, `delete`) depuis Tinker ou un script PHP.

