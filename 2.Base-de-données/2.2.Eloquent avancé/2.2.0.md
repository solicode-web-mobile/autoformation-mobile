---
title: 2.2. Eloquent avancÃ©
permalink: /eloquent-avance/
layout: home
nav_order: 2
parent: 2. Base-de-donnÃ©es
has_children: true
---

# ğŸ§© Eloquent avancÃ©, intÃ©gritÃ© & sÃ©curitÃ©

AprÃ¨s les bases (migrations, seeders, CRUD), place Ã  lâ€™**optimisation** et Ã  la **robustesse** : Ã©crire des requÃªtes plus **expressives et performantes**, protÃ©ger la **cohÃ©rence** avec des **transactions**, raisonner **index** & `EXPLAIN`, et adopter de bons rÃ©flexes **sÃ©curitÃ©** (sauvegardes, comptes & privilÃ¨ges).

## Pourquoi apprendre ces notions ?
- **LisibilitÃ© & maintenabilitÃ©** : `scopes`, `with()`, `withCount()` clarifient lâ€™intention mÃ©tier.  
- **Performance** : Ã©viter le **N+1**, choisir des **index** pertinents, interprÃ©ter un `EXPLAIN`.  
- **FiabilitÃ©** : transactions **ACID** avec `commit/rollback` pour des Ã©critures atomiques.  
- **SÃ©curitÃ© & exploitation** : **sauvegarde/restauration**, import/export **CSV**, **GRANT/REVOKE** (principe du moindre privilÃ¨ge).

## Objectifs de lâ€™autoformation
Ã€ la fin, vous saurez :
1. CrÃ©er des **scopes locaux/globaux** et Ã©crire des **requÃªtes imbriquÃ©es** propres.  
2. Utiliser `with`, `load`, `withCount`, `whereHas` pour **optimiser** les accÃ¨s.  
3. Encapsuler des opÃ©rations critiques dans des **transactions** (`DB::transaction`).  
4. Choisir/valider des **index** et **lire un `EXPLAIN`** simple pour diagnostiquer.  
5. **Sauvegarder/restaurer** la base (via `mysqldump`), **importer/exporter** des CSV.  
6. CrÃ©er des **utilisateurs MySQL** dÃ©diÃ©s et gÃ©rer leurs **privilÃ¨ges**.

## Ã€ qui sâ€™adresse ce module ?
Aux apprenants ayant terminÃ© **C2.1** (migrations, seeders, CRUD, relations) et souhaitant **industrialiser** leurs pratiques (API, projets dâ€™Ã©quipe, production).

---

## ğŸ”— Fil rouge (Blog Laravel)
Vous ferez Ã©voluer le **Blog Laravel** :  
- listes filtrÃ©es/triÃ©es via **scopes**,  
- chargements **eager** maÃ®trisÃ©s,  
- **transactions** lors de crÃ©ations multiples,  
- **index** ciblÃ©s (slug, FK, composites),  
- **dump/restore** et rÃ´le **lecture/Ã©criture** sÃ©parÃ© cÃ´tÃ© MySQL.

---

## ğŸ“˜ UnitÃ©s dâ€™apprentissage (UAs) couvertes

### UA 2.2.U1 â€“ Eloquent avancÃ©
- **Chapitre 2.2.1** : **Scopes** et requÃªtes complexes  
- **Chapitre 2.2.2** : Relations **imbriquÃ©es** & bonnes pratiques de requÃªtes

### UA 2.2.U2 â€“ Transactions & performance
- **Chapitre 2.2.3** : **Transactions ACID**, `commit/rollback`  
- **Chapitre 2.2.4** : **Index** ciblÃ©s & lecture dâ€™un **`EXPLAIN`** simple

### UA 2.2.U3 â€“ Exploitation & sÃ©curitÃ©
- **Chapitre 2.2.5** : **Sauvegarde/restauration** (`mysqldump`), **import/export CSV**  
- **Chapitre 2.2.6** : **Comptes & privilÃ¨ges** MySQL (**GRANT/REVOKE**)

---

## ğŸ§¾ Livrables attendus
- Scopes Eloquent rÃ©utilisables (`scopePublished`, `scopeSearch`, `scopeFilter`â€¦),  
- Pages/lists **sans N+1** (preuve : `->with()` et `->withCount()`),  
- Script/section **transactionnelle** testÃ©e (rollback contrÃ´lÃ©),  
- Jeu dâ€™**index** justifiÃ© + capture **`EXPLAIN`** sur 1 requÃªte clÃ©,  
- **Dump** SQL + **procÃ©dure** de restauration,  
- Script/notes **GRANT/REVOKE** pour un utilisateur applicatif.

---

## ğŸ§­ Pistes de vÃ©rification rapide
- Les listes chargent **constant-time** (pas dâ€™explosion de requÃªtes).  
- Un Ã©chec volontaire en milieu dâ€™opÃ©ration **nâ€™insÃ¨re rien** (rollback).  
- `EXPLAIN` utilise un **index** (colonne `key` non nulle, `rows` raisonnable).  
- Compte MySQL applicatif **non-root** avec **privilÃ¨ges minimaux**.

---

## âš ï¸ PiÃ¨ges frÃ©quents
- **N+1** silencieux â†’ oublier `with()` sur les relations affichÃ©es.  
- **Transactions** absentes sur des crÃ©ations multiples.  
- **Index** manquants sur colonnes de **jointure** / **WHERE** / **tri**.  
- Compte base de donnÃ©es **trop permissif** (risque dâ€™altÃ©ration involontaire).

> Prochaine Ã©tape : dÃ©marrez par **2.2.1 â€“ Scopes & requÃªtes complexes**.
