---
title: 2.2. Eloquent avancé
permalink: /eloquent-avance/
layout: home
nav_order: 2
parent: 2. Base-de-données
has_children: true
---

# 🧩 Eloquent avancé, intégrité & sécurité

Après les bases (migrations, seeders, CRUD), place à l’**optimisation** et à la **robustesse** : écrire des requêtes plus **expressives et performantes**, protéger la **cohérence** avec des **transactions**, raisonner **index** & `EXPLAIN`, et adopter de bons réflexes **sécurité** (sauvegardes, comptes & privilèges).

## Pourquoi apprendre ces notions ?
- **Lisibilité & maintenabilité** : `scopes`, `with()`, `withCount()` clarifient l’intention métier.  
- **Performance** : éviter le **N+1**, choisir des **index** pertinents, interpréter un `EXPLAIN`.  
- **Fiabilité** : transactions **ACID** avec `commit/rollback` pour des écritures atomiques.  
- **Sécurité & exploitation** : **sauvegarde/restauration**, import/export **CSV**, **GRANT/REVOKE** (principe du moindre privilège).

## Objectifs de l’autoformation
À la fin, vous saurez :
1. Créer des **scopes locaux/globaux** et écrire des **requêtes imbriquées** propres.  
2. Utiliser `with`, `load`, `withCount`, `whereHas` pour **optimiser** les accès.  
3. Encapsuler des opérations critiques dans des **transactions** (`DB::transaction`).  
4. Choisir/valider des **index** et **lire un `EXPLAIN`** simple pour diagnostiquer.  
5. **Sauvegarder/restaurer** la base (via `mysqldump`), **importer/exporter** des CSV.  
6. Créer des **utilisateurs MySQL** dédiés et gérer leurs **privilèges**.

## À qui s’adresse ce module ?
Aux apprenants ayant terminé **C2.1** (migrations, seeders, CRUD, relations) et souhaitant **industrialiser** leurs pratiques (API, projets d’équipe, production).

---

## 🔗 Fil rouge (Blog Laravel)
Vous ferez évoluer le **Blog Laravel** :  
- listes filtrées/triées via **scopes**,  
- chargements **eager** maîtrisés,  
- **transactions** lors de créations multiples,  
- **index** ciblés (slug, FK, composites),  
- **dump/restore** et rôle **lecture/écriture** séparé côté MySQL.

---

## 📘 Unités d’apprentissage (UAs) couvertes

### UA 2.2.U1 – Eloquent avancé
- **Chapitre 2.2.1** : **Scopes** et requêtes complexes  
- **Chapitre 2.2.2** : Relations **imbriquées** & bonnes pratiques de requêtes

### UA 2.2.U2 – Transactions & performance
- **Chapitre 2.2.3** : **Transactions ACID**, `commit/rollback`  
- **Chapitre 2.2.4** : **Index** ciblés & lecture d’un **`EXPLAIN`** simple

### UA 2.2.U3 – Exploitation & sécurité
- **Chapitre 2.2.5** : **Sauvegarde/restauration** (`mysqldump`), **import/export CSV**  
- **Chapitre 2.2.6** : **Comptes & privilèges** MySQL (**GRANT/REVOKE**)

---

## 🧾 Livrables attendus
- Scopes Eloquent réutilisables (`scopePublished`, `scopeSearch`, `scopeFilter`…),  
- Pages/lists **sans N+1** (preuve : `->with()` et `->withCount()`),  
- Script/section **transactionnelle** testée (rollback contrôlé),  
- Jeu d’**index** justifié + capture **`EXPLAIN`** sur 1 requête clé,  
- **Dump** SQL + **procédure** de restauration,  
- Script/notes **GRANT/REVOKE** pour un utilisateur applicatif.

---

## 🧭 Pistes de vérification rapide
- Les listes chargent **constant-time** (pas d’explosion de requêtes).  
- Un échec volontaire en milieu d’opération **n’insère rien** (rollback).  
- `EXPLAIN` utilise un **index** (colonne `key` non nulle, `rows` raisonnable).  
- Compte MySQL applicatif **non-root** avec **privilèges minimaux**.

---

## ⚠️ Pièges fréquents
- **N+1** silencieux → oublier `with()` sur les relations affichées.  
- **Transactions** absentes sur des créations multiples.  
- **Index** manquants sur colonnes de **jointure** / **WHERE** / **tri**.  
- Compte base de données **trop permissif** (risque d’altération involontaire).

> Prochaine étape : démarrez par **2.2.1 – Scopes & requêtes complexes**.
