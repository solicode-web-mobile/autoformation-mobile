---
title: 2. TLS/HTTPS
permalink: /deploiement/c7-3/tls-https-certificats/
layout: home
nav_order: 2
parent: Autoformation C7.3 â€” Serveur Web : principes & HTTP
---

# ğŸ“˜ Chapitre 7.3.2 â€” **TLS/HTTPS** (certificats â€” aperÃ§u)

## ğŸ“’ Glossaire minute
- **TLS** : couche de chiffrement au-dessus de TCP (successeur de SSL).  
- **Certificat X.509** : prouve lâ€™identitÃ© dâ€™un site (clÃ© **publique**, **sujet**, **SAN**, **validitÃ©**, **CA**).  
- **ClÃ© privÃ©e** : secrÃ¨te, cÃ´tÃ© serveur (ne jamais la partager).  
- **CA / ChaÃ®ne** : certificat **feuille** signÃ© par un **intermÃ©diaire**, lui-mÃªme signÃ© par une **racine**.  
- **SAN** (*Subject Alternative Name*) : liste des noms couverts par le certificat.  
- **SNI** : *Server Name Indication*, permet lâ€™hÃ©bergement multi-sites HTTPS.  
- **ALPN** : nÃ©gociation de protocole (ex. **h2** pour HTTP/2, **h3**/QUIC en UDP).  
- **OCSP stapling** : le serveur â€œagrafeâ€ la preuve de validitÃ© â†’ vÃ©rif plus rapide.  
- **HSTS** : force lâ€™usage dâ€™HTTPS cÃ´tÃ© client (en-tÃªte `Strict-Transport-Security`).  
- **DV/OV/EV** : niveaux de validation (Domaine / Organisation / Ã‰tendue).  
- **ACME** : protocole dâ€™Ã©mission auto (**Letâ€™s Encrypt** via `certbot`).

---

## ğŸ¯ Objectifs
- Comprendre **ce que sÃ©curise TLS** (chiffrement, intÃ©gritÃ©, authentification serveur).  
- Savoir **obtenir** un certificat (ACME/Letâ€™s Encrypt) et **installer** la chaÃ®ne.  
- Configurer un **vhost HTTPS** (Apache/Nginx) + **redirection** HTTPâ†’HTTPS.  
- Diagnostiquer les erreurs frÃ©quentes (nom, expiration, chaÃ®ne incomplÃ¨te, versions TLS).

## âœ… PrÃ©-requis
- C7.2 (LAN/DNS) â€¢ C7.3.1 (HTTP, headers) â€¢ Bases terminal.

---

## 1) TLS â€” Ã  quoi Ã§a sert ?
- ğŸ”’ **ConfidentialitÃ©** : trafic chifrÃ© (observateur ne lit pas).  
- âœ… **IntÃ©gritÃ©** : dÃ©tection dâ€™altÃ©ration.  
- ğŸªª **Authentification serveur** : certificat signÃ© par une **CA de confiance**.

```mermaid
sequenceDiagram
  participant B as Navigateur
  participant S as Serveur
  B->>S: ClientHello (versions, suites, SNI, ALPN)
  S-->>B: ServerHello + Certificat (+ OCSP stapling)
  Note over B,S: Ã‰change de clÃ©s â†’ secret partagÃ©
  B->>S: RequÃªte HTTPS (chiffrÃ©e)
  S-->>B: RÃ©ponse HTTPS (chiffrÃ©e)
````

> **Versions** : nâ€™utiliser que **TLS 1.2/1.3** ; dÃ©sactiver TLS 1.0/1.1.

---

## 2) Certificats â€” anatomie & formats

* **Champs clÃ©s** : *Subject* + **SAN** (les noms couverts), *Issuer*, *Not Before/After* (validitÃ©), *Key Usage*.
* **ChaÃ®ne** : `feuille` + `intermÃ©diaire(s)` + `racine` (dÃ©jÃ  connue du navigateur).
* **Formats** :

  * **PEM** (`.pem`, `.crt`, `.cer`) : ASCII base64.
  * **KEY** : clÃ© privÃ©e (PEM).
  * **PFX/P12** : conteneur binaire (clÃ© + cert + chaÃ®ne, protÃ©gÃ© par mot de passe).

ğŸ” **VÃ©rifier un cert**

```bash
openssl x509 -in fullchain.pem -noout -text | less
```

---

## 3) Types & cas dâ€™usage

* **DV (Domain Validation)** : le plus courant (Letâ€™s Encrypt), automatisable.
* **OV/EV** : vÃ©rifs lÃ©gales de lâ€™organisation (moindrement utilisÃ© pour projets pÃ©dagogiques).
* **Wildcard** `*.domaine.tld` : couvre tous les sous-domaines dâ€™un niveau.
* **Auto-signÃ©** : utile pour **tests internes** (non fiable cÃ´tÃ© navigateur).

---

## 4) Obtenir un certificat â€” **Letâ€™s Encrypt** (ACME)

### Debian/Ubuntu (Apache)

```bash
sudo apt update && sudo apt install -y certbot python3-certbot-apache
sudo certbot --apache -d exemple.tld -d www.exemple.tld
# crÃ©e/installe cert + fullchain + redirection HTTPS + renouvellement
```

### Debian/Ubuntu (Nginx)

```bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d exemple.tld -d www.exemple.tld
```

### Renouvellement

* UnitÃ© systemd/cron auto aprÃ¨s installation. Tester :

```bash
sudo certbot renew --dry-run
```

> **PrÃ©-requis** : DNS du domaine pointe sur le serveur ; port **80** (HTTP) et **443** (HTTPS) accessibles.

---

## 5) Config minimale â€” **Apache** (aperÃ§u)

```apache
<VirtualHost *:80>
  ServerName exemple.tld
  Redirect permanent / https://exemple.tld/
</VirtualHost>

<VirtualHost *:443>
  ServerName exemple.tld
  DocumentRoot /var/www/site/public

  SSLEngine on
  SSLCertificateFile      /etc/letsencrypt/live/exemple.tld/fullchain.pem
  SSLCertificateKeyFile   /etc/letsencrypt/live/exemple.tld/privkey.pem

  # HTTP/2
  Protocols h2 http/1.1

  # OCSP stapling (si chain fournie et conf validÃ©e)
  SSLUseStapling on
  SSLStaplingCache "shmcb:/var/run/ocsp(128000)"

  # SÃ©curitÃ© (basique)
  Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains"
</VirtualHost>
```

> Activer modules nÃ©cessaires : `a2enmod ssl headers http2` puis `systemctl reload apache2`.

---

## 6) Bonnes pratiques **HTTPS**

* ğŸ” **HTTPâ†’HTTPS** partout (301).
* ğŸ“… **Renouvellement auto** + alerte avant expiration.
* ğŸ§± **ChaÃ®ne complÃ¨te** (`fullchain.pem`) cÃ´tÃ© serveur.
* ğŸ§ª **Test** avec `curl -v https://domaine.tld/` et **DevTools** (onglet *Security*).
* ğŸ›¡ï¸ **HSTS** (progressif), **OCSP stapling**, versions **TLS 1.2/1.3** uniquement.

---

## 7) DÃ©pannage â€” erreurs frÃ©quentes

* **ERR\_CERT\_COMMON\_NAME\_INVALID** : le nom demandÃ© nâ€™est **pas** dans **SAN** â†’ regÃ©nÃ©rer cert.
* **Certificat expirÃ©** : renouvellement KO â†’ vÃ©rifier `certbot renew --dry-run`, permissions, cron/systemd.
* **ChaÃ®ne incomplÃ¨te** : certains clients refusent â†’ servir **fullchain** (feuille+intermÃ©diaires).
* **Protocole obsolÃ¨te** : TLS 1.0/1.1 â†’ dÃ©sactiver, forcer 1.2/1.3.
* **Horloge systÃ¨me** fausse â†’ invalide la vÃ©rification â†’ corriger NTP.
* **Mixed content** : page HTTPS charge ressources HTTP â†’ corriger URLs.

ğŸ”§ **Outils**

```bash
# Inspection rapide
curl -I -v https://exemple.tld
# DÃ©tails cert & chaÃ®ne
openssl s_client -connect exemple.tld:443 -servername exemple.tld -showcerts </dev/null
```

---

## 8) Mini-procÃ©dure de mise en place

1. âœ… DNS â†’ `A/AAAA` vers votre serveur.
2. âœ… Ports **80/443** ouverts (pare-feu/NAT).
3. ğŸ” `certbot` (Apache/Nginx) â†’ Ã©mission + **fullchain/privkey**.
4. ğŸŒ Redirection **HTTPâ†’HTTPS**, activer **HTTP/2**.
5. ğŸ§ª VÃ©rifier avec `curl -v`, navigateur, et un scanner (ex. *testssl.sh* cÃ´tÃ© admin).

---

## ğŸ§ª Exercices (avec attentes)

1. **Ã‰mettre** un cert DV Letâ€™s Encrypt pour `votre-domaine.tld` (ou un domaine de labo), activer la **redirection**.
2. **Afficher** les infos du cert (dates, SAN, CA) via `openssl x509 -in fullchain.pem -noout -text`.
3. **Diagnostiquer** une erreur â€œchaÃ®ne incomplÃ¨teâ€ et corriger la config (utiliser `fullchain.pem`).
4. **Activer** HSTS, vÃ©rifier la prÃ©sence de lâ€™en-tÃªte et expliquer le **risque** (verrouillage HTTPS).

## ğŸ“¦ Livrables attendus

* Extrait **vhost HTTPS** (Apache/Nginx) + sortie `curl -v`.
* Capture **openssl s\_client** (chaÃ®ne complÃ¨te) annotÃ©e.
* Note **opÃ©rations/renouvellement** (`certbot renew`) + mesures dâ€™alerte.

## âœ… Check-list (DoD)

* [ ] Mon site force **HTTPS** (301) et nâ€™accepte que **TLS 1.2/1.3**.
* [ ] Le certificat couvre **tous** les noms (**SAN**) et la **chaÃ®ne** est complÃ¨te.
* [ ] Le **renouvellement** est automatique et testÃ©.
* [ ] HSTS/OCSP stapling envisagÃ©s/activÃ©s ; **HTTP/2** opÃ©rationnel.
