---
title: 1. M√©thodes, codes, en-t√™tes, MIME
permalink: /deploiement/c7-3/methodes-codes-headers-mime/
layout: home
nav_order: 1
parent: Autoformation C7.3 ‚Äî Serveur Web : principes & HTTP
---

# üìò Chapitre 7.3.1 ‚Äî M√©thodes, codes, en-t√™tes, **MIME**

## üìí Glossaire minute
- **M√©thode HTTP** : verbe d‚Äôaction (`GET`, `POST`, `PUT`, `PATCH`, `DELETE`, `HEAD`, `OPTIONS`).
- **Idempotence** : r√©p√©ter la m√™me requ√™te produit le **m√™me effet** (`PUT`, `DELETE`‚Ä¶ pas `POST`).
- **S√ªret√© (safe)** : lecture **sans effet** c√¥t√© serveur (`GET`, `HEAD`, `OPTIONS`).
- **Code de statut** : r√©sultat de la requ√™te (familles `1xx`‚Äì`5xx`).
- **En-t√™te (header)** : m√©tadonn√©e de requ√™te/r√©ponse (auth, cache, CORS‚Ä¶).
- **MIME / Content-Type** : type du corps (`text/html`, `application/json`‚Ä¶).
- **N√©gociation de contenu** : le client indique ses pr√©f√©rences (`Accept`, `Accept-Language`).

---

## üéØ Objectifs
- Choisir la **m√©thode** adapt√©e et expliquer **idempotence/s√ªret√©**.
- Lire un **status code** et interpr√©ter la famille `2xx/3xx/4xx/5xx`.
- Inspecter/composer des **en-t√™tes** (cache, auth, CORS, type).
- S√©lectionner un **MIME type** correct et manipuler `curl` pour tester.

## ‚úÖ Pr√©-requis
- C7.2 (LAN, IP, DNS) ‚Ä¢ Savoir utiliser un terminal (`curl`).

---

## 1) M√©thodes HTTP ‚Äî aper√ßu & bonnes pratiques

| M√©thode | Safe | Idempotent | Usage typique | Exemple |
|---|:--:|:---:|---|---|
| `GET` | ‚úÖ | ‚úÖ | Lire une ressource | `GET /articles/42` |
| `HEAD` | ‚úÖ | ‚úÖ | En-t√™tes sans corps | `HEAD /assets/logo.png` |
| `OPTIONS` | ‚úÖ | ‚úÖ | Capacit√©s (CORS/preflight) | `OPTIONS /api/users` |
| `POST` | ‚ùå | ‚ùå | Cr√©er / action non idempotente | `POST /api/articles` |
| `PUT` | ‚ùå | ‚úÖ | Remplacer **enti√®rement** | `PUT /api/articles/42` |
| `PATCH` | ‚ùå | ‚ùå(souvent) | Mise √† jour **partielle** | `PATCH /api/articles/42` |
| `DELETE` | ‚ùå | ‚úÖ | Supprimer | `DELETE /api/articles/42` |

> **R√®gles** :  
> - `GET` n‚Äôa pas de **effet de bord** (pas de cr√©ation c√¥t√© serveur).  
> - `POST` cr√©e/agit ; `PUT` **remplace** ; `PATCH` modifie **partiellement**.  
> - `DELETE` peut renvoyer `204 No Content` si suppression r√©ussie.

---

## 2) Codes HTTP ‚Äî familles & cas courants

### 2.1 Familles
- `1xx` : Information (rare c√¥t√© app)
- `2xx` : Succ√®s (`200 OK`, `201 Created`, `204 No Content`)
- `3xx` : Redirection (`301`, `302`, `307/308`)
- `4xx` : Erreur **client** (`400`, `401`, `403`, `404`, `405`, `409`, `422`)
- `5xx` : Erreur **serveur** (`500`, `502`, `503`, `504`)

### 2.2 Tableau express
| Code | Signification | Quand l‚Äôutiliser |
|---:|---|---|
| **200** | OK | Lecture/Op√©ration r√©ussie (corps pr√©sent) |
| **201** | Created | Apr√®s `POST` **cr√©ation** (avec `Location` vers la ressource) |
| **204** | No Content | Action r√©ussie **sans corps** (ex. `DELETE`) |
| **301/308** | Redirection **permanente** | Changement d‚ÄôURL d√©finitif |
| **302/307** | Redirection **temporaire** | Maintenance, AB test |
| **400** | Bad Request | Corps JSON invalide, param√®tres manquants |
| **401** | Unauthorized | Authentification requise/√©chou√©e |
| **403** | Forbidden | Auth OK mais acc√®s refus√© |
| **404** | Not Found | Route/ressource inexistante |
| **405** | Method Not Allowed | `GET` sur une route qui n‚Äôaccepte que `POST` |
| **409** | Conflict | Doublon, √©tat incompatible |
| **422** | Unprocessable Content | Validation m√©tier √©chou√©e |
| **500** | Internal Server Error | Exception non g√©r√©e |
| **502/504** | Bad Gateway/Timeout | Proxy/Upstream indisponible |
| **503** | Service Unavailable | Surcharge/maintenance (pensez `Retry-After`) |

---

## 3) En-t√™tes (headers) ‚Äî indispensables

### 3.1 Requ√™te (client ‚Üí serveur)
- `Host`, `User-Agent`, `Accept`, `Accept-Language`, `Accept-Encoding`
- `Authorization: Bearer <token>` (auth)
- `Content-Type` (si corps) : `application/json`, `multipart/form-data`, `application/x-www-form-urlencoded`
- `If-None-Match` / `If-Modified-Since` (cache conditionnel)

### 3.2 R√©ponse (serveur ‚Üí client)
- **Type & longueur** : `Content-Type`, `Content-Length`
- **Cache** : `Cache-Control`, `ETag`, `Last-Modified`, `Expires`
- **Redirection** : `Location`
- **CORS** : `Access-Control-Allow-Origin`, `-Methods`, `-Headers`
- **S√©curit√©** (aper√ßu) : `Content-Security-Policy`, `X-Content-Type-Options: nosniff`, `Strict-Transport-Security` (HTTPS)

> **Cache conditionnel** : si le client envoie `If-None-Match: "<etag>"` et que rien n‚Äôa chang√©, le serveur r√©pond **`304 Not Modified`** (pas de corps ‚Üí gain de bande passante).

---

## 4) Types MIME ‚Äî choisir le bon `Content-Type`

| Cat√©gorie | MIME type | Exemple |
|---|---|---|
| HTML | `text/html; charset=UTF-8` | Pages web |
| CSS | `text/css` | Feuilles de style |
| JS | `application/javascript` | Scripts |
| JSON | `application/json` | API REST |
| Images | `image/png`, `image/jpeg`, `image/svg+xml`, `image/webp` | Assets |
| Fichiers | `application/pdf`, `application/zip` | Docs/archives |
| Formulaires | `application/x-www-form-urlencoded`, `multipart/form-data` | POST forms |

> **Charset** : pr√©cisez `charset=UTF-8` pour le texte (HTML/JSON peut aussi d√©clarer l‚Äôencodage via le corps, mais l‚Äôen-t√™te reste clair).

---

## 5) Exemples concrets

### 5.1 Requ√™te `GET` simple
```http
GET /articles/42 HTTP/1.1
Host: api.example.com
Accept: application/json
````

R√©ponse :

```http
HTTP/1.1 200 OK
Content-Type: application/json
ETag: "v3-42"

{"id":42,"title":"Hello","body":"World"}
```

### 5.2 Cr√©ation avec `POST` (JSON)

```bash
curl -i -X POST https://api.example.com/articles \
  -H "Content-Type: application/json" \
  -d '{"title":"Hello","body":"World"}'
```

R√©ponse id√©ale :

```http
HTTP/1.1 201 Created
Location: /articles/43
Content-Type: application/json

{"id":43,"title":"Hello","body":"World"}
```

### 5.3 Mise √† jour compl√®te vs partielle

```bash
# PUT remplace la ressource
curl -X PUT https://api.example.com/articles/43 \
  -H "Content-Type: application/json" \
  -d '{"title":"New","body":"All replaced"}'

# PATCH modifie partiellement
curl -X PATCH https://api.example.com/articles/43 \
  -H "Content-Type: application/json" \
  -d '{"title":"Only title changed"}'
```

### 5.4 Cache conditionnel (ETag)

```bash
# 1ere lecture
curl -i https://static.example.com/logo.png
# 2e lecture conditionnelle
curl -i https://static.example.com/logo.png \
  -H 'If-None-Match: "abc123"'
# ‚Üí HTTP/1.1 304 Not Modified (pas de corps)
```

### 5.5 N√©gociation de contenu

```bash
curl -H "Accept: application/json" https://api.example.com/ping
curl -H "Accept: text/html"        https://api.example.com/ping
```

---

## 6) `curl` ‚Äî mini cheatsheet

```bash
# En-t√™tes uniquement
curl -I https://example.com

# Verbose (voir handshake, headers)
curl -v https://example.com

# Suivre redirections
curl -IL https://example.com

# Envoyer JSON
curl -X POST https://api.ex.com/items \
  -H "Content-Type: application/json" \
  -d '{"name":"demo"}'

# Test CORS (preflight simul√©)
curl -i -X OPTIONS https://api.ex.com/items \
  -H "Origin: https://app.ex.com" \
  -H "Access-Control-Request-Method: POST"
```

---

## 7) Erreurs courantes & d√©pannages

* **`415 Unsupported Media Type`** : mauvais `Content-Type` (ex. JSON envoy√© sans `application/json`).
* **`400 Bad Request`** : JSON invalide (virgule/quotes) ‚Üí valider le corps.
* **`405 Method Not Allowed`** : route existe mais **m√©thode non accept√©e** ‚Üí v√©rifier la doc/API.
* **`301/302` en boucle** : redirections mal configur√©es (`Location`) ‚Üí tracer avec `-L -v`.
* **MIME incorrect** (ex. CSS servi en `text/plain`) ‚Üí navigateur ignore/console montre erreurs.

---

## üß™ Exercices (avec attentes)

1. **Lire** les en-t√™tes d‚Äôune page : `curl -I https://www.example.com` ‚Üí relever `Content-Type`, `Cache-Control`, `Server`.
2. **Cr√©er** une ressource via `POST` JSON ‚Üí v√©rifier `201` + `Location`.
3. **Tester** le cache conditionnel : r√©cup√©rer un `ETag`, refaire la requ√™te avec `If-None-Match` ‚Üí obtenir `304`.
4. **Simuler** une mauvaise m√©thode (`DELETE` sur une route `GET`) ‚Üí observer `405` + `Allow`.
5. **Corriger** un `415` en fixant `Content-Type` et le **JSON**.

## üì¶ Livrables attendus

* Captures (`curl -I/-v`) annot√©es.
* Tableau **code ‚Üí cause probable ‚Üí action** (‚â• 10 codes).
* Mini rapport ‚Äú**Tra√ßage d‚Äôune requ√™te**‚Äù (sympt√¥me ‚Üí headers ‚Üí statut ‚Üí correctif).

## ‚úÖ Check-list (DoD)

* [ ] Je sais choisir la **m√©thode** adapt√©e et expliquer **safe/idempotent**.
* [ ] J‚Äôinterpr√®te les **familles de codes** et j‚Äôen cite des cas typiques.
* [ ] Je lis/compose des **headers** utiles (cache, CORS, auth).
* [ ] Je d√©finis un **Content-Type** correct et j‚Äôutilise `curl` pour tester.
