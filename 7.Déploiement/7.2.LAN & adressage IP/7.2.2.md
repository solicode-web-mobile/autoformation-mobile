---
title: 2. Segmentation & port
permalink: /deploiement/vlan-ports/
layout: home
nav_order: 2
parent: 7.2. LAN & adressage IP
---

# 📘 Chapitre 7.2.2 — Segmentation (VLAN — aperçu) & notions de port

## 📒 Glossaire minute
- **VLAN (802.1Q)** : réseau **logique** isolé au sein d’un même switch (ex. VLAN10=Admin, VLAN20=Invités).  
- **Tag 802.1Q** : étiquette ajoutée à la trame Ethernet (contient l’**ID VLAN**).  
- **Port access** : appartient à **un seul VLAN** (trames **non taguées** côté PC).  
- **Port trunk** : transporte **plusieurs VLAN** (**tagués**) entre équipements (switch↔switch/routeur).  
- **PVID / VLAN natif** : VLAN appliqué aux **trames non taguées** qui arrivent sur le port.  
- **Inter-VLAN** : routage entre VLANs (via **routeur/L3**).  
- **Voice VLAN** : VLAN dédié téléphonie IP (QoS priorisée).  

---

## 🎯 Objectifs
- Comprendre la **segmentation** en VLAN et l’isolation des domaines de broadcast.  
- Distinguer **access vs trunk**, **tagged vs untagged**, **VLAN natif/PVID**.  
- Lire/dessiner un **schéma** VLAN simple et repérer les **ports** à configurer.  
- Identifier les **incidents courants** (VLAN mismatch, natif incohérent).

## ✅ Pré-requis
- 7.2.1 (switch/routeur, topologies). L’adressage sera pratiqué en **7.2.3**.

---

## 1) Pourquoi des VLANs ?
- **Isolation** : Admin ≠ Invités sur le **même switch**.  
- **Sécurité** : limiter la diffusion (broadcast), appliquer des règles **inter-VLAN** au niveau L3.  
- **Organisation** : regrouper par service/étage/usage sans recâbler.  

```mermaid
flowchart LR
  R[Routeur / L3]:::l3 -- Trunk 802.1Q --> S1[Switch]
  S1 -- VLAN10 (access) --> PC1[PC Admin]
  S1 -- VLAN20 (access) --> PC2[PC Invités]
classDef l3 fill:#efe,stroke:#3a3,stroke-width:1px;
````

---

## 2) Modes de port & marquage

* **Access (untagged)** : le port **présente** des trames **non taguées** au PC ; le switch **insère/retire** le tag **interne**.
* **Trunk (tagged)** : le port **garde** le tag pour transporter **plusieurs VLAN**.
* **VLAN natif / PVID** : sur un trunk, **un** VLAN (souvent 1) pour les trames **non taguées** (éviter d’y transporter du trafic sensible).

> **Règle simple** :
>
> * Vers un **poste** → **access** (1 VLAN).
> * Vers un **switch/routeur** → **trunk** (plusieurs VLAN).

---

## 3) Routage inter-VLAN (aperçu)

* Les VLANs sont **isolés** en L2. Pour communiquer, il faut un **routeur/L3** (souvent le cœur de réseau) :

  * **SVI** (interface VLAN sur un switch L3), ou
  * **Router-on-a-stick** (un lien trunk vers le routeur avec **sous-interfaces** par VLAN).

```mermaid
flowchart TB
  R[Routeur (sub-interfaces)]:::l3 -- Trunk --> S[Switch]
  S -- VLAN10 access --> A[PC Admin]
  S -- VLAN20 access --> G[PC Invités]
  R ---|VLAN10: 192.168.10.1| S
  R ---|VLAN20: 192.168.20.1| S
classDef l3 fill:#efe,stroke:#3a3,stroke-width:1px;
```

---

## 4) Exemples de configuration (génériques)

### 4.1 Linux (hôte tagué pour tests)

```bash
# Créer une interface VLAN 10 sur eth0
sudo ip link add link eth0 name eth0.10 type vlan id 10
sudo ip addr add 192.168.10.10/24 dev eth0.10
sudo ip link set eth0.10 up
```

### 4.2 Style “Cisco-like” (syntaxe indicative)

```text
# Déclarer les VLANs
vlan 10
 name ADMIN
vlan 20
 name INVITES

# Port vers un poste (access VLAN10)
interface Gi0/1
 switchport mode access
 switchport access vlan 10

# Trunk vers switch/routeur
interface Gi0/24
 switchport trunk encapsulation dot1q        # (selon plateforme)
 switchport mode trunk
 switchport trunk allowed vlan 10,20
 switchport trunk native vlan 1              # éviter trafic sensible sur natif
```

> Sur matériel réel, la syntaxe varie (Cisco, HP/Aruba, Mikrotik…). Retenez **les concepts**.

---

## 5) Incidents fréquents & correctifs

* **VLAN mismatch** (l’un en VLAN10, l’autre en VLAN20) → pas de connectivité : **aligner** VLANs/ports.
* **Natif incohérent** sur un trunk → fuites/erreurs de trafic **untagged** : **uniformiser** le VLAN natif ou éviter de l’utiliser.
* **Poste sur mauvais VLAN** (port access mal configuré) → IP/DHCP inattendus : corriger le **port access**.
* **Boucle L2** lors d’un ajout de lien → tempête de broadcast : **STP** actif (cf. 7.2.1) et design propre.

---

## 6) Bonnes pratiques express

* **Nommer** les VLANs (ADMIN, INVITES, VOICE…).
* **Documenter** : tableau *port ↔ VLAN/usage*.
* **Limiter** les VLANs **autorisés** sur chaque trunk (principe du moindre privilège).
* Éviter de transporter du trafic sensible sur le **VLAN natif**.
* **Étiqueter** prises/patchs et mettre à jour le **plan de brassage**.

---

## 🧪 Exercices (avec attentes)

1. **Cartographier** : listez les ports **access** et **trunk** d’un petit LAN (5–10 ports), indiquez les VLANs.
2. **Corriger** un **VLAN mismatch** : on vous donne 2 extrémités, expliquez quoi changer.
3. **Router-on-a-stick** (papier) : proposez les **sous-interfaces** côté routeur pour VLAN10/20 (IPs de passerelle).

## 📦 Livrables attendus

* Schéma VLAN (Mermaid ou image) + **tableau des ports** (mode, VLAN, description).
* Procédure de **validation** (pings intra-VLAN, DHCP/Statique, test inter-VLAN si présent).

## ✅ Check-list (DoD)

* [ ] Je sais quand configurer **access** vs **trunk**.
* [ ] Je comprends **tagged/untagged** et le rôle du **VLAN natif/PVID**.
* [ ] Je peux expliquer un **routage inter-VLAN** simple (SVI ou router-on-a-stick).
* [ ] J’identifie un **VLAN mismatch** et je propose un correctif.

> **Étape suivante :** **7.2.3 — IPv4, masque, CIDR, passerelle & DNS (aperçu)** pour adresser correctement vos VLANs.
