---
title: 6. netstat/ss, test de port, pare-feu de base
permalink: /deploiement/netstat-ss-tests-parefeu/
layout: home
nav_order: 6
parent: 7.2. LAN & adressage IP
---

# ğŸ“˜ Chapitre 7.2.6 â€” `netstat/ss`, test de port (`telnet`/`curl`), pare-feu de base

## ğŸ“’ Glossaire minute
- **Port** : point logique dâ€™un service TCP/UDP (ex. HTTP **80**, HTTPS **443**, SSH **22**).
- **Ã‰tat TCP** : `LISTEN`, `ESTABLISHED`, `TIME_WAIT`, `CLOSE_WAIT`â€¦
- **`netstat`** : outil historique pour connexions/ports (Windows/Linux â€” ancien).
- **`ss`** : remplaÃ§ant moderne de `netstat` sous Linux (plus rapide/prÃ©cis).
- **`telnet`** : client TCP â€œbrutâ€ utile pour **tester lâ€™ouverture** dâ€™un port.
- **`curl`** : client HTTP(s)/TCP gÃ©nÃ©rique pour **tester une URL/port**.
- **Pare-feu** : filtre rÃ©seau local (Windows Defender Firewall, `ufw`/`firewalld`).

---

## ğŸ¯ Objectifs
- Lister **qui Ã©coute** (ports `LISTEN`) et **qui communique** (`ESTABLISHED`) sur la machine.
- Tester lâ€™**ouverture dâ€™un port** local/distant et **qualifier** la panne (service down, port fermÃ©, filtrage).
- RÃ©aliser les **rÃ©glages de base** dâ€™un pare-feu (ouvrir/fermer un port, vÃ©rifier une rÃ¨gle).

## âœ… PrÃ©-requis
- 7.2.3 (IPv4/CIDR/GW/DNS) â€¢ 7.2.5 (ping/trace) â€¢ notions OS (cmd/PowerShell/Bash).

---

## 1) Voir les ports & connexions

### 1.1 Windows â€” `netstat`
```powershell
# Ports en Ã©coute + PID + rÃ©solution noms dÃ©sactivÃ©e (plus lisible)
netstat -ano -p tcp
# Filtrer un port (ex. 8080)
netstat -ano | findstr :8080
````

> Associer **PID â†’ Processus** : Gestionnaire des tÃ¢ches â†’ *DÃ©tails* (colonne PID).

**PowerShell (alternatif, moderne)**

```powershell
Get-NetTCPConnection | Sort-Object -Property State, LocalPort | Select-Object -First 20
# Ports en Ã©coute uniquement
Get-NetTCPConnection -State Listen
```

### 1.2 Linux/macOS â€” `ss` (prÃ©fÃ©rÃ©) / `netstat`

```bash
# LISTEN TCP avec programme (requires sudo pour voir tous les noms)
sudo ss -ltnp
# Connexions Ã©tablies
ss -tn state established
# Ports UDP Ã  l'Ã©coute
ss -lun
# Ancien (si dispo)
sudo netstat -lntp
```

**Lecture rapide**

* `LISTEN` = un service **attend** sur ce port.
* `ESTABLISHED` = une connexion **active**.
* `-n` = ne pas rÃ©soudre les noms (plus rapide).
* `-p` = afficher le **processus** (Linux).

---

## 2) Tester un port distant : `telnet` / `curl`

### 2.1 `telnet` (TCP brut)

```bash
# Linux/macOS (telnet installÃ©)
telnet 192.168.10.20 80
# Windows (activer "Client Telnet" si absent)
telnet 192.168.10.20 443
```

**InterprÃ©tation**

* Ã‰cran vide/connexion Ã©tablie â‡’ **port ouvert** (vous pouvez taper une requÃªte HTTP manuelle).
* Message dâ€™Ã©chec immÃ©diat â‡’ **port fermÃ©/host down**.
* Timeout â‡’ souvent **filtrÃ©** par un pare-feu.

### 2.2 `curl` (HTTP/S & tests TCP)

```bash
# Tester HTTP (en-tÃªtes uniquement)
curl -I http://192.168.10.20:80
# Tester HTTPS (voir handshake)
curl -v https://example.com:443/
# Tester un service TCP non-HTTP (banniÃ¨re si dispo)
curl telnet://192.168.10.20:25
```

> `curl -I` renvoie code **HTTP** + headers (200/301/403/503â€¦). TrÃ¨s utile pour qualifier le **service** derriÃ¨re le port.

**Bonus Windows (sans telnet)**

```powershell
# Test dâ€™un port TCP (remonte aussi route/latence)
Test-NetConnection 192.168.10.20 -Port 443
```

---

## 3) Pare-feu â€” bases indispensables

### 3.1 Windows Defender Firewall

```powershell
# Voir lâ€™Ã©tat global
Get-NetFirewallProfile | Select-Object Name, Enabled

# Lister rÃ¨gles qui ouvrent un port (ex. 8080)
Get-NetFirewallRule | ?{ $_.Enabled -eq 'True' } | Get-NetFirewallPortFilter | ?{ $_.LocalPort -eq 8080 }

# Ouvrir un port TCP entrant 8080 (profil privÃ©)
New-NetFirewallRule -DisplayName "App Web 8080" -Direction Inbound -Protocol TCP -LocalPort 8080 -Action Allow -Profile Private

# Supprimer la rÃ¨gle
Remove-NetFirewallRule -DisplayName "App Web 8080"
```

### 3.2 Linux â€” `ufw` (Ubuntu/Debian)

```bash
sudo ufw status verbose
sudo ufw allow 22/tcp        # SSH
sudo ufw allow 8080/tcp      # appli web locale
sudo ufw delete allow 8080/tcp
sudo ufw enable              # activer si inactif (avec prudence via accÃ¨s console)
```

### 3.3 Linux â€” `firewalld` (RHEL/CentOS/Alma)

```bash
sudo firewall-cmd --state
sudo firewall-cmd --add-port=8080/tcp --permanent
sudo firewall-cmd --reload
sudo firewall-cmd --list-ports
```

> ğŸ§© **RÃ¨gle dâ€™or** : dâ€™abord vÃ©rifier que **le service Ã©coute** (`ss/netstat`), ensuite tester **connectivitÃ©** (`telnet/curl`), enfin **adapter le pare-feu** si nÃ©cessaire.

---

## 4) ProcÃ©dure de diag â€œport fermÃ© ?â€ (5 Ã©tapes)

1. **Local** sur la machine serveur

   * `ss -ltnp` (Linux) / `netstat -ano` (Windows) â†’ le service **Ã©coute-t-il** sur le **bon port** et **bonne IP** (`0.0.0.0` ou IP attendue) ?
2. **Local â†’ Local**

   * `curl -I http://127.0.0.1:PORT` â†’ si **OK** ici, lâ€™appli tourne.
3. **Depuis un autre hÃ´te du mÃªme LAN**

   * `telnet IP_SERVEUR PORT` ou `curl -v http://IP_SERVEUR:PORT` â†’ si KO, suspecter **pare-feu** ou **route/VLAN**.
4. **Pare-feu**

   * Ouvrir le port (rÃ¨gle entrante) et **retester**.
5. **Chemin & NAT**

   * Si accÃ¨s depuis WAN : vÃ©rifier **redirection NAT**/port-forwarding et **traceroute** (7.2.5).

---

## 5) Cas frÃ©quents & correctifs

* **Service down / mauvais port** : `ss` ne montre pas `LISTEN` â†’ corriger la config app, relancer service.
* **Ã‰coute sur 127.0.0.1 uniquement** : accÃ¨s distant impossible â†’ lier Ã  `0.0.0.0` ou IP LAN.
* **Pare-feu bloque** : `curl` timeout alors que `ss` montre `LISTEN` â†’ ajouter rÃ¨gle (Windows/ufw/firewalld).
* **Port dÃ©jÃ  utilisÃ©** : conflit de PID (ex. autre service Ã©coute 80) â†’ changer port ou arrÃªter lâ€™autre service.
* **NAT manquant** (accÃ¨s externe) : port-forward sur routeur non configurÃ© â†’ ajouter redirection vers IP/LAN serveur.

---

## 6) Cheatsheet

### Lister Ã©coute & connexions

```bash
# Linux
sudo ss -ltnp           # Ã©coute TCP + programme
ss -tun state established
# Windows
netstat -ano | findstr LISTENING
Get-NetTCPConnection -State Listen
```

### Tests de port

```bash
telnet HOST 443
curl -I http://HOST:80
# Windows
Test-NetConnection HOST -Port 443
```

### Pare-feu

```bash
# Windows
New-NetFirewallRule -DisplayName "Open 8080" -Direction Inbound -Protocol TCP -LocalPort 8080 -Action Allow
# Ubuntu/Debian
sudo ufw allow 8080/tcp
# RHEL/CentOS
sudo firewall-cmd --add-port=8080/tcp --permanent && sudo firewall-cmd --reload
```

---

## ğŸ§ª Exercices (avec attentes)

1. **Identifier** quel processus Ã©coute sur `:8080` et donner son **PID** (Windows et Linux).
2. **Tester** lâ€™accÃ¨s Ã  `http://IP_SERVEUR:8080` depuis un autre poste (telnet/curl) et **conclure**.
3. **Ouvrir/fermer** le port 8080 sur votre pare-feu, **documenter** la rÃ¨gle, **retester**.
4. **Conflit de port** : simuler deux services sur 8080 â†’ corriger (changer port, vÃ©rifier Ã©coute).

## ğŸ“¦ Livrables attendus

* Journal de **diagnostic** (copies `ss/netstat`, `curl/telnet`, rÃ©glages pare-feu).
* Tableau **symptÃ´me â†’ cause â†’ commande â†’ correctif**.
* Mini-rapport â€œ**Port 8080 indisponible**â€ (analyse + actions).

## âœ… Check-list (DoD)

* [ ] Je sais **qui Ã©coute** et **oÃ¹** (`ss`/`netstat` + PID/processus).
* [ ] Je teste un **port** local/distant (`telnet`/`curl`) et jâ€™interprÃ¨te **ouvert/fermÃ©/filtrÃ©**.
* [ ] Je crÃ©e/supprime une **rÃ¨gle pare-feu** proprement (Windows/ufw/firewalld).
* [ ] Je mÃ¨ne une **procÃ©dure** en 5 Ã©tapes pour rÃ©soudre â€œport fermÃ©â€.

