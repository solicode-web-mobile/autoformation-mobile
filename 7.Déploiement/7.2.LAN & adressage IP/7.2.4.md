---
title: 4. DHCP statique/dynamique ; IPv6 (aper√ßu)
layout: home
nav_order: 4
parent: 7.2. LAN & adressage IP
permalink: /lan-ip/dhcp-ipv6/
code: 7.2.4
competence: C7
autoformation: "C7.2"
ua: "7.2.U2"
duree_h: 1.5
objectif: "Mettre en place DHCPv4 (pools, r√©servations, options), configurer un relay et comprendre SLAAC/DHCPv6."
notions_nouvelles: ["DHCP DORA", "Options 1/3/6/15/51", "R√©servation MAC‚ÜíIP", "DHCP Relay/Helper", "IPv6 SLAAC/DHCPv6", "ULA/GUA/Link-local"]
fil_rouge: "Attribution IP multi-VLAN via relay"
livrable_chapitre: "Plan DHCP (pools/r√©servations/options) + sch√©ma relay + journal release/renew"
alimentation_prototype: "Adressage automatique fiable"
alimentation_miniprojet: "Gestion des baux et IP stables pour √©quipements"
---


# üìò Chapitre 7.2.4 ‚Äî DHCP statique/dynamique ; IPv6 (aper√ßu)

## üìí Glossaire minute
- **DHCP (v4/v6)** : protocole qui **attribue automatiquement** IP/masque/GW/DNS (et autres options).  
- **Bail (lease)** : dur√©e d‚Äôattribution d‚Äôune adresse (ex. 8h, 24h, 7j).  
- **Pool/scope** : plage d‚Äôadresses servies par le DHCP.  
- **R√©servation** : IP fixe **li√©e √† une MAC** (imprimante, serveur).  
- **DHCP relay / helper** : routeur qui **relaye** les requ√™tes entre VLAN et serveur DHCP.  
- **SLAAC (IPv6)** : auto-config via **Router Advertisements** (sans DHCP).  
- **NDP** : voisinage IPv6 (arp-like). **DAD** : d√©tection de doublon.  
- **IPv6 types** : **link-local** `fe80::/10`, **ULA** `fc00::/7`, **GUA** `2000::/3`, **loopback** `::1/128`.

---

## üéØ Objectifs
- Mettre en place un **DHCPv4** (pools, r√©servations, options de base).  
- Comprendre le r√¥le d‚Äôun **relay** pour servir plusieurs VLANs.  
- Choisir entre **statique** (serveurs/√©quipements) et **dynamique** (postes).  
- Comprendre l‚Äô**auto-config IPv6 (SLAAC)** et l‚Äô**usage de DHCPv6** (aper√ßu).

## ‚úÖ Pr√©-requis
- 7.2.1 (switch/routeur, topologies) ‚Ä¢ 7.2.2 (VLAN/ports) ‚Ä¢ 7.2.3 (CIDR, GW, DNS).

---

## 1) DHCPv4 ‚Äî principes & options utiles
Un client envoie **DHCPDISCOVER**, le serveur r√©pond **DHCPOFFER**, puis **REQUEST/ACK**.

- **Pool (scope)** : `192.168.10.100‚Äì200`  
- **R√©servations** : lier `MAC ‚Üí IP` (ex. imprimante en `.50`)  
- **Dur√©e de bail** : courte (= souple pour salles de cours), longue (= moins de trafic).  
- **Options cl√©s** :
  - **1** : **Masque** (`255.255.255.0`)  
  - **3** : **Passerelle** (ex. `192.168.10.1`)  
  - **6** : **DNS** (ex. `192.168.10.10`, `1.1.1.1`)  
  - **15** : suffixe de **domaine** (ex. `lan.local`)  
  - **51** : **Lease time** (en secondes)

---

## 2) Servir plusieurs VLANs : **DHCP Relay**
Le **broadcast** DHCP ne traverse pas un routeur. On configure un **relay** (helper) sur l‚Äôinterface **L3** du VLAN pour **encapsuler** la requ√™te vers l‚ÄôIP du serveur DHCP.

```mermaid
flowchart LR
  subgraph VLAN10
    PC1[Client DHCP]
    SW1[Switch]
  end
  subgraph VLAN20
    PC2[Client DHCP]
  end
  R[Routeur L3\n(DHCP Relay)]:::l3
  D[Serveur DHCP]
  PC1--DISCOVER-->SW1--->R
  PC2--DISCOVER---------->R
  R==unicast UDP 67==>D
  D==OFFER/ACK==>R==>PC1 & PC2
classDef l3 fill:#efe,stroke:#3a3;
````

> Chaque interface L3 (SVI/sous-interface) qui doit √™tre servie par DHCP **doit** pointer vers le **serveur DHCP** (adresse helper).

---

## 3) Statique vs dynamique ‚Äî quand choisir ?

* **Statique recommand√©** : serveurs (Web/DB), √©quipements r√©seau, imprimantes critiques.
* **Dynamique** : postes apprenants, smartphones, IoT peu sensible.
* **R√©servation DHCP** = compromis : IP stable *mais* g√©r√©e par le serveur DHCP.

---

## 4) Commandes client (tests rapides)

### Windows

```powershell
ipconfig /all              # Voir bail et options
ipconfig /release
ipconfig /renew
```

### Linux

```bash
ip a                       # Voir IP en cours
sudo dhclient -r eth0      # Rel√¢cher le bail
sudo dhclient eth0         # Renouveler (NetworkManager : nmcli con up <profil>)
```

> Sympt√¥mes classiques : **APIPA** `169.254.x.x` (pas de DHCP), bail expir√©, conflit d‚ÄôIP.

---

## 5) Exemple de configuration **DHCPv4** (style ISC/dnsmasq)

### 5.1 ISC dhcpd (extrait p√©dagogique)

```conf
subnet 192.168.10.0 netmask 255.255.255.0 {
  range 192.168.10.100 192.168.10.200;
  option routers 192.168.10.1;           # GW (opt 3)
  option domain-name-servers 192.168.10.10, 1.1.1.1;  # DNS (opt 6)
  option domain-name "lan.local";        # (opt 15)
  default-lease-time 28800;  max-lease-time 86400;    # 8h / 24h
}

host imprimante01 {
  hardware ethernet 00:11:22:33:44:55;
  fixed-address 192.168.10.50;
}
```

### 5.2 Dnsmasq (l√©ger)

```conf
dhcp-range=192.168.10.100,192.168.10.200,255.255.255.0,8h
dhcp-option=3,192.168.10.1
dhcp-option=6,192.168.10.10,1.1.1.1
dhcp-host=00:11:22:33:44:55,192.168.10.50
```

---

## 6) IPv6 ‚Äî **aper√ßu** (SLAAC & DHCPv6)

* **Adressage** sur **128 bits**, notation hex s√©par√©e par `:` (ex. `2001:db8:abcd::42`).
* **Pr√©fixe** typique **/64** par LAN/VLAN.
* **SLAAC** (autoconf) : le routeur envoie des **RAs** (pr√©fixe/GW) ‚Üí le client se configure **tout seul**.
* **DHCPv6** : peut compl√©ter SLAAC (ex. **DNS**, domaine), ou fournir **√©tat** complet (stateful).
* **Types d‚Äôadresses** :

  * **Link-local** `fe80::/64` (obligatoire, local-lien)
  * **GUA** `2000::/3` (publique)
  * **ULA** `fdxx:.../48` (priv√©e site)
  * **Loopback** `::1/128`
* **Pas de NAT** en IPv6 dans la plupart des designs (on filtre par **pare-feu**).

### Outils/commandes

```bash
# Linux
ip -6 a
ip -6 route
ping6 2001:4860:4860::8888
# Windows
ping -6 ipv6.google.com
```

> **DNS IPv6** : enregistrements **AAAA** (en plus des **A** pour IPv4).

---

## 7) D√©pannage ‚Äî check rapide

* **DHCPv4** : client en `169.254.x.x` ? ‚Üí v√©rifier **relay**, **pool**, **exclusions**, **logs** serveur.
* **Conflit IP** : pings ARP non coh√©rents ‚Üí passer en **r√©servation** DHCP / fixer statiques uniques.
* **IPv6** : pas d‚Äôadresse `fe80::` ? ‚Üí interface down. Pas de GUA ? ‚Üí v√©rifier **RA**/pare-feu.
* **DNS** : nom r√©solu ? (`nslookup/dig`) sinon v√©rifier **Option 6** (v4) / params DHCPv6/SLAAC.

---

## üß™ Exercices (avec attentes)

1. **Concevoir** un pool pour `VLAN 30` : `192.168.30.50‚Äì190`, GW `.1`, DNS `192.168.10.10/1.1.1.1`, bail 12h.
2. **Ajouter** une **r√©servation** pour une MAC donn√©e en `.40`.
3. **Configurer** un **relay** (papier) pour 2 VLANs vers un serveur DHCP `192.168.10.10`.
4. **Tester** sur un poste : `release/renew`, v√©rifier l‚ÄôIP, la GW, le DNS.
5. **IPv6 (aper√ßu)** : relever `link-local`, tester `ping -6` et v√©rifier la pr√©sence d‚Äôun **AAAA**.

## üì¶ Livrables attendus

* Fichier **plan DHCP** (pools, r√©servations, options).
* Sch√©ma **relay** (Mermaid ou image) + explication.
* Journal de **tests client** (avant/apr√®s renouvellement, r√©solution DNS).

## ‚úÖ Check-list (DoD)

* [ ] Mes VLANs re√ßoivent une IP via **relay** correctement configur√©.
* [ ] Les **options 1/3/6/15** sont coh√©rentes ; **bail** adapt√© √† l‚Äôusage.
* [ ] Les √©quipements critiques ont **statique** ou **r√©servation**.
* [ ] IPv6 : je comprends **SLAAC vs DHCPv6**, je sais relever **link-local/GUA**.
