---
title: 1. Installation (Windows/Linux), service/systemctl
permalink: /deploiement/installation-service-systemctl/
layout: home
nav_order: 1
parent: 7.4. Apache
---

# 📘 Chapitre 7.4.1 — Installation (Windows/Linux), `service/systemctl`

## 📒 Glossaire minute
- **Apache HTTP Server (`httpd`)** : serveur Web libre (ports **80**/HTTP, **443**/HTTPS).  
- **Service** : programme de fond géré par l’OS (démarrage/arrêt/auto-start).  
- **`systemctl`** : outil Linux (systemd) pour piloter les services.  
- **Reload vs Restart** : *reload* relit la conf **sans couper** les connexions ; *restart* **redémarre** le processus.  
- **DocumentRoot** : dossier servi par défaut (`/var/www/html`, `htdocs\`…).  

---

## 🎯 Objectifs
- Installer Apache sur **Linux (Debian/Ubuntu, RHEL/Alma)** et **Windows**.  
- Démarrer/arrêter et **activer au boot** le service.  
- Vérifier l’**écoute** sur 80/443, tester avec `curl`, ouvrir le **pare-feu**.  
- Savoir **valider** la configuration et trouver les **logs**.

## ✅ Pré-requis
- Accès **admin** (sudo sur Linux, compte admin sur Windows).  
- Ports **80/443** **libres** (aucun autre service ne doit les utiliser).

---

## 1) Linux — Debian/Ubuntu (paquet `apache2`)
### 1.1 Installation
```bash
sudo apt update
sudo apt install -y apache2
````

**Chemins utiles**

* Conf : `/etc/apache2/` (vhosts en 7.4.2)
* DocumentRoot par défaut : `/var/www/html/`
* Logs : `/var/log/apache2/` (`access.log`, `error.log`)

### 1.2 Piloter le service

```bash
systemctl status apache2
sudo systemctl start apache2
sudo systemctl enable apache2      # au démarrage
sudo systemctl reload apache2      # relire la conf
sudo systemctl restart apache2
sudo apachectl -t                  # valider la conf
```

### 1.3 Pare-feu & vérifications

```bash
# Ouvrir HTTP/HTTPS (si UFW actif)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw status

# Écoute ports & test HTTP
sudo ss -ltnp '( sport = :80 or sport = :443 )'
curl -I http://localhost
```

> Page par défaut visible sur `http://<ip_serveur>/` (“Apache2 Ubuntu Default Page”).

---

## 2) Linux — RHEL/CentOS/Alma (paquet `httpd`)

### 2.1 Installation

```bash
sudo dnf install -y httpd
```

**Chemins utiles**

* Conf : `/etc/httpd/` (`conf/httpd.conf`, `conf.d/*.conf`)
* DocumentRoot par défaut : `/var/www/html/`
* Logs : `/var/log/httpd/` (`access_log`, `error_log`)

### 2.2 Piloter le service

```bash
systemctl status httpd
sudo systemctl enable --now httpd
sudo systemctl reload httpd
sudo systemctl restart httpd
sudo httpd -t                 # valider la conf
```

### 2.3 Pare-feu & vérifications

```bash
sudo firewall-cmd --add-service=http --permanent
sudo firewall-cmd --add-service=https --permanent
sudo firewall-cmd --reload

sudo ss -ltnp '( sport = :80 or sport = :443 )'
curl -I http://localhost
```

> Page “**It works!**” attendue sur `http://<ip_serveur>/`.

> ℹ️ **SELinux (aperçu)** : si l’appli doit joindre un service réseau (ex. DB), il pourra falloir autoriser :
> `sudo setsebool -P httpd_can_network_connect on`

---

## 3) Windows — XAMPP (recommandé pour débuter) **ou** Apache en service

### Option A — **XAMPP**

1. Installer **XAMPP** (Apache + PHP + outils).
2. Lancer **XAMPP Control Panel** → **Start** sur *Apache*.
3. **DocumentRoot** : `C:\xampp\htdocs\`
4. **Logs** : `C:\xampp\apache\logs\`
5. Test : `http://localhost/` (ou `curl -I http://localhost`)

> ⚠️ Si Apache ne démarre pas : conflit **port 80/443** (IIS, Skype…). Voir “Dépannage”.

### Option B — Apache “natif” en service (avancé)

* Installer un binaire Apache pour Windows.
* Installer le **service** :

```bat
httpd.exe -k install -n "Apache2.4"
net start Apache2.4
# Arrêt / suppression:
net stop Apache2.4
httpd.exe -k uninstall -n "Apache2.4"
```

* **services.msc** pour gérer le démarrage automatique.
* **Conf** : `conf\httpd.conf` ; **logs** : `logs\`.

### Pare-feu & port en usage

```powershell
# Ouvrir 80/443 (profil privé)
New-NetFirewallRule -DisplayName "HTTP 80" -Direction Inbound -Protocol TCP -LocalPort 80 -Action Allow -Profile Private
New-NetFirewallRule -DisplayName "HTTPS 443" -Direction Inbound -Protocol TCP -LocalPort 443 -Action Allow -Profile Private

# Voir qui utilise 80/443
netstat -ano | findstr :80
netstat -ano | findstr :443
```

---

## 4) Vérifications “post-install” (toutes plateformes)

* ✅ **Service actif** : `systemctl status …` / `services.msc` / XAMPP “Apache: Running”
* ✅ **Écoute 80/443** : `ss -ltnp` (Linux) / `netstat -ano` (Win)
* ✅ **Réponse HTTP** : `curl -I http://localhost` → `200/301`
* 🧱 **Pare-feu** : règles ajoutées pour 80/443
* 📜 **Logs** : accès/erreurs trouvés aux emplacements indiqués

---

## 5) Dépannage — cas fréquents

* **Port 80 occupé** → identifier le PID, arrêter/retirer le service en conflit (ex. **IIS** : “World Wide Web Publishing Service”).

  * Windows : `netstat -ano | findstr :80` → PID → *Gestionnaire des tâches* ou `sc stop W3SVC`
* **Pare-feu bloque** → ajouter règle (UFW/firewalld/Windows Defender).
* **Erreur de configuration** → `apachectl -t` / `httpd -t` indique la ligne fautive.
* **Page par défaut non atteignable** → vérifier **interface UP**, **route/GW** (C7.2.5), écoute sur `0.0.0.0`.
* **Permission (Linux)** → droits sur `/var/www/html` ; éviter `777` (cf. 7.3.4 pour bonnes pratiques).

---

## 🔧 Cheatsheet (Linux)

```bash
# Debian/Ubuntu
sudo apt install apache2
sudo systemctl enable --now apache2
sudo apachectl -t && sudo systemctl reload apache2
sudo ss -ltnp '( sport = :80 or sport = :443 )'
curl -I http://localhost

# RHEL/Alma
sudo dnf install httpd
sudo systemctl enable --now httpd
sudo httpd -t && sudo systemctl reload httpd
sudo firewall-cmd --add-service=http --add-service=https --permanent && sudo firewall-cmd --reload
```

---

## 🧪 Exercices (avec attentes)

1. **Installer** Apache (Linux **ou** Windows) et **prouver** l’accès à la page par défaut (capture + `curl -I`).
2. **Activer au boot** puis **redémarrer** la machine/VM → vérifier que le service **revient** tout seul.
3. **Changer** le **DocumentRoot** vers un dossier dédié (ex. `/var/www/site/public`), créer un `index.html`, **tester**.
4. **Bloquer puis autoriser** le port 80 via le pare-feu, **documenter** l’effet (KO/OK).

## 📦 Livrables attendus

* Journal d’installation (commandes/sorties) + captures de la **page par défaut**.
* Preuve **enable\@boot** (sortie `systemctl is-enabled` / services.msc).
* Extrait de conf **DocumentRoot** + test réussi.
* Règles **pare-feu** appliquées + tests `curl`.

## ✅ Check-list (DoD)

* [ ] Apache **installé** et **en service** ; **auto-start** configuré.
* [ ] Ports **80/443** ouverts et **testés** localement.
* [ ] `apachectl/httpd -t` **OK** ; logs identifiés.
* [ ] Pare-feu configuré ; page par défaut **accessible** sur le réseau local.
