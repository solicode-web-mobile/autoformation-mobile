---
title: 1. Installation (Windows/Linux), service/systemctl
permalink: /deploiement/installation-service-systemctl/
layout: home
nav_order: 1
parent: 7.4. Apache
---

# ğŸ“˜ Chapitre 7.4.1 â€” Installation (Windows/Linux), `service/systemctl`

## ğŸ“’ Glossaire minute
- **Apache HTTP Server (`httpd`)** : serveur Web libre (ports **80**/HTTP, **443**/HTTPS).  
- **Service** : programme de fond gÃ©rÃ© par lâ€™OS (dÃ©marrage/arrÃªt/auto-start).  
- **`systemctl`** : outil Linux (systemd) pour piloter les services.  
- **Reload vs Restart** : *reload* relit la conf **sans couper** les connexions ; *restart* **redÃ©marre** le processus.  
- **DocumentRoot** : dossier servi par dÃ©faut (`/var/www/html`, `htdocs\`â€¦).  

---

## ğŸ¯ Objectifs
- Installer Apache sur **Linux (Debian/Ubuntu, RHEL/Alma)** et **Windows**.  
- DÃ©marrer/arrÃªter et **activer au boot** le service.  
- VÃ©rifier lâ€™**Ã©coute** sur 80/443, tester avec `curl`, ouvrir le **pare-feu**.  
- Savoir **valider** la configuration et trouver les **logs**.

## âœ… PrÃ©-requis
- AccÃ¨s **admin** (sudo sur Linux, compte admin sur Windows).  
- Ports **80/443** **libres** (aucun autre service ne doit les utiliser).

---

## 1) Linux â€” Debian/Ubuntu (paquet `apache2`)
### 1.1 Installation
```bash
sudo apt update
sudo apt install -y apache2
````

**Chemins utiles**

* Conf : `/etc/apache2/` (vhosts en 7.4.2)
* DocumentRoot par dÃ©faut : `/var/www/html/`
* Logs : `/var/log/apache2/` (`access.log`, `error.log`)

### 1.2 Piloter le service

```bash
systemctl status apache2
sudo systemctl start apache2
sudo systemctl enable apache2      # au dÃ©marrage
sudo systemctl reload apache2      # relire la conf
sudo systemctl restart apache2
sudo apachectl -t                  # valider la conf
```

### 1.3 Pare-feu & vÃ©rifications

```bash
# Ouvrir HTTP/HTTPS (si UFW actif)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw status

# Ã‰coute ports & test HTTP
sudo ss -ltnp '( sport = :80 or sport = :443 )'
curl -I http://localhost
```

> Page par dÃ©faut visible sur `http://<ip_serveur>/` (â€œApache2 Ubuntu Default Pageâ€).

---

## 2) Linux â€” RHEL/CentOS/Alma (paquet `httpd`)

### 2.1 Installation

```bash
sudo dnf install -y httpd
```

**Chemins utiles**

* Conf : `/etc/httpd/` (`conf/httpd.conf`, `conf.d/*.conf`)
* DocumentRoot par dÃ©faut : `/var/www/html/`
* Logs : `/var/log/httpd/` (`access_log`, `error_log`)

### 2.2 Piloter le service

```bash
systemctl status httpd
sudo systemctl enable --now httpd
sudo systemctl reload httpd
sudo systemctl restart httpd
sudo httpd -t                 # valider la conf
```

### 2.3 Pare-feu & vÃ©rifications

```bash
sudo firewall-cmd --add-service=http --permanent
sudo firewall-cmd --add-service=https --permanent
sudo firewall-cmd --reload

sudo ss -ltnp '( sport = :80 or sport = :443 )'
curl -I http://localhost
```

> Page â€œ**It works!**â€ attendue sur `http://<ip_serveur>/`.

> â„¹ï¸ **SELinux (aperÃ§u)** : si lâ€™appli doit joindre un service rÃ©seau (ex. DB), il pourra falloir autoriser :
> `sudo setsebool -P httpd_can_network_connect on`

---

## 3) Windows â€” XAMPP (recommandÃ© pour dÃ©buter) **ou** Apache en service

### Option A â€” **XAMPP**

1. Installer **XAMPP** (Apache + PHP + outils).
2. Lancer **XAMPP Control Panel** â†’ **Start** sur *Apache*.
3. **DocumentRoot** : `C:\xampp\htdocs\`
4. **Logs** : `C:\xampp\apache\logs\`
5. Test : `http://localhost/` (ou `curl -I http://localhost`)

> âš ï¸ Si Apache ne dÃ©marre pas : conflit **port 80/443** (IIS, Skypeâ€¦). Voir â€œDÃ©pannageâ€.

### Option B â€” Apache â€œnatifâ€ en service (avancÃ©)

* Installer un binaire Apache pour Windows.
* Installer le **service** :

```bat
httpd.exe -k install -n "Apache2.4"
net start Apache2.4
# ArrÃªt / suppression:
net stop Apache2.4
httpd.exe -k uninstall -n "Apache2.4"
```

* **services.msc** pour gÃ©rer le dÃ©marrage automatique.
* **Conf** : `conf\httpd.conf` ; **logs** : `logs\`.

### Pare-feu & port en usage

```powershell
# Ouvrir 80/443 (profil privÃ©)
New-NetFirewallRule -DisplayName "HTTP 80" -Direction Inbound -Protocol TCP -LocalPort 80 -Action Allow -Profile Private
New-NetFirewallRule -DisplayName "HTTPS 443" -Direction Inbound -Protocol TCP -LocalPort 443 -Action Allow -Profile Private

# Voir qui utilise 80/443
netstat -ano | findstr :80
netstat -ano | findstr :443
```

---

## 4) VÃ©rifications â€œpost-installâ€ (toutes plateformes)

* âœ… **Service actif** : `systemctl status â€¦` / `services.msc` / XAMPP â€œApache: Runningâ€
* âœ… **Ã‰coute 80/443** : `ss -ltnp` (Linux) / `netstat -ano` (Win)
* âœ… **RÃ©ponse HTTP** : `curl -I http://localhost` â†’ `200/301`
* ğŸ§± **Pare-feu** : rÃ¨gles ajoutÃ©es pour 80/443
* ğŸ“œ **Logs** : accÃ¨s/erreurs trouvÃ©s aux emplacements indiquÃ©s

---

## 5) DÃ©pannage â€” cas frÃ©quents

* **Port 80 occupÃ©** â†’ identifier le PID, arrÃªter/retirer le service en conflit (ex. **IIS** : â€œWorld Wide Web Publishing Serviceâ€).

  * Windows : `netstat -ano | findstr :80` â†’ PID â†’ *Gestionnaire des tÃ¢ches* ou `sc stop W3SVC`
* **Pare-feu bloque** â†’ ajouter rÃ¨gle (UFW/firewalld/Windows Defender).
* **Erreur de configuration** â†’ `apachectl -t` / `httpd -t` indique la ligne fautive.
* **Page par dÃ©faut non atteignable** â†’ vÃ©rifier **interface UP**, **route/GW** (C7.2.5), Ã©coute sur `0.0.0.0`.
* **Permission (Linux)** â†’ droits sur `/var/www/html` ; Ã©viter `777` (cf. 7.3.4 pour bonnes pratiques).

---

## ğŸ”§ Cheatsheet (Linux)

```bash
# Debian/Ubuntu
sudo apt install apache2
sudo systemctl enable --now apache2
sudo apachectl -t && sudo systemctl reload apache2
sudo ss -ltnp '( sport = :80 or sport = :443 )'
curl -I http://localhost

# RHEL/Alma
sudo dnf install httpd
sudo systemctl enable --now httpd
sudo httpd -t && sudo systemctl reload httpd
sudo firewall-cmd --add-service=http --add-service=https --permanent && sudo firewall-cmd --reload
```

---

## ğŸ§ª Exercices (avec attentes)

1. **Installer** Apache (Linux **ou** Windows) et **prouver** lâ€™accÃ¨s Ã  la page par dÃ©faut (capture + `curl -I`).
2. **Activer au boot** puis **redÃ©marrer** la machine/VM â†’ vÃ©rifier que le service **revient** tout seul.
3. **Changer** le **DocumentRoot** vers un dossier dÃ©diÃ© (ex. `/var/www/site/public`), crÃ©er un `index.html`, **tester**.
4. **Bloquer puis autoriser** le port 80 via le pare-feu, **documenter** lâ€™effet (KO/OK).

## ğŸ“¦ Livrables attendus

* Journal dâ€™installation (commandes/sorties) + captures de la **page par dÃ©faut**.
* Preuve **enable\@boot** (sortie `systemctl is-enabled` / services.msc).
* Extrait de conf **DocumentRoot** + test rÃ©ussi.
* RÃ¨gles **pare-feu** appliquÃ©es + tests `curl`.

## âœ… Check-list (DoD)

* [ ] Apache **installÃ©** et **en service** ; **auto-start** configurÃ©.
* [ ] Ports **80/443** ouverts et **testÃ©s** localement.
* [ ] `apachectl/httpd -t` **OK** ; logs identifiÃ©s.
* [ ] Pare-feu configurÃ© ; page par dÃ©faut **accessible** sur le rÃ©seau local.
