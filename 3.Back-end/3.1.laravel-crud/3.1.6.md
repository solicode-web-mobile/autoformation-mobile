---
title: 6. CRUD & pagination
layout: home
nav_order: 6
parent: 3.1. CRUD avec Laravel
permalink: /laravel-crud/crud-pagination/
---

# üìò  3.1.6 - CRUD basique + pagination

## üìí Glossaire minute
- **Resource controller** : contr√¥leur g√©n√©r√© avec les m√©thodes REST (`index/create/store/edit/update/destroy`).
- **Mass assignment** : remplissage en masse via `Model::create($data)` (n√©cessite `$fillable`).
- **Route model binding** : injection automatique du mod√®le depuis l‚ÄôID (`Article $article`).
- **Method spoofing** : champs cach√©s `@method('PUT')` / `@method('DELETE')` dans les formulaires.
- **Pagination** : `paginate(n)` + `{{ $items->links() }}`.

---

## üéØ Objectif p√©dagogique
Livrer un **CRUD Article minimal** avec **pagination** c√¥t√© index :
- Routes REST,
- Contr√¥leur resource,
- Formulaires **create/edit**,
- **Store/Update/Delete** avec redirections et flash messages.

> üîó S‚Äôappuie sur **3.1.5** (mod√®le + migrations/seeders).

---

## ‚úÖ Pr√©-requis
- Projet Laravel configur√© (3.1.1)
- Table `articles` migr√©e + quelques donn√©es (3.1.5)
- Layout Blade de base (cf. 3.1.3)

---

## üß≠ √âtapes guid√©es

### 1) Routes
`routes/web.php`
```php
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\ArticleController;

// CRUD sans "show" pour rester minimal
Route::resource('articles', ArticleController::class)->except(['show']);
Route::get('/', fn() => redirect()->route('articles.index'));
````

### 2) Contr√¥leur resource

```bash
php artisan make:controller ArticleController --resource --model=Article
```

`app/Http/Controllers/ArticleController.php`

```php
<?php

namespace App\Http\Controllers;

use App\Models\Article;
use Illuminate\Support\Str;
use Illuminate\Http\RedirectResponse;
use Illuminate\View\View;
use App\Http\Requests\StoreArticleRequest;
use App\Http\Requests\UpdateArticleRequest;

class ArticleController extends Controller
{
    public function index(): View
    {
        $articles = Article::latest('id')->paginate(10);
        return view('articles.index', compact('articles'));
    }

    public function create(): View
    {
        return view('articles.create');
    }

    public function store(StoreArticleRequest $request): RedirectResponse
    {
        $data = $request->validated();
        // Slug par d√©faut + conversion tags "csv" -> array
        $data['slug'] ??= Str::slug($data['title']);
        $data['tags'] = array_values(array_filter(array_map('trim', explode(',', $data['tags'] ?? ''))));

        Article::create($data);

        return redirect()->route('articles.index')
            ->with('status', 'Article cr√©√© avec succ√®s.');
    }

    public function edit(Article $article): View
    {
        return view('articles.edit', compact('article'));
    }

    public function update(UpdateArticleRequest $request, Article $article): RedirectResponse
    {
        $data = $request->validated();
        $data['slug'] = $data['slug'] !== null && $data['slug'] !== ''
            ? $data['slug']
            : Str::slug($data['title']);
        $data['tags'] = array_values(array_filter(array_map('trim', explode(',', $data['tags'] ?? ''))));

        $article->update($data);

        return redirect()->route('articles.index')
            ->with('status', 'Article mis √† jour.');
    }

    public function destroy(Article $article): RedirectResponse
    {
        $article->delete();
        return redirect()->route('articles.index')
            ->with('status', 'Article supprim√©.');
    }
}
```

> Si tu n‚Äôas pas encore cr√©√© les **FormRequest**, voir ci-dessous.

### 3) R√®gles de validation (FormRequest)

```bash
php artisan make:request StoreArticleRequest
php artisan make:request UpdateArticleRequest
```

`app/Http/Requests/StoreArticleRequest.php`

```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class StoreArticleRequest extends FormRequest
{
    public function authorize(): bool { return true; }

    public function rules(): array
    {
        return [
            'title'   => ['required','string','min:3','max:150'],
            'slug'    => ['nullable','string','max:180','unique:articles,slug'],
            'excerpt' => ['nullable','string','max:255'],
            'content' => ['nullable','string'],
            'tags'    => ['nullable','string'], // "php, laravel"
        ];
    }
}
```

`app/Http/Requests/UpdateArticleRequest.php`

```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class UpdateArticleRequest extends FormRequest
{
    public function authorize(): bool { return true; }

    public function rules(): array
    {
        $id = $this->route('article')->id ?? null;

        return [
            'title'   => ['required','string','min:3','max:150'],
            'slug'    => ['nullable','string','max:180',"unique:articles,slug,{$id}"],
            'excerpt' => ['nullable','string','max:255'],
            'content' => ['nullable','string'],
            'tags'    => ['nullable','string'],
        ];
    }
}
```

### 4) Mod√®le (rappel)

`app/Models/Article.php`

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Article extends Model
{
    protected $fillable = ['title','slug','excerpt','content','tags'];
    protected $casts = ['tags' => 'array'];
}
```

### 5) Vues Blade (index, create, edit, formulaire partag√©)

`resources/views/articles/index.blade.php`

{% raw %}
```php
@extends('layouts.app')

@section('content')
  <h1 style="margin-bottom:1rem;">Articles</h1>

  @if (session('status'))
    <div style="padding:.5rem; background:#e6ffed; border:1px solid #86efac; margin-bottom:1rem;">
      {{ session('status') }}
    </div>
  @endif

  <div style="margin-bottom:1rem;">
    <a href="{{ route('articles.create') }}" style="padding:.5rem .8rem; background:#111; color:#fff; text-decoration:none;">+ Nouvel article</a>
  </div>

  <table style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th style="text-align:left; border-bottom:1px solid #ddd;">Titre</th>
        <th style="text-align:left; border-bottom:1px solid #ddd;">Slug</th>
        <th style="text-align:left; border-bottom:1px solid #ddd;">Actions</th>
      </tr>
    </thead>
    <tbody>
      @forelse ($articles as $a)
        <tr>
          <td style="padding:.4rem 0;">{{ $a->title }}</td>
          <td>{{ $a->slug }}</td>
          <td>
            <a href="{{ route('articles.edit', $a) }}">√âditer</a>
            <form action="{{ route('articles.destroy', $a) }}" method="POST" style="display:inline;">
              @csrf @method('DELETE')
              <button type="submit" onclick="return confirm('Supprimer ?')">Supprimer</button>
            </form>
          </td>
        </tr>
      @empty
        <tr><td colspan="3">Aucun article.</td></tr>
      @endforelse
    </tbody>
  </table>

  <div style="margin-top:1rem;">
    {{ $articles->links() }}
  </div>
@endsection
```
{% endraw %}

`resources/views/articles/_form.blade.php`

{% raw %}
```php
@csrf
<div style="margin-bottom:.75rem;">
  <label for="title">Titre *</label><br>
  <input id="title" name="title" type="text" value="{{ old('title', $article->title ?? '') }}" required style="width:100%;padding:.5rem;border:1px solid #ccc;">
  @error('title') <div style="color:#b91c1c;">{{ $message }}</div> @enderror
</div>

<div style="margin-bottom:.75rem;">
  <label for="slug">Slug</label><br>
  <input id="slug" name="slug" type="text" value="{{ old('slug', $article->slug ?? '') }}" style="width:100%;padding:.5rem;border:1px solid #ccc;">
  @error('slug') <div style="color:#b91c1c;">{{ $message }}</div> @enderror
</div>

<div style="margin-bottom:.75rem;">
  <label for="excerpt">Extrait</label><br>
  <input id="excerpt" name="excerpt" type="text" value="{{ old('excerpt', $article->excerpt ?? '') }}" style="width:100%;padding:.5rem;border:1px solid #ccc;">
  @error('excerpt') <div style="color:#b91c1c;">{{ $message }}</div> @enderror
</div>

<div style="margin-bottom:.75rem;">
  <label for="content">Contenu</label><br>
  <textarea id="content" name="content" rows="6" style="width:100%;padding:.5rem;border:1px solid #ccc;">{{ old('content', $article->content ?? '') }}</textarea>
  @error('content') <div style="color:#b91c1c;">{{ $message }}</div> @enderror
</div>

<div style="margin-bottom:1rem;">
  <label for="tags">Tags (s√©par√©s par des virgules)</label><br>
  <input id="tags" name="tags" type="text" value="{{ old('tags', isset($article) && is_array($article->tags ?? null) ? implode(', ', $article->tags) : '') }}" style="width:100%;padding:.5rem;border:1px solid #ccc;">
  @error('tags') <div style="color:#b91c1c;">{{ $message }}</div> @enderror
</div>
```
{% endraw %}

`resources/views/articles/create.blade.php`

{% raw %}
```php
@extends('layouts.app')

@section('content')
  <h1 style="margin-bottom:1rem;">Cr√©er un article</h1>
  <form method="POST" action="{{ route('articles.store') }}" novalidate>
    @include('articles._form')
    <button type="submit" style="padding:.6rem 1rem; border:0; background:#111; color:#fff;">Cr√©er</button>
  </form>
@endsection
```
{% endraw %}

`resources/views/articles/edit.blade.php`

{% raw %}
```php
@extends('layouts.app')

@section('content')
  <h1 style="margin-bottom:1rem;">√âditer : {{ $article->title }}</h1>
  <form method="POST" action="{{ route('articles.update', $article) }}" novalidate>
    @method('PUT')
    @include('articles._form', ['article' => $article])
    <button type="submit" style="padding:.6rem 1rem; border:0; background:#111; color:#fff;">Mettre √† jour</button>
  </form>
@endsection
```
{% endraw %}

---

## üîç V√©rification

* Index affiche les articles avec **liens pagination**.
* Create ‚Üí envoi valide ‚Üí redirection index + **flash** ‚Äúcr√©√©‚Äù.
* Edit/Update ‚Üí redirection index + **flash** ‚Äúmis √† jour‚Äù.
* Delete ‚Üí suppression + **flash** ‚Äúsupprim√©‚Äù.

---

## üß™ Erreurs fr√©quentes & correctifs

* **MassAssignmentException** : ajouter les champs √† `$fillable` dans le mod√®le.
* **`unique` sur `slug` en update** : utiliser la r√®gle avec **exclusion de l‚ÄôID** (cf. `UpdateArticleRequest`).
* **Pagination non affich√©e** : v√©rifier `{{ $articles->links() }}` et que la collection est un **Paginator** (`paginate()` et non `get()`).

---

## üß© Int√©gration fil rouge

* Ce CRUD constitue **Blog v1** (interface basique).
* En **C3.2**, on exposera les m√™mes articles en **API**.
* En **C3.3**, on ajoutera **auth**, **policies** et un **format d‚Äôerreur** standard.

---

## üßæ R√©sum√©

* Routes **resource** + contr√¥leur **resource**,
* FormRequests pour la **validation**,
* Vues **create/edit** avec un **form partial**,
* Index pagin√© via `paginate(10)`.

**Livrable attendu** : un CRUD complet `Article` avec pagination op√©rationnelle et messages de confirmation.

