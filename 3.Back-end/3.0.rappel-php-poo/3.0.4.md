---
title: 4. Classes
layout: home
nav_order: 4
parent: 3.0. Rappel PHP & POO
permalink: /php-poo//classes-proprietes-constructeur/
---

# üìò  3.0.4 - Classes, propri√©t√©s typ√©es, constructeur & promotion

## üìí Glossaire minute
- **Classe** : plan de construction d‚Äôobjets (donn√©es + comportements).
- **Propri√©t√© typ√©e** : variable d‚Äôinstance avec **type d√©clar√©** (ex. `public int $id;`).
- **Constructeur** : m√©thode sp√©ciale `__construct(...)` ex√©cut√©e **√† la cr√©ation** de l‚Äôobjet.
- **Promotion de propri√©t√©s** : syntaxe **courte** dans le constructeur pour **d√©clarer + typer + initialiser** les propri√©t√©s en un seul endroit.
- **Nullable** : type **optionnel** autorisant `null`, ex. `?string`.

---

## üéØ Objectif p√©dagogique
Savoir **mod√©liser** une entit√© m√©tier simple (ex. `Article`) avec des **propri√©t√©s typ√©es**, un **constructeur** propre et la **promotion** pour r√©duire le code, tout en garantissant **l‚Äôinitialisation** correcte (pas de propri√©t√©s non initialis√©es).

---

## üß† D√©finition th√©orique (avec mini-exemples)

### 1) Classe avec propri√©t√©s typ√©es (sans promotion)
```php
<?php
declare(strict_types=1);

class Article {
    public int $id;
    public string $title;
    public ?string $excerpt = null; // nullable avec valeur par d√©faut
    public int $views = 0;

    public function __construct(int $id, string $title) {
        // ‚ö†Ô∏è Propri√©t√©s typ√©es : doivent √™tre initialis√©es avant usage
        $this->id = $id;
        $this->title = $title;
    }

    public function incrementViews(int $delta = 1): void {
        $this->views += max(0, $delta);
    }
}

$a = new Article(1, 'Intro Laravel');
$a->incrementViews();
````

### 2) Promotion de propri√©t√©s (PHP ‚â• 8.0)

```php
<?php
declare(strict_types=1);

class Article {
    public function __construct(
        public int $id,
        public string $title,
        public ?string $excerpt = null,
        public int $views = 0,       // valeur par d√©faut
    ) {}

    public function slug(): string {
        $s = strtolower($this->title);
        $s = preg_replace('/[^a-z0-9]+/i', '-', $s);
        return trim($s, '-');
    }
}

$a = new Article(id: 2, title: 'PHP 8 en pratique', views: 300); // arguments nomm√©s
```

### 3) Visibilit√©, `readonly` (immutabilit√© simple) et types compos√©s

```php
<?php
declare(strict_types=1);

class Category {
    // Lecture seule apr√®s construction (PHP ‚â• 8.1)
    public function __construct(
        public readonly string $name,
        public readonly ?string $color = null,
    ) {}
}

$cat = new Category('php', '#8892BF');
// $cat->name = 'autre'; // ‚ùå Erreur : propri√©t√© readonly
```

> ‚ÑπÔ∏è **Bonnes pratiques**
>
> * Pr√©f√©rez des **types explicites** et des **valeurs par d√©faut** raisonnables.
> * Utilisez `?Type` si la valeur peut √™tre **absente** (`null`).
> * Gardez les invariants m√©tier dans le constructeur (ex. normaliser le titre).

---

## üõ†Ô∏è Tutoriel guid√© (pas √† pas)

### Jeu de donn√©es (tableau associatif ‚Üí objet)

```php
<?php
declare(strict_types=1);

$raw = [
  ['id'=>1,'title'=>'Intro Laravel','excerpt'=>null,'views'=>120],
  ['id'=>2,'title'=>'PHP 8 en pratique','excerpt'=>'Tour des nouveaut√©s','views'=>300],
  ['id'=>3,'title'=>'Composer & Autoload','excerpt'=>null,'views'=>90],
];
```

### √âtape 1 ‚Äî Mod√©liser `Article` avec promotion

```php
<?php
class Article {
    public function __construct(
        public int $id,
        public string $title,
        public ?string $excerpt = null,
        public int $views = 0,
    ) {}

    public function slug(): string {
        $s = strtolower($this->title);
        $s = preg_replace('/[^a-z0-9]+/i', '-', $s);
        return trim($s, '-');
    }

    public function toArray(): array {
        return [
            'id'      => $this->id,
            'title'   => $this->title,
            'excerpt' => $this->excerpt,
            'views'   => $this->views,
            'slug'    => $this->slug(),
        ];
    }
}
```

### √âtape 2 ‚Äî Fabrique statique : `fromArray(array): self`

```php
<?php
class ArticleFactory {
    public static function fromArray(array $a): Article {
        // Valeurs par d√©faut + contr√¥les simples
        $id      = (int)($a['id'] ?? 0);
        $title   = trim((string)($a['title'] ?? 'Sans titre'));
        $excerpt = isset($a['excerpt']) ? (string)$a['excerpt'] : null;
        $views   = (int)($a['views'] ?? 0);

        return new Article($id, $title, $excerpt, $views);
    }
}
```

### √âtape 3 ‚Äî Mapper un tableau d‚Äôentr√©es vers des objets

```php
<?php
$articles = array_map(
  fn(array $a) => ArticleFactory::fromArray($a),
  $raw
);

// Afficher un mini-rapport
foreach ($articles as $art) {
    $data = $art->toArray();
    echo "- {$data['title']} ({$data['views']} vues) ‚Äî slug: {$data['slug']}\n";
}
```

---

## üß™ Exercice guid√© (livrable N1)

> **But** : cr√©er la classe **`User`** avec **promotion**, repr√©sentant un auteur du blog.
>
> **Sp√©cifications**
>
> * Propri√©t√©s :
>
>   * `int $id`, `string $name`, `string $email`, `?string $bio = null`, `int $articlesCount = 0`
> * M√©thodes :
>
>   * `public function initials(): string` ‚Üí renvoie les initiales en **MAJUSCULE** (ex. *"Amina Zouhair"* ‚Üí `"AZ"`).
>   * `public function toArray(): array`
> * Fabrique : `UserFactory::fromArray(array $u): User` (contr√¥les simples : `id>=1`, `email` non vide).
> * Donn√©es d‚Äôentr√©e : tableau d‚Äôauteurs (similaire √† `$raw`).
> * **Affichage** : pour chaque auteur, `name`, `initials`, `articlesCount`.

### (Corrig√© indicatif)

```php
<?php
declare(strict_types=1);

class User {
    public function __construct(
        public int $id,
        public string $name,
        public string $email,
        public ?string $bio = null,
        public int $articlesCount = 0,
    ) {}

    public function initials(): string {
        $parts = preg_split('/\s+/', trim($this->name));
        $letters = array_map(fn($p) => mb_strtoupper(mb_substr($p, 0, 1)), $parts);
        return implode('', $letters);
    }

    public function toArray(): array {
        return [
            'id'            => $this->id,
            'name'          => $this->name,
            'email'         => $this->email,
            'bio'           => $this->bio,
            'articlesCount' => $this->articlesCount,
            'initials'      => $this->initials(),
        ];
    }
}

class UserFactory {
    public static function fromArray(array $u): User {
        $id    = max(1, (int)($u['id'] ?? 0));
        $name  = trim((string)($u['name'] ?? 'Inconnu'));
        $email = trim((string)($u['email'] ?? ''));
        if ($email === '') {
            throw new InvalidArgumentException('email requis');
        }
        $bio   = isset($u['bio']) ? (string)$u['bio'] : null;
        $count = (int)($u['articlesCount'] ?? 0);

        return new User($id, $name, $email, $bio, $count);
    }
}
```

---

## ‚ö†Ô∏è Erreurs fr√©quentes

* **Propri√©t√© typ√©e non initialis√©e** : toujours **donner une valeur** par d√©faut ou l‚Äôinitialiser dans `__construct`.
* Oublier le **`?`** pour une propri√©t√© pouvant √™tre `null` ‚Üí erreurs de type.
* M√©langer responsabilit√©s : validations lourdes dans la classe **au lieu** d‚Äôune **fabrique** d√©di√©e.
* Confondre **visibilit√©** (`public`/`protected`/`private`) : commencez simple (`public`) puis **resserrez** si besoin.
* Utiliser `readonly` l√† o√π des **mutations l√©gitimes** sont attendues (ex. compteur de vues).

---

## üßæ R√©sum√©

* Les **propri√©t√©s typ√©es** rendent les mod√®les plus **s√ªrs** et **clairs**.
* Le **constructeur** garantit des **invariants** d‚Äôinitialisation.
* La **promotion** r√©duit le **bruit** et aligne la d√©claration des propri√©t√©s avec leurs **param√®tres**.
* Fabriques (`fromArray`) = meilleur endroit pour **hydrater** proprement depuis des tableaux/JSON.

---

## üîó Lien fil rouge & suite

Ce mod√®le d‚Äôentit√©s (`Article`, `User`) sert de base pour g√©n√©rer des **seeds JSON** (C3.0.8) et pr√©parer l‚ÄôORM **Eloquent** (C3.2).
Prochain chapitre : **3.0.5 Encapsulation & visibilit√©, `readonly`, `static`** (affiner la robustesse des mod√®les).
