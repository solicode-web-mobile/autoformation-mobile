---
title: 1. Types & syntaxe utiles
layout: home
nav_order: 1
parent: 3.0. Rappel PHP & POO
permalink: /php-poo/types-syntaxe-utiles/
---

# ğŸ“˜  3.0.1 - Types & syntaxe utiles 

## ğŸ“’ Glossaire minute
- **Scalaires** : `int`, `float`, `string`, `bool` (+ `null`).
- **Tableau associatif** : tableau indexÃ© par **clÃ©s nommÃ©es** (`['title' => '...']`).
- **`??` (coalescence nulle)** : renvoie la **premiÃ¨re valeur dÃ©finie et non nulle**.
- **`??=` (affectation par coalescence)** : **assigne** une valeur **uniquement si** la variable/clÃ© est **non dÃ©finie ou nulle**.
- **Types union** : un paramÃ¨tre/retour peut accepter **plusieurs types** (ex. `int|string`).

---

## ğŸ¯ Objectif pÃ©dagogique
Manipuler les **types modernes de PHP**, Ã©crire des **tableaux associatifs** propres et utiliser `??` / `??=` et les **types union** pour produire un code **lisible, sÃ»r** et prÃªt pour la suite (CLI, JSON, Composer).

---

## ğŸ§  DÃ©finition thÃ©orique (avec mini-exemples)

### 1) Scalaires & `null`
```php
<?php
declare(strict_types=1);

$age   = 21;           // int
$prix  = 19.99;        // float
$nom   = "Amina";      // string
$actif = true;         // bool
$vide  = null;         // null
````

> ğŸ’¡ `declare(strict_types=1)` renforce la **vÃ©rification des types** sur les **paramÃ¨tres** et **valeurs de retour** des fonctions.

---

### 2) Tableaux associatifs

```php
<?php
$article = [
  'title'     => 'Intro Laravel',
  'excerpt'   => null,
  'views'     => 120,
  'published' => true,
];

$article['author'] = 'Amina';                 // ajout
$hasViews          = array_key_exists('views', $article); // true mÃªme si null
```

---

### 3) `??` vs `?:` (trÃ¨s diffÃ©rent)

```php
<?php
$val = 0;

// coalescence nulle â€” ne bascule que si NULL ou non dÃ©fini
$a = $val ?? 42;   // => 0

// opÃ©rateur ternaire raccourci (truthy/falsy)
$b = $val ?: 42;   // => 42 (car 0 est falsy)
```

---

### 4) `??=` (affectation conditionnelle)

```php
<?php
$config = ['env' => 'local', 'per_page' => null];

$config['per_page'] ??= 10;  // devient 10 car la clÃ© existe mais vaut null
$config['cache']    ??= false; // ajoutÃ©e car non dÃ©finie
```

---

### 5) Types union (PHP â‰¥ 8.0)

```php
<?php
function normalizeId(int|string $id): int {
    if (is_string($id)) {
        $id = (int)trim($id);
    }
    return max(0, $id);
}

function toBool(true|false|string|int|null $v): bool {
    if (is_bool($v)) return $v;
    return in_array(strtolower((string)$v), ['1','true','yes','y','on'], true);
}

normalizeId('42');   // 42
toBool('OFF');       // false
```

> ğŸ” Astuce : prÃ©fÃ©rez des unions **simples et utiles** (`int|string`) ; Ã©vitez des unions trop larges qui compliquent la lecture.

---

## ğŸ› ï¸ Tutoriel guidÃ© (pas Ã  pas)

### Jeu de donnÃ©es (Ã  copier)

```php
<?php
declare(strict_types=1);

$input = [
  'title'     => 'PHP 8 en pratique',
  'excerpt'   => '',
  'views'     => '300',
  // 'published' absent
  'author'    => 'Yassine'
];
```

### Ã‰tape 1 â€” Normaliser avec `??` et unions

```php
<?php
function strOrNull(?string $s): ?string {
    $s = $s !== null ? trim($s) : null;
    return $s === '' ? null : $s;
}

function intOrZero(int|string|null $v): int {
    return max(0, (int)($v ?? 0));
}
```

### Ã‰tape 2 â€” Construire une structure propre

```php
<?php
$normalized = [
  'title'     => trim((string)($input['title'] ?? 'Sans titre')),
  'excerpt'   => strOrNull($input['excerpt'] ?? null),
  'views'     => intOrZero($input['views'] ?? null),
  'published' => $input['published'] ?? true, // dÃ©faut si non dÃ©fini
  'author'    => trim((string)($input['author'] ?? 'N/A')),
];

print_r($normalized);
/*
Array
(
  [title] => PHP 8 en pratique
  [excerpt] =>
  [views] => 300
  [published] => 1
  [author] => Yassine
)
*/
```

### Ã‰tape 3 â€” Defaults en place avec `??=`

```php
<?php
$defaults = [
  'per_page' => 10,
  'sort'     => 'created_desc',
];

$userQuery = ['per_page' => null]; // simulateur d'entrÃ©e
$userQuery['per_page'] ??= $defaults['per_page']; // 10
$userQuery['sort']     ??= $defaults['sort'];     // 'created_desc'
```

---

## ğŸ§ª Exercice guidÃ© (livrable N1)

> **But** : Ã©crire une fonction `buildArticle(array $row): array` qui renvoie :
>
> ```php
> [
>   'title'     => (string),
>   'excerpt'   => (string|null),
>   'views'     => (int >= 0),
>   'published' => (bool),
>   'author'    => (string)
> ]
> ```
>
> **Exigences**
>
> 1. Utiliser `??` pour toutes les **valeurs manquantes**.
> 2. Utiliser `??=` pour appliquer des **defaults** dans `$row` avant la normalisation.
> 3. `views` doit Ãªtre **int â‰¥ 0** (convertir `string|int|null`).
> 4. `excerpt` vide â†’ `null`.
> 5. Tester avec 3 cas (manquants, `0`, `''`, `null`).

### (CorrigÃ© indicatif)

```php
<?php
function buildArticle(array $row): array {
    $row['title']     ??= 'Sans titre';
    $row['author']    ??= 'N/A';
    $row['published'] ??= true;

    $title   = trim((string)$row['title']);
    $excerpt = isset($row['excerpt']) ? trim((string)$row['excerpt']) : null;
    $excerpt = ($excerpt === '') ? null : $excerpt;

    $views   = (int)($row['views'] ?? 0);
    $views   = max(0, $views);

    return [
        'title'     => $title,
        'excerpt'   => $excerpt,
        'views'     => $views,
        'published' => (bool)$row['published'],
        'author'    => trim((string)$row['author']),
    ];
}
```

---

## âš ï¸ Erreurs frÃ©quentes

* Confondre `??` (teste **null/non dÃ©fini**) et `?:` (teste **truthy/falsy**) â†’ `0` ou `''` ne doivent **pas** dÃ©clencher un fallback avec `??`.
* Penser que `isset($a['x'])` â‰¡ `array_key_exists('x',$a)` : **faux** (`isset` est faux si valeur `null`).
* Oublier `declare(strict_types=1)` â†’ conversions implicites surprises dans les fonctions.
* DÃ©clarer des **unions trop larges** â†’ API peu claire.

---

## ğŸ§¾ RÃ©sumÃ©

* `??` / `??=` rendent la **gestion des dÃ©fauts** concise et sÃ»re.
* Les **unions** facilitent lâ€™**interop** (`int|string`) tout en gardant un contrat clair.
* Cette base est **rÃ©utilisÃ©e** pour les prochains chapitres : **closures & `array_*` (3.0.2)**, **exceptions (3.0.3)**, puis **CLI/JSON (3.0.7â€“3.0.8)**.

---

## ğŸ”œ Suite

Passez Ã  **3.0.2 â€” Fonctions, closures & manipulation de tableaux** pour apprendre Ã  **transformer** vos donnÃ©es proprement (pipelines `filter â†’ map â†’ reduce`).
