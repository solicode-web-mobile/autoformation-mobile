---
title: 8. Finitions
layout: home
nav_order: 8
parent: 5.1. Bien démarrer le Mobile
permalink: /mobile-onboarding/finitions/
code: 5.1.8
competence: C5
autoformation: "C5.1"
ua: "5.1.U3"
duree_h: 1.5
objectif: "Finaliser l’UI (Material 3, strings, a11y) et valider un build APK de démonstration."
notions_nouvelles: ["Material 3", "Dynamic color", "strings.xml", "Accessibilité (a11y)"]
fil_rouge: "App Mobile présentable et accessible (HelloCounter) — base de validation"
livrable_chapitre: "`AppTheme` appliqué + `strings.xml` centralisé + actions 48dp + APK debug + README + captures"
alimentation_prototype: "Aspect pro et accessible de la démo N2"
alimentation_miniprojet: "UI/a11y consolidées pour itérations et intégration N3"
---


# 📘 5.1.8 - Finitions 


## 🎯 Objectif
Appliquer les **dernières finitions** avant livraison :  
- Thème **Material 3** propre (avec couleurs dynamiques si dispo).  
- Textes **externalisés** dans `strings.xml`.  
- **Accessibilité** minimale (labels, tailles tappables, ordre de focus).  
- Générer et tester un **APK debug** de validation.  

---

## 1) 🎨 Thème Material 3

> Fichier : `ui/theme/Theme.kt`

```kotlin
package com.solicode.hellocounter.ui.theme

import android.app.Activity
import android.os.Build
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.darkColorScheme
import androidx.compose.material3.dynamicDarkColorScheme
import androidx.compose.material3.dynamicLightColorScheme
import androidx.compose.material3.lightColorScheme
import androidx.compose.runtime.Composable
import androidx.compose.ui.platform.LocalContext

private val DarkColorScheme = darkColorScheme(
    primary = Purple80,
    secondary = PurpleGrey80,
    tertiary = Pink80
)

private val LightColorScheme = lightColorScheme(
    primary = Purple40,
    secondary = PurpleGrey40,
    tertiary = Pink40
)

@Composable
fun HelloCounterTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    // Dynamic color is available on Android 12+
    dynamicColor: Boolean = true,
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            val context = LocalContext.current
            if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)
        }

        darkTheme -> DarkColorScheme
        else -> LightColorScheme
    }

    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography,
        content = content
    )
}
````

**Intégration (MainActivity.kt)**

```kotlin
setContent { HelloCounterTheme { MainScreen() } }
```

🔑 **Explication** :

* `MaterialTheme` applique cohérence des couleurs, typographie et tailles.
* `dynamicColor` permet d’utiliser la palette Android 12+ si disponible.

---

## 2) 🗂️ Centraliser les textes

**Chemin** : `res/values/strings.xml`

```xml
<resources>
    <string name="app_name">HelloCounter</string>

    <!-- Formulaire -->
    <string name="label_firstname">Prénom</string>
    <string name="ph_firstname">Entrez votre prénom</string>
    <string name="btn_greet">Dire bonjour</string>
    <string name="msg_greeting">Bonjour, %1$s !</string>

    <!-- Compteur -->
    <string name="title_counter">Compteur</string>

    <!-- Accessibilité -->
    <string name="cd_decrement">Diminuer la valeur</string>
    <string name="cd_increment">Augmenter la valeur</string>
    <string name="cd_counter_value">Valeur actuelle : %1$d</string>
</resources>
```

👉 Tous les textes visibles ou lus par TalkBack doivent venir d’ici.

---

## 3) ♿ Accessibilité (a11y)

* **Icônes** : ajouter un `contentDescription` (sauf décoratives → `null`).
* **Tailles tappables** : boutons/icônes ≥ **48.dp**.
* **Ordre de focus** : garanti par la `Column` verticale.
* **TalkBack** : lire l’écran (émulateur → *Settings* → *Accessibility*).

Exemple corrigé dans `CompteurSection` :

```kotlin
IconButton(
  onClick = { if (count > 0) count-- },
  enabled = count > 0,
  modifier = Modifier.size(48.dp)
    .semantics { contentDescription = stringResource(R.string.cd_decrement) }
) {
  Icon(Icons.Filled.Remove, contentDescription = null)
}
```

---

## 4) 🧪 Vérifications rapides

* [ ] Tous les composants utilisent **Material 3**.
* [ ] Aucune chaîne de texte en dur dans le code.
* [ ] États `rememberSaveable` bien appliqués (`name`, `greetingName`, `count`).
* [ ] `IconButton` et `Button` ≥ **48.dp**.
* [ ] Preview et exécution OK.

---

## 5) 📦 Générer un APK debug

**Via Android Studio** :
`Build → Build APK(s)` → fichier généré dans
`app/build/outputs/apk/debug/app-debug.apk`

**En ligne de commande** :

```bash
./gradlew clean assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
adb shell monkey -p com.solicode.hellocounter -c android.intent.category.LAUNCHER 1
```

⚠️ En cas de conflit :

```bash
adb uninstall com.solicode.hellocounter
```

---

## 6) 📑 Livrables

* APK debug (`app-debug.apk`).
* README avec instructions + captures.
* 2–3 captures d’écran de l’appli en exécution.
* (Optionnel) courte vidéo ≤ 60s.

Extrait de README :

````md
## 🚀 Build & Install
```bash
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
````

## 📱 Testé sur

* Pixel 7a API 34 (émulateur)

## ✨ Inclus

* Material 3 + dynamic colors
* Accessibilité (a11y) : descriptions TalkBack, cibles 48dp
* États persistants (rememberSaveable)

````

---

## ✅ DoD
- [ ] Thème `AppTheme` appliqué globalement.  
- [ ] Textes centralisés dans `strings.xml`.  
- [ ] Accessibilité validée (contentDescription, tailles, focus).  
- [ ] APK debug compilé et installable.  
- [ ] README + captures présents dans le dépôt.  

---

## 🩹 Dépannage
- **Preview vide** → *Build → Rebuild Project*.  
- **Texte non lu par TalkBack** → vérifier `contentDescription`.  
- **APK non installable** → vérifier `applicationId`, désinstaller version précédente.  
- **Couleurs illisibles** → désactiver `dynamicColor` si Android < 12.  

---

## ⚡ Cheatsheet

```kotlin
// Thème global
AppTheme { MainScreen() }

// A11y pour icône signifiante
.semantics { contentDescription = stringResource(R.string.cd_increment) }

// Build APK
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
````

