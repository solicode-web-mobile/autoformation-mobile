---
title: 8. Finitions

permalink: /mobile-onboarding/finitions-m3-strings-a11y-build/
layout: home
nav_order: 8
parent: 5.1. Bien d√©marrer le Mobile
---

# üìò 5.1.8 - Finitions 

## üéØ Objectif
Appliquer les **derni√®res finitions** avant livraison :
- Th√®me **Material 3** propre (couleurs dynamiques si dispo),
- Textes **externalis√©s** dans `strings.xml`,
- **Accessibilit√©** minimale (labels, tailles tappables, ordre de focus),
- **Build APK** final de validation.

---

## 1) üé® Material 3 ‚Äî th√®me par d√©faut (Compose)

> Fichier sugg√©r√© : `ui/theme/Theme.kt`

```kotlin
package com.acme.hellocounter.ui.theme

import android.os.Build
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.*
import androidx.compose.runtime.Composable

@Composable
fun AppTheme(
  darkTheme: Boolean = isSystemInDarkTheme(),
  dynamicColor: Boolean = Build.VERSION.SDK_INT >= Build.VERSION_CODES.S,
  content: @Composable () -> Unit
) {
  val colorScheme =
    if (dynamicColor) {
      val ctx = LocalContext.current
      if (darkTheme) dynamicDarkColorScheme(ctx) else dynamicLightColorScheme(ctx)
    } else {
      if (darkTheme) darkColorScheme() else lightColorScheme()
    }

  MaterialTheme(
    colorScheme = colorScheme,
    typography = Typography(),
    content = content
  )
}
````

**Int√©grer le th√®me** (ex. `MainActivity.kt`) :

```kotlin
setContent { AppTheme { MainScreen() } }
```

> Bonnes pratiques UI : marges **16.dp**, composants **Material 3**, textes & labels issus de `strings.xml`.

---

## 2) üóÇÔ∏è Centraliser les textes dans `strings.xml`

> Chemin : `app/src/main/res/values/strings.xml`

```xml
<resources>
    <string name="app_name">HelloCounter</string>

    <!-- Formulaire -->
    <string name="label_firstname">Pr√©nom</string>
    <string name="ph_firstname">Entrez votre pr√©nom</string>
    <string name="btn_greet">Dire bonjour</string>
    <string name="msg_greeting">Bonjour, %1$s !</string>

    <!-- Compteur -->
    <string name="title_counter">Compteur</string>

    <!-- Accessibilit√© -->
    <string name="cd_decrement">Diminuer la valeur</string>
    <string name="cd_increment">Augmenter la valeur</string>
    <string name="cd_counter_value">Valeur actuelle : %1$d</string>
</resources>
```

Utilisation en Compose :

```kotlin
Text(stringResource(R.string.btn_greet))
```

> Avantages : i18n facilit√©e, textes testables, UI coh√©rente.

---

## 3) ‚ôø Accessibilit√© (a11y) minimale

* **Ic√¥nes** : fournir un `contentDescription` **s√©mantique** (ou `null` si d√©corative).
* **Tailles tappables** : zones d‚Äôaction **‚â• 48.dp** (ex. `IconButton`).
* **Ordre de focus** : agencer verticalement, √©viter les pi√®ges de focus.
* **Contraste** : le th√®me M3 g√®re souvent le contraste, mais v√©rifiez vos captures.
* **TalkBack** : tester la lecture des labels (√©mulateur ‚Üí *Settings* ‚Üí *Accessibility* ‚Üí *TalkBack*).

Extraits (d√©j√† appliqu√©s dans 5.1.6/5.1.7) :

```kotlin
IconButton(
  onClick = { if (count > 0) count-- },
  enabled = count > 0,
  modifier = Modifier.size(48.dp)
    .semantics { contentDescription = stringResource(R.string.cd_decrement) }
) { /* ... */ }
```

> R√®gle m√©tier **valid√©e en a11y** : le bouton **‚àí** est **d√©sactiv√©** √† `0` et annonc√© comme tel.

---

## 4) üß™ V√©rifs rapides avant build

* **Lint** visuel : marges r√©guli√®res, alignements, tailles tappables.
* **Textes** : **aucun** litt√©ral en dur dans l‚ÄôUI (tout via `strings.xml`).
* **√âtat** : `rememberSaveable` pour `name`, `greeting`, `count` (5.1.7).
* **Preview** : au moins une `@Preview` nette de l‚Äô√©cran.

---

## 5) üì¶ Build APK (r√©capitulatif)

**IDE** : `Build ‚Üí Build APK(s)` ‚Üí `app/build/outputs/apk/debug/app-debug.apk`
**CLI** :

```bash
./gradlew clean assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
adb shell monkey -p com.acme.hellocounter -c android.intent.category.LAUNCHER 1
```

> Si conflit de signature : `adb uninstall com.acme.hellocounter` puis r√©installer.
> (Release signing & Proguard seront vus plus tard.)

---

## 6) üìë Livrables & README (structure)

* **APK debug** (ou chemin exact vers l‚ÄôAPK).
* **README** (quickstart, appareil/√©mulateur, fonctionnalit√©s, captures).
* **Captures** : 2‚Äì3 images + (optionnel) vid√©o ‚â§ 60s.

Mod√®le *README ‚Äî extrait* :

````md
## üöÄ Build & Install
```bash
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
````

## üì± Test√© sur

* Pixel 7a API 34 (√©mulateur)

## ‚ú® Inclus

* Material 3 + dynamic colors
* a11y: contentDescription, cibles 48dp
* rememberSaveable: name/greeting/count

````

---

## ‚úÖ DoD ‚Äî Definition of Done
- [ ] Th√®me **Material 3** appliqu√© (`AppTheme`) avec couleurs dynamiques si Android 12+.  
- [ ] Tous les **textes** proviennent de **`strings.xml`**.  
- [ ] **Accessibilit√©** : `contentDescription` appropri√©s, actions ‚â• **48.dp**, **‚àí** d√©sactiv√© √† `0`.  
- [ ] **APK debug** compil√©, install√© et d√©marr√© sur √©mulateur/appareil.  
- [ ] **README + captures** pr√©sents dans le d√©p√¥t.

---

## ü©π D√©pannage
- **Preview cass√©e** : *Build ‚Üí Clean/Rebuild*, synchroniser Gradle, v√©rifier versions Compose/AGP.  
- **Texte non lu par TalkBack** : v√©rifier que l‚Äôic√¥ne **n‚Äôa pas** `null` si elle **porte du sens**.  
- **Contraste faible (th√®me)** : d√©sactiver `dynamicColor` ou ajuster le sch√©ma.  
- **APK non installable** : v√©rifier `applicationId`, d√©sinstaller version pr√©c√©dente, r√©essayer.

---

## ‚ö° Cheatsheet
```kotlin
// Th√®me global
AppTheme { MainScreen() }

// A11y pour ic√¥ne signifiante
.semantics { contentDescription = stringResource(R.string.cd_increment) }

// Build & install
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
````

```
```
