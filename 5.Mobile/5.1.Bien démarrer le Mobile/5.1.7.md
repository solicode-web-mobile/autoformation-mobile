---
title: 7. États & rememberSaveable
layout: home
nav_order: 7
parent: 5.1. Bien démarrer le Mobile
permalink: /mobile-onboarding/etats-remembersaveable/
code: 5.1.7
competence: C5
autoformation: "C5.1"
ua: "5.1.U3"
duree_h: 1.5
objectif: "Persister les états UI avec rememberSaveable et appliquer les règles d’activation/désactivation."
notions_nouvelles: ["remember", "rememberSaveable", "Validation UI", "Semantics (a11y)"]
fil_rouge: "Écran Hello + Compteur robuste (états persistants) pour l’App Mobile du Blog"
livrable_chapitre: "`MainScreen` mis à jour (name/greeting/count en rememberSaveable) + courte vidéo de rotation"
alimentation_prototype: "UI stable et testable pour la démo N2"
alimentation_miniprojet: "Gestion d’état solide avant intégration réseau/API N3"
---

# 📘 5.1.7 - États & interactions avec `rememberSaveable`


## 📒 Glossaire minute

- **`remember`** : garde un état tant que le composable reste en mémoire (perdu à la rotation).  
- **`rememberSaveable`** : sauvegarde/restaure automatiquement l’état (via `Bundle`) → survit à la **rotation** ou à la recréation de l’activité.  
- **`mutableStateOf`** : crée un état observable qui redessine l’UI quand il change.  
- **`Column`** : conteneur vertical qui aligne ses enfants.  
- **`Modifier`** : configure mise en page et interactions (largeur, padding, accessibilité…).  

---

## 🎯 Objectif
Modifier l’écran (issu du chap. 5.1.6) pour :  
- Persister les états `name`, `greetingName`, `count` avec **rememberSaveable**.  
- Appliquer les règles :  
  - Bouton **“Dire bonjour”** désactivé si champ vide.  
  - Bouton **−** désactivé si compteur = 0.  
- Vérifier que les états survivent à la **rotation**.  

---

## 🔧 Pré-requis

- Avoir déjà l’UI de base avec `DireBonjourSection` et `CompteurSection`.  
- Avoir configuré `strings.xml`.  

---

## 1) Modifier DireBonjourSection

**Avant** (chap. 5.1.6) :  

```kotlin
var name by remember { mutableStateOf("") }
var greetingName by remember { mutableStateOf<String?>(null) }
````

**Après** (chap. 5.1.7) :

```kotlin
var name by rememberSaveable { mutableStateOf("") }
var greetingName by rememberSaveable { mutableStateOf<String?>(null) }
```

➡️ Cela permet de garder la saisie et le message même après rotation.

**Code complet :**

```kotlin
@Composable
fun DireBonjourSection(modifier: Modifier = Modifier) {
    var name by rememberSaveable { mutableStateOf("") }
    var greetingName by rememberSaveable { mutableStateOf<String?>(null) }

    Column(
        modifier = modifier.fillMaxWidth(),
        verticalArrangement = Arrangement.spacedBy(12.dp)
    ) {
        OutlinedTextField(
            value = name,
            onValueChange = {
                name = it
                if (name.isBlank()) greetingName = null
            },
            label = { Text(stringResource(R.string.label_firstname)) },
            placeholder = { Text(stringResource(R.string.ph_firstname)) },
            singleLine = true,
            keyboardOptions = KeyboardOptions.Default.copy(imeAction = ImeAction.Done),
            modifier = Modifier.fillMaxWidth().testTag("tf_firstname")
        )

        Button(
            onClick = { greetingName = name.takeIf { it.isNotBlank() }?.trim() },
            enabled = name.isNotBlank(),
            modifier = Modifier.fillMaxWidth()
        ) {
            Text(stringResource(R.string.btn_greet))
        }

        if (greetingName != null) {
            AssistChip(
                onClick = { },
                label = { Text(stringResource(R.string.msg_greeting, greetingName!!)) }
            )
        }
    }
}
```



Très bien 👌 Fouad, voici un paragraphe clair que tu peux intégrer dans ton chapitre pour guider tes apprenants :

---

### 💡 Comment ajouter `import androidx.compose.runtime.saveable.rememberSaveable`

Quand vous utilisez `rememberSaveable` pour la première fois, Android Studio affiche souvent une erreur rouge car l’import n’existe pas encore.
Pour corriger cela, placez votre curseur sur `rememberSaveable`, puis :

* **Option 1** : Appuyez sur `Alt + Enter` (Windows/Linux). Android Studio propose alors d’ajouter automatiquement l’import.
* **Option 2** : Écrivez manuellement en haut du fichier :

```kotlin
import androidx.compose.runtime.saveable.rememberSaveable
```

---

## 2) Modifier CompteurSection

**Avant** (chap. 5.1.6) :

```kotlin
var count by remember { mutableStateOf(0) }
```

**Après** (chap. 5.1.7) :

```kotlin
var count by rememberSaveable { mutableStateOf(0) }
```

➡️ Le compteur reste inchangé même si l’écran est tourné.

**Code complet :**

```kotlin
@Composable
fun CompteurSection(modifier: Modifier = Modifier) {
    var count by rememberSaveable { mutableStateOf(0) }

    val decrementCd = stringResource(R.string.cd_decrement)
    val incrementCd = stringResource(R.string.cd_increment)
    val counterCd   = stringResource(R.string.cd_counter_value, count)

    Column(
        modifier = modifier.fillMaxWidth(),
        verticalArrangement = Arrangement.spacedBy(12.dp)
    ) {
        Text(
            text = stringResource(R.string.title_counter),
            style = MaterialTheme.typography.titleMedium
        )

        Row(
            horizontalArrangement = Arrangement.spacedBy(12.dp),
            modifier = Modifier.fillMaxWidth()
        ) {
            IconButton(
                onClick = { if (count > 0) count-- },
                enabled = count > 0,
                modifier = Modifier
                    .size(48.dp)
                    .semantics { contentDescription = decrementCd }
            ) {
                Icon(Icons.Filled.Remove, contentDescription = null)
            }

            Text(
                text = "$count",
                style = MaterialTheme.typography.headlineSmall,
                modifier = Modifier
                    .widthIn(min = 40.dp)
                    .semantics { contentDescription = counterCd }
            )

            IconButton(
                onClick = { count++ },
                modifier = Modifier
                    .size(48.dp)
                    .semantics { contentDescription = incrementCd }
            ) {
                Icon(Icons.Filled.Add, contentDescription = null)
            }
        }
    }
}
```

---

## 3) MainScreen et MainActivity

Ces deux fichiers ne changent pas :

* `MainScreen` appelle toujours `DireBonjourSection()` et `CompteurSection()`.
* `MainActivity` monte `MainScreen()` avec `MaterialTheme` et fournit une Preview.

---

## 🧪 Vérifications manuelles

* [ ] Lancer l’application.
* [ ] Saisir un prénom et cliquer sur **Dire bonjour**.
* [ ] Incrémenter le compteur.
* [ ] Tourner l’écran (Ctrl/Cmd + ←/→ dans l’émulateur).
* ✅ Les états `name`, `greetingName` et `count` restent inchangés.
* ✅ Le bouton “Dire bonjour” reste désactivé si le champ est vide.
* ✅ Le bouton − est désactivé quand `count = 0`.

---

## 📦 Livrables attendus

- Branche : 5.1.7

---

## ✅ DoD

* [ ] Tous les états clés (`name`, `greetingName`, `count`) utilisent `rememberSaveable`.
* [ ] Bouton “Dire bonjour” désactivé si champ vide.
* [ ] Compteur ≥ 0 garanti.
* [ ] États persistants après rotation.

---

> Prochain chapitre : **5.1.8 — Finitions : Material 3, `strings.xml`, a11y, build APK**.
