---
title: 7. √âtats & rememberSaveable
layout: home
nav_order: 7
parent: 5.1. Bien d√©marrer le Mobile
permalink: /mobile-onboarding/etats-remembersaveable/
code: 5.1.7
competence: C5
autoformation: "C5.1"
ua: "5.1.U3"
duree_h: 1.5
objectif: "Persister les √©tats UI avec rememberSaveable et appliquer les r√®gles d‚Äôactivation/d√©sactivation."
notions_nouvelles: ["remember", "rememberSaveable", "Validation UI", "Semantics (a11y)"]
fil_rouge: "√âcran Hello + Compteur robuste (√©tats persistants) pour l‚ÄôApp Mobile du Blog"
livrable_chapitre: "`MainScreen` mis √† jour (name/greeting/count en rememberSaveable) + courte vid√©o de rotation"
alimentation_prototype: "UI stable et testable pour la d√©mo N2"
alimentation_miniprojet: "Gestion d‚Äô√©tat solide avant int√©gration r√©seau/API N3"
---


# üìò 5.1.7 - √âtats & interactions avec `rememberSaveable`

## üìí Glossaire minute
- **`remember`** : garde un √©tat tant que le composable reste en m√©moire (perdu √† la rotation).
- **`rememberSaveable`** : **sauvegarde/restaure** l‚Äô√©tat via `Bundle` (survit √† la **rotation**/process recreation).
- **Validation UI** : logique d‚Äôactivation/d√©sactivation et **r√®gle `count ‚â• 0`**.

---

## ‚úÖ Objectif
Am√©liorer l‚Äô√©cran (5.1.6) pour **persister** les √©tats (`name`, `greeting`, `count`) et **appliquer les r√®gles** :
- Bouton **‚ÄúDire bonjour‚Äù** **d√©sactiv√©** si champ **Pr√©nom** vide.
- **Compteur** ne descend **jamais** en dessous de **0** (**‚àí** d√©sactiv√© √† `0`).
- √âtats **conserv√©s** √† la **rotation** gr√¢ce √† `rememberSaveable`.

---

## üîß Pr√©-requis
- Avoir l‚ÄôUI de base (chap. **5.1.6**) et les **strings** correspondantes.
- Projet Compose qui build & run.

---

## 1) Remplacer `remember` par `rememberSaveable`

> Fichier : `app/src/main/kotlin/com/acme/hellocounter/ui/MainScreen.kt`

```kotlin
@Composable
fun MainScreen(modifier: Modifier = Modifier) {
  // ‚¨áÔ∏è Tous ces √©tats sont sauvegard√©s/restaur√©s (types primitifs = OK par d√©faut)
  var name by rememberSaveable { mutableStateOf("") }
  var greeting by rememberSaveable { mutableStateOf<String?>(null) }
  var count by rememberSaveable { mutableStateOf(0) }

  Column(
    modifier = modifier
      .fillMaxSize()
      .padding(16.dp)
      .verticalScroll(rememberScrollState()),
    verticalArrangement = Arrangement.spacedBy(16.dp),
    horizontalAlignment = Alignment.CenterHorizontally
  ) {
    // Champ "Pr√©nom"
    OutlinedTextField(
      value = name,
      onValueChange = {
        name = it
        // (option) remettre le message √† null si on efface tout
        if (name.isBlank()) greeting = null
      },
      label = { Text(stringResource(R.string.label_firstname)) },
      placeholder = { Text(stringResource(R.string.ph_firstname)) },
      singleLine = true,
      modifier = Modifier.fillMaxWidth(),
      keyboardOptions = KeyboardOptions(imeAction = ImeAction.Done),
      keyboardActions = KeyboardActions(
        onDone = {
          if (name.isNotBlank()) {
            greeting = stringResource(R.string.msg_greeting, name.trim())
          }
        }
      )
    )

    // Bouton "Dire bonjour" ‚Äî d√©sactiv√© si champ vide
    Button(
      onClick = {
        greeting = stringResource(R.string.msg_greeting, name.trim())
      },
      enabled = name.isNotBlank(),
      modifier = Modifier.fillMaxWidth()
    ) {
      Text(stringResource(R.string.btn_greet))
    }

    // Message (si pr√©sent)
    if (!greeting.isNullOrBlank()) {
      AssistChip(onClick = { /* no-op */ }, label = { Text(greeting!!) })
    }

    // Titre "Compteur"
    Text(text = stringResource(R.string.title_counter), style = MaterialTheme.typography.titleMedium)

    // Bloc compteur : ‚àí / valeur / +
    Row(verticalAlignment = Alignment.CenterVertically, horizontalArrangement = Arrangement.spacedBy(12.dp)) {
      // ‚àí d√©sactiv√© √† 0
      IconButton(
        onClick = { if (count > 0) count-- },
        enabled = count > 0,
        modifier = Modifier.size(48.dp).semantics {
          contentDescription = stringResource(R.string.cd_decrement)
        }
      ) { Icon(Icons.Filled.Remove, contentDescription = null) }

      Text(
        text = "$count",
        style = MaterialTheme.typography.headlineSmall,
        modifier = Modifier.widthIn(min = 40.dp).semantics {
          contentDescription = stringResource(R.string.cd_counter_value, count)
        }
      )

      IconButton(
        onClick = { count++ },
        modifier = Modifier.size(48.dp).semantics {
          contentDescription = stringResource(R.string.cd_increment)
        }
      ) { Icon(Icons.Filled.Add, contentDescription = null) }
    }
  }
}
````

> ‚ÑπÔ∏è **Pourquoi `rememberSaveable` ?** En cas de **rotation** (ou kill/recreate), l‚Äô√©tat est **restaur√©** automatiquement (types simples & `Parcelable`).

---

## 2) (Option) Sauver la **position du curseur**

Si vous voulez **pr√©server le curseur** du `TextField`, utilisez `TextFieldValue` + `Saver` :

```kotlin
var nameField by rememberSaveable(stateSaver = TextFieldValue.Saver) {
  mutableStateOf(TextFieldValue(""))
}
// ‚Ä¶ puis utilisez nameField.text / nameField.selection
```

Pour ce chapitre, la version **String** suffit.

---

## 3) R√®gles d‚Äôinteraction (r√©sum√©)

* **Bouton** ‚ÄúDire bonjour‚Äù : `enabled = name.isNotBlank()`.
* **Message** : affich√© apr√®s clic (ou `onDone`) si `name.trim().isNotEmpty()`.
* **Compteur** : `count` **jamais < 0** ; bouton **‚àí** `enabled = count > 0`.

---

## 4) Tests UI rapides (androidTest)

> Ajoutez les **testTags** si besoin, puis un test Compose (facultatif mais recommand√©).

```kotlin
// Example: app/src/androidTest/.../MainScreenTest.kt
@get:Rule val compose = createAndroidComposeRule<ComponentActivity>()

@Test fun greet_button_disabled_when_name_empty() {
  compose.setContent { MaterialTheme { MainScreen() } }
  compose.onNodeWithText("Dire bonjour").assertIsNotEnabled()
}

@Test fun counter_never_below_zero() {
  compose.setContent { MaterialTheme { MainScreen() } }
  // Taper - plusieurs fois
  repeat(3) { compose.onNodeWithContentDescription("Diminuer la valeur").performClick() }
  // La valeur affich√©e reste "0"
  compose.onNodeWithText("0").assertExists()
}
```

> ‚ö†Ô∏è Les litt√©raux (‚ÄúDire bonjour‚Äù, etc.) peuvent √™tre remplac√©s par `stringResource(...)` + `hasText(...)` si vous internationalisez vos tests.

---

## üß™ V√©rifications manuelles

* [ ] **Rotation** : tournez l‚Äô√©cran (Ctrl/Cmd + ‚Üê/‚Üí dans l‚Äô√©mulateur) ‚Üí `name`, `greeting`, `count` **restent**.
* [ ] **Bouton** ‚ÄúDire bonjour‚Äù d√©sactiv√© quand le champ est **vide**.
* [ ] **‚àí** d√©sactiv√© quand le compteur = **0**.
* [ ] **Message** s‚Äôaffiche avec le pr√©nom **trim()**.

---

## ü©π D√©pannage

* **√âtat perdu apr√®s rotation** ‚Üí v√©rifiez que vous utilisez **`rememberSaveable`** (et non `remember`).
* **Bouton reste activ√©** ‚Üí condition `enabled = name.isNotBlank()` manquante.
* **Compteur n√©gatif** ‚Üí prot√©gez l‚Äôaction (`if (count > 0)`) et **d√©sactivez** le bouton.
* **Message non mis √† jour** ‚Üí utilisez `trim()` et assignez `greeting` **au clic** ou `onDone`.

---

## üì¶ Livrables attendus

* `MainScreen` mis √† jour avec **`rememberSaveable`** pour `name`, `greeting`, `count`.
* R√®gles d‚ÄôUI **appliqu√©es** (d√©sactivation bouton, `count ‚â• 0`).
* Petite **vid√©o** (‚â§ 20s) montrant **rotation** + √©tats **pr√©serv√©s**.

---

## ‚úÖ DoD ‚Äî Definition of Done

* [ ] Tous les √©tats cl√©s sont en **`rememberSaveable`**.
* [ ] Le bouton **‚ÄúDire bonjour‚Äù** est **d√©sactiv√©** si le champ est vide.
* [ ] Le **compteur** ne descend **jamais** sous **0** (‚àí d√©sactiv√© √† `0`).
* [ ] Les √©tats **persistent** √† la **rotation**.

---

## ‚ö° Cheatsheet

```kotlin
// Garder l'√©tat et le restaurer √† la rotation
var value by rememberSaveable { mutableStateOf(initial) }

// Activer/d√©sactiver selon saisie
enabled = text.isNotBlank()

// Ne jamais descendre sous 0
onDecrement = { if (count > 0) count-- }
```

> Prochain chapitre : **5.1.8 ‚Äî Finitions : Material 3, `strings.xml`, a11y, build APK**.
