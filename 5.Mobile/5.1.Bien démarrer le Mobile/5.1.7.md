---
title: 7. Ã‰tats & rememberSaveable
layout: home
nav_order: 7
parent: 5.1. Bien dÃ©marrer le Mobile
permalink: /mobile-onboarding/etats-remembersaveable/
code: 5.1.7
competence: C5
autoformation: "C5.1"
ua: "5.1.U3"
duree_h: 1.5
objectif: "Persister les Ã©tats UI avec rememberSaveable et appliquer les rÃ¨gles dâ€™activation/dÃ©sactivation."
notions_nouvelles: ["remember", "rememberSaveable", "Validation UI", "Semantics (a11y)"]
fil_rouge: "Ã‰cran Hello + Compteur robuste (Ã©tats persistants) pour lâ€™App Mobile du Blog"
livrable_chapitre: "`MainScreen` mis Ã  jour (name/greeting/count en rememberSaveable) + courte vidÃ©o de rotation"
alimentation_prototype: "UI stable et testable pour la dÃ©mo N2"
alimentation_miniprojet: "Gestion dâ€™Ã©tat solide avant intÃ©gration rÃ©seau/API N3"
---

# ğŸ“˜ 5.1.7 - Ã‰tats & interactions avec `rememberSaveable`


## ğŸ“’ Glossaire minute

- **`remember`** : garde un Ã©tat tant que le composable reste en mÃ©moire (perdu Ã  la rotation).  
- **`rememberSaveable`** : sauvegarde/restaure automatiquement lâ€™Ã©tat (via `Bundle`) â†’ survit Ã  la **rotation** ou Ã  la recrÃ©ation de lâ€™activitÃ©.  
- **`mutableStateOf`** : crÃ©e un Ã©tat observable qui redessine lâ€™UI quand il change.  
- **`Column`** : conteneur vertical qui aligne ses enfants.  
- **`Modifier`** : configure mise en page et interactions (largeur, padding, accessibilitÃ©â€¦).  

---

## ğŸ¯ Objectif
Modifier lâ€™Ã©cran (issu du chap. 5.1.6) pour :  
- Persister les Ã©tats `name`, `greetingName`, `count` avec **rememberSaveable**.  
- Appliquer les rÃ¨gles :  
  - Bouton **â€œDire bonjourâ€** dÃ©sactivÃ© si champ vide.  
  - Bouton **âˆ’** dÃ©sactivÃ© si compteur = 0.  
- VÃ©rifier que les Ã©tats survivent Ã  la **rotation**.  

---

## ğŸ”§ PrÃ©-requis

- Avoir dÃ©jÃ  lâ€™UI de base avec `DireBonjourSection` et `CompteurSection`.  
- Avoir configurÃ© `strings.xml`.  

---

## 1) Modifier DireBonjourSection

**Avant** (chap. 5.1.6) :  

```kotlin
var name by remember { mutableStateOf("") }
var greetingName by remember { mutableStateOf<String?>(null) }
````

**AprÃ¨s** (chap. 5.1.7) :

```kotlin
var name by rememberSaveable { mutableStateOf("") }
var greetingName by rememberSaveable { mutableStateOf<String?>(null) }
```

â¡ï¸ Cela permet de garder la saisie et le message mÃªme aprÃ¨s rotation.

**Code complet :**

```kotlin
@Composable
fun DireBonjourSection(modifier: Modifier = Modifier) {
    var name by rememberSaveable { mutableStateOf("") }
    var greetingName by rememberSaveable { mutableStateOf<String?>(null) }

    Column(
        modifier = modifier.fillMaxWidth(),
        verticalArrangement = Arrangement.spacedBy(12.dp)
    ) {
        OutlinedTextField(
            value = name,
            onValueChange = {
                name = it
                if (name.isBlank()) greetingName = null
            },
            label = { Text(stringResource(R.string.label_firstname)) },
            placeholder = { Text(stringResource(R.string.ph_firstname)) },
            singleLine = true,
            keyboardOptions = KeyboardOptions.Default.copy(imeAction = ImeAction.Done),
            modifier = Modifier.fillMaxWidth().testTag("tf_firstname")
        )

        Button(
            onClick = { greetingName = name.takeIf { it.isNotBlank() }?.trim() },
            enabled = name.isNotBlank(),
            modifier = Modifier.fillMaxWidth()
        ) {
            Text(stringResource(R.string.btn_greet))
        }

        if (greetingName != null) {
            AssistChip(
                onClick = { },
                label = { Text(stringResource(R.string.msg_greeting, greetingName!!)) }
            )
        }
    }
}
```



TrÃ¨s bien ğŸ‘Œ Fouad, voici un paragraphe clair que tu peux intÃ©grer dans ton chapitre pour guider tes apprenants :

---

### ğŸ’¡ Comment ajouter `import androidx.compose.runtime.saveable.rememberSaveable`

Quand vous utilisez `rememberSaveable` pour la premiÃ¨re fois, Android Studio affiche souvent une erreur rouge car lâ€™import nâ€™existe pas encore.
Pour corriger cela, placez votre curseur sur `rememberSaveable`, puis :

* **Option 1** : Appuyez sur `Alt + Enter` (Windows/Linux). Android Studio propose alors dâ€™ajouter automatiquement lâ€™import.
* **Option 2** : Ã‰crivez manuellement en haut du fichier :

```kotlin
import androidx.compose.runtime.saveable.rememberSaveable
```

---

## 2) Modifier CompteurSection

**Avant** (chap. 5.1.6) :

```kotlin
var count by remember { mutableStateOf(0) }
```

**AprÃ¨s** (chap. 5.1.7) :

```kotlin
var count by rememberSaveable { mutableStateOf(0) }
```

â¡ï¸ Le compteur reste inchangÃ© mÃªme si lâ€™Ã©cran est tournÃ©.

**Code complet :**

```kotlin
@Composable
fun CompteurSection(modifier: Modifier = Modifier) {
    var count by rememberSaveable { mutableStateOf(0) }

    val decrementCd = stringResource(R.string.cd_decrement)
    val incrementCd = stringResource(R.string.cd_increment)
    val counterCd   = stringResource(R.string.cd_counter_value, count)

    Column(
        modifier = modifier.fillMaxWidth(),
        verticalArrangement = Arrangement.spacedBy(12.dp)
    ) {
        Text(
            text = stringResource(R.string.title_counter),
            style = MaterialTheme.typography.titleMedium
        )

        Row(
            horizontalArrangement = Arrangement.spacedBy(12.dp),
            modifier = Modifier.fillMaxWidth()
        ) {
            IconButton(
                onClick = { if (count > 0) count-- },
                enabled = count > 0,
                modifier = Modifier
                    .size(48.dp)
                    .semantics { contentDescription = decrementCd }
            ) {
                Icon(Icons.Filled.Remove, contentDescription = null)
            }

            Text(
                text = "$count",
                style = MaterialTheme.typography.headlineSmall,
                modifier = Modifier
                    .widthIn(min = 40.dp)
                    .semantics { contentDescription = counterCd }
            )

            IconButton(
                onClick = { count++ },
                modifier = Modifier
                    .size(48.dp)
                    .semantics { contentDescription = incrementCd }
            ) {
                Icon(Icons.Filled.Add, contentDescription = null)
            }
        }
    }
}
```

---

## 3) MainScreen et MainActivity

Ces deux fichiers ne changent pas :

* `MainScreen` appelle toujours `DireBonjourSection()` et `CompteurSection()`.
* `MainActivity` monte `MainScreen()` avec `MaterialTheme` et fournit une Preview.

---

## ğŸ§ª VÃ©rifications manuelles

* [ ] Lancer lâ€™application.
* [ ] Saisir un prÃ©nom et cliquer sur **Dire bonjour**.
* [ ] IncrÃ©menter le compteur.
* [ ] Tourner lâ€™Ã©cran (Ctrl/Cmd + â†/â†’ dans lâ€™Ã©mulateur).
* âœ… Les Ã©tats `name`, `greetingName` et `count` restent inchangÃ©s.
* âœ… Le bouton â€œDire bonjourâ€ reste dÃ©sactivÃ© si le champ est vide.
* âœ… Le bouton âˆ’ est dÃ©sactivÃ© quand `count = 0`.

---

## ğŸ“¦ Livrables attendus

- Branche : 5.1.7

---

## âœ… DoD

* [ ] Tous les Ã©tats clÃ©s (`name`, `greetingName`, `count`) utilisent `rememberSaveable`.
* [ ] Bouton â€œDire bonjourâ€ dÃ©sactivÃ© si champ vide.
* [ ] Compteur â‰¥ 0 garanti.
* [ ] Ã‰tats persistants aprÃ¨s rotation.

---

> Prochain chapitre : **5.1.8 â€” Finitions : Material 3, `strings.xml`, a11y, build APK**.
