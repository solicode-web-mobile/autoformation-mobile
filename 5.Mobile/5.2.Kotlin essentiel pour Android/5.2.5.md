---
title: 5. List/Set/Map
permalink: /kotlin-essentiel-android/collections-operations/
layout: home
nav_order: 5
parent: 5.2. Kotlin essentiel pour Android
---

# üìò 5.2.5 ‚Äî `List/Set/Map`

## üìí Glossaire minute
- **`List<T>`** : liste **ordonn√©e**, peut contenir des doublons.  
- **`Set<T>`** : ensemble **sans doublons** (√©galit√© structurelle).  
- **`Map<K,V>`** : paires cl√©‚Üívaleur, cl√©s **uniques**.  
- **Immuable** (pr√©f√©r√©) : `listOf`, `setOf`, `mapOf`.  
- **Mutable** (√† limiter) : `mutableListOf`, `mutableSetOf`, `mutableMapOf`.  
- **Ops usuelles** : `map`, `filter`, `mapNotNull`, `sumOf`, `sortedBy`, `distinctBy`, `groupBy`, `associateBy`.

---

## ‚úÖ Objectif
Manipuler les **collections Kotlin** de mani√®re **lisible et s√ªre** : choisir le bon type (`List/Set/Map`), **it√©rer** idiomatiquement, et appliquer les **transformations** cl√©s pour la logique Android/Compose.

---

## 1) D√©clarer & choisir la bonne collection

```kotlin
val tags: List<String> = listOf("android", "kotlin", "compose")  // immuable
val bag: MutableList<Int> = mutableListOf(1, 2, 2)               // modifiable

val uniq: Set<String> = setOf("kotlin", "kotlin", "compose")     // {"kotlin","compose"}
val counts: MutableMap<String, Int> = mutableMapOf("done" to 3)
````

> üå± **Par d√©faut, immuable.** Passez au mutable **seulement** si modification n√©cessaire et **localis√©e**.

---

## 2) It√©rations idiomatiques

```kotlin
// for-each simple
for (t in tags) println(t)

// index + valeur
for ((i, t) in tags.withIndex()) println("$i ‚Üí $t")

// Map : cl√©/valeur
for ((k, v) in counts) println("$k = $v")

// Fonctionnel (pr√©f√©r√© pour transformer)
tags.forEach { println(it) }
```

> Utilisez `for` si vous avez besoin de `break/continue`. Sinon, pr√©f√©rez les **op√©rateurs**.

---

## 3) Transformations essentielles

```kotlin
data class Todo(val id: Long, val title: String, val done: Boolean)

val todos = listOf(
  Todo(1, "√âtudier Kotlin", true),
  Todo(2, "√âcrire UI Compose", false),
  Todo(3, "Tests", true)
)

// Filtrer + projeter
val doneTitles: List<String> =
  todos.filter { it.done }.map { it.title }

// Sommes & comptes
val totalDone = todos.count { it.done }               // 2
val totalChars = todos.sumOf { it.title.length }      // Int
val avgTitle = todos.map { it.title.length }.average()

// Tri & unicit√©
val sorted = todos.sortedBy { it.title }              // ordre alphab√©tique
val distinctByTitle = todos.distinctBy { it.title }   // retire doublons par cl√©

// Groupement & indexation
val byDone: Map<Boolean, List<Todo>> = todos.groupBy { it.done }
val byId: Map<Long, Todo> = todos.associateBy { it.id } // cl√© = id

// Nettoyage des nulls
val maybeIds: List<Long?> = listOf(1, null, 2)
val ids: List<Long> = maybeIds.filterNotNull()

// Conversion cl√©/valeur personnalis√©e
val kv: Map<String, Int> = todos.associate { it.title to it.title.length }
```

---

## 4) `Map` : acc√®s & valeurs par d√©faut

```kotlin
val m = mapOf("x" to 1)

// Valeur ou d√©faut calcul√©
val v1 = m.getOrElse("y") { 0 }       // 0

// Valeur ou constante
val v2 = m["y"] ?: 0                  // 0

// getValue ‚Üí jette si absent (utile si on **sait** que la cl√© existe)
val v3 = m.getValue("x")              // 1
```

> **Cl√©s dupliqu√©es** : `toMap()` garde la **derni√®re** valeur ; pr√©f√©rez `associateBy` si l‚Äô**unicit√©** de la cl√© est importante.

---

## 5) Recettes Android/Compose

### A) Pr√©parer une liste pour UI (recherche + tri)

```kotlin
fun filterAndSort(todos: List<Todo>, q: String): List<Todo> =
  todos
    .filter { it.title.contains(q.trim(), ignoreCase = true) }
    .sortedBy { it.title.lowercase() }
```

### B) Sectionner une liste (groupBy)

```kotlin
data class Section(val header: String, val items: List<Todo>)

fun asSections(todos: List<Todo>): List<Section> =
  todos.groupBy { if (it.done) "Termin√©es" else "√Ä faire" }
       .map { (h, items) -> Section(h, items.sortedBy { it.title }) }
```

### C) Compteur & statistiques

```kotlin
data class Stats(val total: Int, val done: Int, val ratio: Double)

fun stats(todos: List<Todo>): Stats {
  val total = todos.size
  val done = todos.count { it.done }
  val ratio = if (total == 0) 0.0 else done.toDouble() / total
  return Stats(total, done, ratio)
}
```

---

## 6) Performance & lisibilit√©

* Cha√Ænes **longues** d‚Äôop√©rations : utilisez `asSequence()` si la **liste est grosse** et que vous **court-circuitez** (mais souvent **inutile** sur petites listes UI) :

  ```kotlin
  val firstBig = list.asSequence().filter { it.size > 1000 }.map { it.id }.firstOrNull()
  ```
* Construction efficace **immat√©rielle** :

  ```kotlin
  val built = buildList {
    add(1); addAll(listOf(2,3))
  }
  ```
* √âvitez de **muter** une collection en l‚Äô**it√©rant** ; cr√©ez une **copie** (`toMutableList()`) si n√©cessaire.

---

## 7) Cas pratiques suppl√©mentaires

```kotlin
// Limiter r√©sultats & paginer
val page = todos.drop(pageIndex * pageSize).take(pageSize)

// Aplatir des sous-listes
val allTags: List<String> = listOf(
  listOf("android","compose"),
  listOf("kotlin")
).flatMap { it }.distinct()

// Somme de Long/Double
data class Purchase(val priceCents: Long)
val totalCents: Long = listOf(Purchase(1999), Purchase(299)).sumOf { it.priceCents }
```

---

## üß™ V√©rifications rapides

* [ ] Vous distinguez **List/Set/Map** et choisissez l‚Äô**immuable** par d√©faut.
* [ ] Vous savez it√©rer : `for`, `withIndex`, destructuration `for ((k,v) in map)`.
* [ ] Vous ma√Ætrisez `map`, `filter`, `mapNotNull`, `sumOf`, `sortedBy`.
* [ ] Vous utilisez `groupBy`, `associateBy`, `distinctBy` selon le besoin.

---

## ü©π Erreurs fr√©quentes & correctifs

* ‚ùå Tout en **mutable** ‚Üí ‚úÖ immuable + **reconstruire** au besoin.
* ‚ùå `!!` sur valeurs de `Map` ‚Üí ‚úÖ `getOrElse` / `?:` / `getValue` (si garanti).
* ‚ùå Tri sensible √† la casse ‚Üí ‚úÖ `sortedBy { it.lowercase() }`.
* ‚ùå Pipelines trop lourds sur grosses listes ‚Üí ‚úÖ `asSequence()` ou **algorithme direct**.
* ‚ùå Perte d‚Äô√©l√©ments lors d‚Äôun `toMap()` avec cl√©s dupliqu√©es ‚Üí ‚úÖ `groupBy` / `associateBy`.

---

## üì¶ Livrables attendus

* Fonctions **utilitaires** :

  * `filterAndSort(todos, q)`,
  * `asSections(todos)`,
  * `stats(todos)`.
* Exemple `Map` avec **acc√®s s√ªr** (`getOrElse`/`?:`).
* 1‚Äì2 tests simple(s) (`sumOf`, `groupBy`, `distinctBy`).

---

## ‚úÖ DoD ‚Äî Definition of Done

* [ ] Code lisible, **immutabilit√©** privil√©gi√©e.
* [ ] Transformations via **op√©rateurs** (pas de boucles verbeuses).
* [ ] Acc√®s `Map` **sans NPE**.
* [ ] Exemples compilants & testables.

---

## ‚ö° Cheatsheet

```kotlin
// Bases
val l = listOf(1,2,3); val s = setOf(1,1,2); val m = mapOf("a" to 1)

// It√©rations
for ((i, v) in l.withIndex()) {}
for ((k, v) in m) {}

// Ops cl√©s
l.filter { it > 1 }.map { it * 10 }.sumOf { it }   // 50
l.distinct().sorted()

// Group & index
val byKey = l.groupBy { it % 2 }      // 0‚Üí[2], 1‚Üí[1,3]
val index  = todos.associateBy { it.id }

// Map safe
val v = m["x"] ?: 0
```
