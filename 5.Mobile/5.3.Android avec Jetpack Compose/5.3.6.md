---
title: 6. Navigation basique
permalink: /android-compose-mvvm/navigation-basique/
layout: home
nav_order: 6
parent: 5.3. Android avec Compose
---

# ðŸ“˜ 5.3.6 - Navigation basique

## ðŸ“’ Glossaire minute
- **NavController** : pilote la **pile dâ€™Ã©crans**.
- **NavHost** : zone qui **affiche** lâ€™Ã©cran courant selon la route.
- **Route** : identifiant textuel dâ€™un Ã©cran (ex. `"list"`, `"about"`).
- **Back stack** : pile dâ€™Ã©crans (bouton **Back** â†’ `navigateUp()`).

---

## âœ… Objectif
Brancher une **navigation Compose** minimale entre :
- un **Ã©cran Liste** (ex. TODO locale du 5.3.4),  
- un **Ã©cran Â« Ã€ propos Â»** accessible via lâ€™action dâ€™AppBar.  

GÃ©rer **Back**, conserver lâ€™Ã©tat dâ€™Ã©cran et Ã©viter la multiplication dâ€™instances.

---

## 0) DÃ©pendance (Gradle)
```kts
dependencies {
  implementation("androidx.navigation:navigation-compose:<latest>")
}
````

---

## 1) DÃ©finir les routes (type-safe)

```kotlin
// nav/Routes.kt
sealed class Route(val path: String) {
  data object List : Route("list")
  data object About : Route("about")
}
```

---

## 2) Ã‰crans (stateless, callbacks)

> RÃ©utilisez votre `TodoScreen()` (5.3.4). Ici on ajoute juste un **TopAppBar** avec une action Â« Ã€ propos Â».

```kotlin
// ui/screens/ListScreen.kt
@Composable
fun ListScreen(
  onOpenAbout: () -> Unit,
  modifier: Modifier = Modifier
) {
  Scaffold(
    topBar = {
      CenterAlignedTopAppBar(
        title = { Text(stringResource(R.string.app_name)) },
        actions = {
          IconButton(onClick = onOpenAbout) {
            Icon(Icons.Default.Info, contentDescription = stringResource(R.string.cd_about))
          }
        }
      )
    }
  ) { padding ->
    // Votre contenu liste (ex. TodoScreen)
    TodoScreen(modifier = modifier.padding(padding))
  }
}

// ui/screens/AboutScreen.kt
@Composable
fun AboutScreen(onBack: () -> Unit, modifier: Modifier = Modifier) {
  Scaffold(
    topBar = {
      CenterAlignedTopAppBar(
        navigationIcon = {
          IconButton(onClick = onBack) {
            Icon(Icons.Default.ArrowBack, contentDescription = stringResource(R.string.cd_back))
          }
        },
        title = { Text(stringResource(R.string.title_about)) }
      )
    }
  ) { padding ->
    Column(
      modifier = modifier
        .padding(padding)
        .fillMaxSize()
        .padding(16.dp),
      verticalArrangement = Arrangement.spacedBy(12.dp)
    ) {
      Text(stringResource(R.string.app_name), style = MaterialTheme.typography.titleLarge)
      Text("Mini-app dÃ©monstration Jetpack Compose & navigation basique.", style = MaterialTheme.typography.bodyMedium)
      Divider()
      Text("Version 1.0 â€” Auteur: Vous", style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.onSurfaceVariant)
      Text("Licences : Apache-2.0 (exemple)", style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.onSurfaceVariant)
    }
  }
}
```

---

## 3) NavHost + NavController

```kotlin
// nav/NavGraph.kt
@Composable
fun AppNavGraph(
  navController: NavHostController = rememberNavController()
) {
  NavHost(
    navController = navController,
    startDestination = Route.List.path
  ) {
    composable(Route.List.path) {
      ListScreen(
        onOpenAbout = {
          navController.navigate(Route.About.path) {
            launchSingleTop = true      // Ã©vite les doublons sur clic rÃ©pÃ©tÃ©
          }
        }
      )
    }
    composable(Route.About.path) {
      AboutScreen(onBack = { navController.navigateUp() })
    }
  }
}
```

**IntÃ©gration (Activity)**

```kotlin
// MainActivity.kt
class MainActivity : ComponentActivity() {
  override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContent {
      MaterialTheme {           // ou AppTheme() si vous lâ€™avez crÃ©Ã©
        AppNavGraph()
      }
    }
  }
}
```

---

## 4) GÃ©rer le Back et lâ€™Ã©tat dâ€™Ã©crans

* **Back** : sur Â« Ã€ propos Â», `navigateUp()` revient Ã  la Liste.
* **Ã‰tat** : `TodoScreen` garde son Ã©tat si vous lâ€™avez mis dans un **ViewModel** (5.3.5) **ou** via `rememberSaveable` (5.3.3/5.1.7).
* **Relancer la Liste depuis Ã€ propos** : Ã©vitez de recrÃ©er lâ€™Ã©cran inutilement, prÃ©fÃ©rez `navigateUp()`.

> Astuce : pour des onglets ou retours complexes, utilisez `popUpTo` avec `saveState/restoreState`.

```kotlin
navController.navigate(Route.List.path) {
  popUpTo(Route.List.path) { saveState = true }
  launchSingleTop = true
  restoreState = true
}
```

---

## 5) `strings.xml` (exemples)

```xml
<resources>
    <string name="cd_about">Ã€ propos</string>
    <string name="cd_back">Revenir en arriÃ¨re</string>
    <string name="title_about">Ã€ propos</string>
</resources>
```

---

## 6) PrÃ©views (optionnelles)

```kotlin
@Preview(showBackground = true, widthDp = 360)
@Composable
private fun ListScreenPreview() {
  MaterialTheme { ListScreen(onOpenAbout = {}) }
}

@Preview(showBackground = true, widthDp = 360)
@Composable
private fun AboutScreenPreview() {
  MaterialTheme { AboutScreen(onBack = {}) }
}
```

---

## ðŸ§ª VÃ©rifications rapides

* [ ] Clic **icÃ´ne Info** â†’ ouvre **Ã€ propos**.
* [ ] Clic **Back** (icÃ´ne ou bouton systÃ¨me) â†’ revient Ã  **Liste**.
* [ ] La **liste** conserve son Ã©tat (items cochÃ©s/saisis).
* [ ] Pas de **doublons** dâ€™Ã€ propos si on reclique (grÃ¢ce Ã  `launchSingleTop`).

---

## ðŸ©¹ DÃ©pannage

* **Rien ne sâ€™affiche** â†’ vÃ©rifier `startDestination` et que `AppNavGraph()` est bien appelÃ© dans `setContent`.
* **Back ferme lâ€™app depuis Ã€ propos** â†’ utilisez `navigateUp()` et non `finish()`.
* **Perte dâ€™Ã©tat de la liste** â†’ mettez la source dâ€™Ã©tat dans un **ViewModel** ou `rememberSaveable`.
* **Actions dâ€™AppBar non visibles** â†’ vÃ©rifiez `TopAppBar` **Material3** et les imports `material3.*`.

---

## ðŸ“¦ Livrables attendus

* `AppNavGraph` avec 2 routes : **List** et **About**.
* `ListScreen` avec **TopAppBar** et action **Ã€ propos**.
* `AboutScreen` avec **Back**.
* `strings.xml` mis Ã  jour.

---

## âœ… DoD â€” Definition of Done

* [ ] Navigation **fonctionnelle** (List â†” About).
* [ ] **Back** opÃ©rationnel (`navigateUp`).
* [ ] **Ã‰tat** de la Liste conservÃ©.
* [ ] Pas dâ€™instances dupliquÃ©es dâ€™About (utilisation de `launchSingleTop`).

---

## âš¡ Cheatsheet

```kotlin
// Routes
sealed class Route(val path: String) { data object List: Route("list"); data object About: Route("about") }

// NavHost
val nav = rememberNavController()
NavHost(nav, startDestination = Route.List.path) {
  composable(Route.List.path) { ListScreen(onOpenAbout = { nav.navigate(Route.About.path) { launchSingleTop = true } }) }
  composable(Route.About.path) { AboutScreen(onBack = { nav.navigateUp() }) }
}

// AppBar actions
IconButton(onClick = onOpenAbout) { Icon(Icons.Default.Info, contentDescription = stringResource(R.string.cd_about)) }
```
