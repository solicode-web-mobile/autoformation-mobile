---
title: 1. Organisation de tests
permalink: /tests-laravel/organisation-tests/
layout: home
nav_order: 1
parent: 6.1.Tests unitaires & d’intégration
---

# 📘 Chapitre 6.1.1 — Organisation de `tests/`

## 📒 Glossaire minute
- **Pest** : surcouche légère à PHPUnit, **syntaxe expressive** (style BDD), plugins Laravel.
- **PHPUnit** : framework de tests **historique**, classes `TestCase`, méthodes `assert*`.
- **Fixture** : données/état de test préparés avant l’exécution.
- **AAA** : *Arrange → Act → Assert* (préparer, agir, vérifier).

---

## 🎯 Objectif
Savoir **lancer** la suite de tests Laravel, comprendre la **structure** du dossier `tests/` et choisir entre **Pest** et **PHPUnit** (ou les mélanger) selon le contexte.

---

## ✅ Pré-requis
- Projet **Laravel** fonctionnel (≥ 10.x/11.x).
- PHP et Composer installés.
- Base de données accessible (les tests DB seront abordés au chap. 6.1.4).

---

## 1) Arborescence standard de `tests/`

```

tests/
├── Feature/            # Tests proches du framework (HTTP, vues, policies, API…)
│   └── ExampleTest.php
├── Unit/               # Tests de logique pure (services, helpers, value objects…)
│   └── ExampleTest.php
├── CreatesApplication.php  # Bootstrap de l’app pour les tests (Laravel)
├── TestCase.php            # Classe de base (PHPUnit) / helpers communs
└── PEST\_\*.php (optionnel)  # Fichiers Pest globaux (ex: PEST.php)

````

> **Règle d’or** :  
> - **Unit** = tests **rapides** et **isolés** (sans I/O).  
> - **Feature** = tests **intégrés** à Laravel (routes, middleware, DB, etc.).

---

## 2) Installer/activer Pest (si besoin)

> Beaucoup de projets Laravel récents sont déjà configurés avec **Pest**.  
> Si ce n’est pas votre cas :

```bash
composer require --dev pestphp/pest pestphp/pest-plugin-laravel
php artisan pest:install
````

Ce qui ajoute :

* des **stubs** Pest (`tests/Feature/ExampleTest.php` en style Pest),
* un fichier `Pest.php` (helpers globaux).

> Vous pouvez **coexister** Pest et PHPUnit : un fichier de test Pest **ou** une classe PHPUnit, dans le même projet.

---

## 3) Première exécution de la suite

### Commande générique (recommandée)

```bash
php artisan test
```

* Détecte Pest si présent, sinon exécute PHPUnit.
* Colorise et montre un résumé (durée, assertions, tests passés/échoués).

### Commandes directes

```bash
# Exécuter Pest explicitement
vendor/bin/pest

# Exécuter PHPUnit explicitement
vendor/bin/phpunit
```

### Cibler un sous-dossier/fichier/test

```bash
php artisan test tests/Feature
php artisan test tests/Feature/ExampleTest.php
php artisan test --filter="peut_creer_un_article"
```

---

## 4) Pest vs PHPUnit — en un coup d’œil

| Critère             | Pest (sur PHPUnit)                  | PHPUnit (pur)                        |
| ------------------- | ----------------------------------- | ------------------------------------ |
| **Style**           | Fonctions globales `test()`, `it()` | Classes `*Test` + méthodes `test*()` |
| **Lisibilité**      | Très concis, fluide                 | Verbeux mais explicite               |
| **Plugins Laravel** | Oui (helpers dédiés)                | N/A (mais helpers Laravel natifs)    |
| **Migration**       | Facile (coexistence)                | Standard historique                  |
| **Apprentissage**   | Rapide (syntaxe naturelle)          | Connaître le cycle de vie PHPUnit    |

**Conclusion** : Prenez **Pest** par défaut pour sa **clarté**. Gardez **PHPUnit** quand vous préférez les **classes** ou pour compatibilité.

---

## 5) Premier test — exemples minimaux

### 5.1 Avec **Pest** (fonctionnel, concis)

```php
<?php // tests/Unit/ExampleTest.php

test('les maths fonctionnent', function () {
    // Arrange
    $a = 2; $b = 3;

    // Act
    $sum = $a + $b;

    // Assert
    expect($sum)->toBeInt()->toBe(5);
});
```

### 5.2 Avec **PHPUnit** (classe `TestCase`)

```php
<?php // tests/Unit/ExampleTest.php

use Tests\TestCase;

class ExampleTest extends TestCase
{
    public function test_les_maths_fonctionnent(): void
    {
        // Arrange
        $a = 2; $b = 3;

        // Act
        $sum = $a + $b;

        // Assert
        $this->assertIsInt($sum);
        $this->assertEquals(5, $sum);
    }
}
```

---

## 6) Exemple Feature (HTTP) rapide

### Version **Pest**

```php
<?php // tests/Feature/HomepageTest.php

it('affiche la page d’accueil', function () {
    $response = $this->get('/');
    $response->assertStatus(200);
    // $response->assertSee('Bienvenue'); // si votre vue contient ce texte
});
```

### Version **PHPUnit**

```php
<?php // tests/Feature/HomepageTest.php

use Tests\TestCase;

class HomepageTest extends TestCase
{
    public function test_affiche_la_page_accueil(): void
    {
        $response = $this->get('/');
        $response->assertStatus(200);
    }
}
```

---

## 7) Organisation & conventions recommandées

* **Nommer** clairement : `tests/Feature/Article/CreateArticleTest.php`, `tests/Unit/Slug/SluggerTest.php`.
* **Un test = un comportement** (nom précis) : `it('publishes a draft')`.
* **AAA** : séparer visuellement *Arrange/Act/Assert*.
* **Isolation** : pas d’effets de bord entre tests (fixtures dédiées, DB reset — voir 6.1.4).
* **Vitesse** : **Unit** sans I/O ; **Feature** pour les scénarios intégrés.

---

## 8) Commandes utiles (cheatsheet)

```bash
# Lancer toute la suite
php artisan test

# Lancer en “verbose”
php artisan test -v

# Lancer un dossier/fichier précis
php artisan test tests/Feature

# Filtrer par nom
php artisan test --filter "publie_un_article"

# Couverture (si Xdebug/PCOV installé)
vendor/bin/pest --coverage
vendor/bin/phpunit --coverage-text
```

---

## 🩹 Dépannage

* **“Class TestCase not found”**
  → Vérifier `use Tests\TestCase;` **et** le namespace en tête de fichier.
* **“No tests executed”**
  → Le fichier ne correspond pas au **pattern** (`*Test.php`) ou la fonction Pest n’est pas `test()`/`it()`.
* **Pest non détecté**
  → Vérifier `composer.json` (dev-deps) et relancer `composer dump-autoload`.
* **Couverture absente**
  → Installer/activer **Xdebug** ou **pcov**.

---

## ✅ Check-list (DoD)

* [ ] `php artisan test` s’exécute avec au moins **1 test passant**.
* [ ] Dossier `tests/` structuré (**Unit** vs **Feature**).
* [ ] Compréhension des **différences Pest/PHPUnit**.
* [ ] Nom des fichiers/tests **explicite** (comportement testé).

---

## 📦 Livrables attendus

* Un **screenshot** de l’exécution `php artisan test` (succès).
* 1 test **Unit** et 1 test **Feature** (au choix Pest **ou** PHPUnit), dans les bons dossiers.

