---
title: 1. Organisation de tests
permalink: /tests-laravel/organisation-tests/
layout: home
nav_order: 1
parent: 6.1.Tests unitaires & dâ€™intÃ©gration
---

# ğŸ“˜ Chapitre 6.1.1 â€” Organisation de `tests/`

## ğŸ“’ Glossaire minute
- **Pest** : surcouche lÃ©gÃ¨re Ã  PHPUnit, **syntaxe expressive** (style BDD), plugins Laravel.
- **PHPUnit** : framework de tests **historique**, classes `TestCase`, mÃ©thodes `assert*`.
- **Fixture** : donnÃ©es/Ã©tat de test prÃ©parÃ©s avant lâ€™exÃ©cution.
- **AAA** : *Arrange â†’ Act â†’ Assert* (prÃ©parer, agir, vÃ©rifier).

---

## ğŸ¯ Objectif
Savoir **lancer** la suite de tests Laravel, comprendre la **structure** du dossier `tests/` et choisir entre **Pest** et **PHPUnit** (ou les mÃ©langer) selon le contexte.

---

## âœ… PrÃ©-requis
- Projet **Laravel** fonctionnel (â‰¥ 10.x/11.x).
- PHP et Composer installÃ©s.
- Base de donnÃ©es accessible (les tests DB seront abordÃ©s au chap. 6.1.4).

---

## 1) Arborescence standard de `tests/`

```

tests/
â”œâ”€â”€ Feature/            # Tests proches du framework (HTTP, vues, policies, APIâ€¦)
â”‚   â””â”€â”€ ExampleTest.php
â”œâ”€â”€ Unit/               # Tests de logique pure (services, helpers, value objectsâ€¦)
â”‚   â””â”€â”€ ExampleTest.php
â”œâ”€â”€ CreatesApplication.php  # Bootstrap de lâ€™app pour les tests (Laravel)
â”œâ”€â”€ TestCase.php            # Classe de base (PHPUnit) / helpers communs
â””â”€â”€ PEST\_\*.php (optionnel)  # Fichiers Pest globaux (ex: PEST.php)

````

> **RÃ¨gle dâ€™or** :  
> - **Unit** = tests **rapides** et **isolÃ©s** (sans I/O).  
> - **Feature** = tests **intÃ©grÃ©s** Ã  Laravel (routes, middleware, DB, etc.).

---

## 2) Installer/activer Pest (si besoin)

> Beaucoup de projets Laravel rÃ©cents sont dÃ©jÃ  configurÃ©s avec **Pest**.  
> Si ce nâ€™est pas votre cas :

```bash
composer require --dev pestphp/pest pestphp/pest-plugin-laravel
php artisan pest:install
````

Ce qui ajoute :

* des **stubs** Pest (`tests/Feature/ExampleTest.php` en style Pest),
* un fichier `Pest.php` (helpers globaux).

> Vous pouvez **coexister** Pest et PHPUnit : un fichier de test Pest **ou** une classe PHPUnit, dans le mÃªme projet.

---

## 3) PremiÃ¨re exÃ©cution de la suite

### Commande gÃ©nÃ©rique (recommandÃ©e)

```bash
php artisan test
```

* DÃ©tecte Pest si prÃ©sent, sinon exÃ©cute PHPUnit.
* Colorise et montre un rÃ©sumÃ© (durÃ©e, assertions, tests passÃ©s/Ã©chouÃ©s).

### Commandes directes

```bash
# ExÃ©cuter Pest explicitement
vendor/bin/pest

# ExÃ©cuter PHPUnit explicitement
vendor/bin/phpunit
```

### Cibler un sous-dossier/fichier/test

```bash
php artisan test tests/Feature
php artisan test tests/Feature/ExampleTest.php
php artisan test --filter="peut_creer_un_article"
```

---

## 4) Pest vs PHPUnit â€” en un coup dâ€™Å“il

| CritÃ¨re             | Pest (sur PHPUnit)                  | PHPUnit (pur)                        |
| ------------------- | ----------------------------------- | ------------------------------------ |
| **Style**           | Fonctions globales `test()`, `it()` | Classes `*Test` + mÃ©thodes `test*()` |
| **LisibilitÃ©**      | TrÃ¨s concis, fluide                 | Verbeux mais explicite               |
| **Plugins Laravel** | Oui (helpers dÃ©diÃ©s)                | N/A (mais helpers Laravel natifs)    |
| **Migration**       | Facile (coexistence)                | Standard historique                  |
| **Apprentissage**   | Rapide (syntaxe naturelle)          | ConnaÃ®tre le cycle de vie PHPUnit    |

**Conclusion** : Prenez **Pest** par dÃ©faut pour sa **clartÃ©**. Gardez **PHPUnit** quand vous prÃ©fÃ©rez les **classes** ou pour compatibilitÃ©.

---

## 5) Premier test â€” exemples minimaux

### 5.1 Avec **Pest** (fonctionnel, concis)

```php
<?php // tests/Unit/ExampleTest.php

test('les maths fonctionnent', function () {
    // Arrange
    $a = 2; $b = 3;

    // Act
    $sum = $a + $b;

    // Assert
    expect($sum)->toBeInt()->toBe(5);
});
```

### 5.2 Avec **PHPUnit** (classe `TestCase`)

```php
<?php // tests/Unit/ExampleTest.php

use Tests\TestCase;

class ExampleTest extends TestCase
{
    public function test_les_maths_fonctionnent(): void
    {
        // Arrange
        $a = 2; $b = 3;

        // Act
        $sum = $a + $b;

        // Assert
        $this->assertIsInt($sum);
        $this->assertEquals(5, $sum);
    }
}
```

---

## 6) Exemple Feature (HTTP) rapide

### Version **Pest**

```php
<?php // tests/Feature/HomepageTest.php

it('affiche la page dâ€™accueil', function () {
    $response = $this->get('/');
    $response->assertStatus(200);
    // $response->assertSee('Bienvenue'); // si votre vue contient ce texte
});
```

### Version **PHPUnit**

```php
<?php // tests/Feature/HomepageTest.php

use Tests\TestCase;

class HomepageTest extends TestCase
{
    public function test_affiche_la_page_accueil(): void
    {
        $response = $this->get('/');
        $response->assertStatus(200);
    }
}
```

---

## 7) Organisation & conventions recommandÃ©es

* **Nommer** clairement : `tests/Feature/Article/CreateArticleTest.php`, `tests/Unit/Slug/SluggerTest.php`.
* **Un test = un comportement** (nom prÃ©cis) : `it('publishes a draft')`.
* **AAA** : sÃ©parer visuellement *Arrange/Act/Assert*.
* **Isolation** : pas dâ€™effets de bord entre tests (fixtures dÃ©diÃ©es, DB reset â€” voir 6.1.4).
* **Vitesse** : **Unit** sans I/O ; **Feature** pour les scÃ©narios intÃ©grÃ©s.

---

## 8) Commandes utiles (cheatsheet)

```bash
# Lancer toute la suite
php artisan test

# Lancer en â€œverboseâ€
php artisan test -v

# Lancer un dossier/fichier prÃ©cis
php artisan test tests/Feature

# Filtrer par nom
php artisan test --filter "publie_un_article"

# Couverture (si Xdebug/PCOV installÃ©)
vendor/bin/pest --coverage
vendor/bin/phpunit --coverage-text
```

---

## ğŸ©¹ DÃ©pannage

* **â€œClass TestCase not foundâ€**
  â†’ VÃ©rifier `use Tests\TestCase;` **et** le namespace en tÃªte de fichier.
* **â€œNo tests executedâ€**
  â†’ Le fichier ne correspond pas au **pattern** (`*Test.php`) ou la fonction Pest nâ€™est pas `test()`/`it()`.
* **Pest non dÃ©tectÃ©**
  â†’ VÃ©rifier `composer.json` (dev-deps) et relancer `composer dump-autoload`.
* **Couverture absente**
  â†’ Installer/activer **Xdebug** ou **pcov**.

---

## âœ… Check-list (DoD)

* [ ] `php artisan test` sâ€™exÃ©cute avec au moins **1 test passant**.
* [ ] Dossier `tests/` structurÃ© (**Unit** vs **Feature**).
* [ ] ComprÃ©hension des **diffÃ©rences Pest/PHPUnit**.
* [ ] Nom des fichiers/tests **explicite** (comportement testÃ©).

---

## ğŸ“¦ Livrables attendus

* Un **screenshot** de lâ€™exÃ©cution `php artisan test` (succÃ¨s).
* 1 test **Unit** et 1 test **Feature** (au choix Pest **ou** PHPUnit), dans les bons dossiers.

