---
title: 2. Convention AAA
permalink: /tests-laravel/aaa-assertions/
layout: home
nav_order: 2
parent: 6.1.Tests unitaires & dâ€™intÃ©gration
---

# ğŸ“˜ Chapitre 6.1.2 â€” Convention **AAA** 

## ğŸ“’ Glossaire minute
- **AAA** : *Arrange* (prÃ©parer) â†’ *Act* (agir) â†’ *Assert* (vÃ©rifier).
- **SUT** (*System Under Test*) : la fonction/service que lâ€™on teste.
- **Assertion** : vÃ©rification dâ€™un rÃ©sultat attendu (`assert*`, `expect()`).
- **Oracles** : valeurs/rÃ¨gles servant de rÃ©fÃ©rence (ex. JSON attendu).

---

## ğŸ¯ Objectif
Savoir **structurer** chaque test en trois temps **AAA** et utiliser les **assertions clÃ©s** :
`assertTrue`, `assertEquals` et **assertions JSON** pour les rÃ©ponses HTTP Laravel.

---

## 1) AAA appliquÃ© Ã  un test **unitaire** (fonction pure)

### âœ¨ Version Pest
```php
<?php // tests/Unit/SluggerTest.php

use Illuminate\Support\Str;

test('slugger transforme un titre en slug', function () {
    // Arrange
    $title = 'Bonjour le Monde !';
    $expected = 'bonjour-le-monde';

    // Act
    $slug = Str::slug($title);

    // Assert
    expect($slug)->toEqual($expected);   // Ã©quivalent Ã  assertEquals
    expect(Str::startsWith($slug, 'bonjour'))->toBeTrue(); // assertTrue
});
````

### ğŸ§ª Version PHPUnit

```php
<?php // tests/Unit/SluggerTest.php

use Illuminate\Support\Str;
use Tests\TestCase;

class SluggerTest extends TestCase
{
    public function test_slugger_transforme_un_titre_en_slug(): void
    {
        // Arrange
        $title = 'Bonjour le Monde !';
        $expected = 'bonjour-le-monde';

        // Act
        $slug = Str::slug($title);

        // Assert
        $this->assertEquals($expected, $slug);
        $this->assertTrue(Str::startsWith($slug, 'bonjour'));
    }
}
```

> **Conseil** : Une **action** principale par test. Si plusieurs asserts, quâ€™ils valident **la mÃªme idÃ©e** (pas 3 sujets diffÃ©rents).

---

## 2) AAA sur un test **Feature HTTP** (JSON dâ€™API)

### âœ¨ Pest + assertions JSON Laravel

```php
<?php // tests/Feature/ArticleIndexTest.php

use Illuminate\Testing\Fluent\AssertableJson;

it('retourne la liste paginÃ©e des articles au format JSON', function () {
    // Arrange
    $articles = \App\Models\Article::factory()->count(2)->create();

    // Act
    $response = $this->getJson('/api/articles');

    // Assert
    $response->assertStatus(200)
        ->assertJson(fn (AssertableJson $json) =>
            $json->has('data', 2)
                 ->has('meta.current_page')
                 ->where('data.0.id', $articles[0]->id)
                 ->where('data.1.title', $articles[1]->title)
                 ->etc()
        )
        ->assertJsonFragment([
            'id' => $articles[0]->id,
        ]); // vÃ©rifie la prÃ©sence dâ€™un fragment JSON
});
```

### ğŸ§ª PHPUnit Ã©quivalent

```php
<?php // tests/Feature/ArticleIndexTest.php

use Illuminate\Testing\Fluent\AssertableJson;
use Tests\TestCase;

class ArticleIndexTest extends TestCase
{
    public function test_retourne_la_liste_paginee_des_articles_en_json(): void
    {
        // Arrange
        $articles = \App\Models\Article::factory()->count(2)->create();

        // Act
        $response = $this->getJson('/api/articles');

        // Assert
        $response->assertStatus(200);
        $response->assertJson(fn (AssertableJson $json) =>
            $json->has('data', 2)
                 ->has('meta.current_page')
                 ->where('data.0.id', $articles[0]->id)
                 ->where('data.1.title', $articles[1]->title)
                 ->etc()
        );
        $response->assertJsonFragment(['id' => $articles[0]->id]);
    }
}
```

> **Rappels utiles** :
>
> * `assertJsonPath('data.0.title', '...')` pour une valeur prÃ©cise.
> * `assertExactJson([...])` si le **JSON complet** doit correspondre (strict).
> * `assertJsonMissing([...])` pour sâ€™assurer quâ€™un fragment **nâ€™existe pas**.

---

## 3) **Datasets** (Pest) pour couvrir des cas rapidement

```php
<?php // tests/Unit/PasswordStrengthTest.php

dataset('passwords', [
    ['Abcdef12', true],
    ['short1',   false],
    ['NOLOWER12', false],
]);

test('vÃ©rifie la robustesse du mot de passe', function (string $pwd, bool $expected) {
    // Arrange
    $isStrong = fn (string $p) =>
        strlen($p) >= 8
        && preg_match('/[a-z]/', $p)
        && preg_match('/[A-Z]/', $p)
        && preg_match('/\d/', $p);

    // Act
    $result = $isStrong($pwd);

    // Assert
    expect($result)->toBe($expected); // assertTrue/False implicites
})->with('passwords');
```

---

## 4) **Cheatsheet** dâ€™assertions courantes

### âœ… Valeurs / types

* **Pest** : `expect($x)->toBeTrue()`, `toBeFalse()`, `toEqual($y)`, `toBe($y)` (strict), `toBeNull()`, `toContain('a')`.
* **PHPUnit** : `$this->assertTrue($x)`, `assertFalse`, `assertEquals($y, $x)`, `assertSame($y, $x)`, `assertNull($x)`, `assertContains()`.

### âœ… HTTP / JSON (Laravel)

* `assertStatus(200)`, `assertOk()`, `assertCreated()`.
* `assertJson([...])`, `assertExactJson([...])`, `assertJsonFragment([...])`.
* `assertJsonPath('data.0.id', 123)`, `assertJsonMissing([...])`.
* `assertSee('texte')`, `assertViewHas('var')` (pour routes **web**).

---

## 5) Patron AAA (gabarit Ã  copier)

```php
<?php
test('comportement clair Ã  dÃ©crire', function () {
    // Arrange
    // ... Ã©tat / donnÃ©es dâ€™entrÃ©e

    // Act
    // ... action sur le SUT (une seule principale)

    // Assert
    // ... assertions ciblÃ©es sur CE comportement
});
```

---

## âœ… Check-list (DoD)

* [ ] Chaque test est organisÃ© en **Arrange / Act / Assert** (commentaires ou blocs).
* [ ] Les assertions valident **un seul comportement** par test.
* [ ] Usage correct de `assertTrue`, `assertEquals` et des **assertions JSON**.
* [ ] Noms **explicites** : dÃ©crire le **comportement** (pas lâ€™implÃ©mentation).

---

## ğŸ©¹ DÃ©pannage

* **â€œNo tests executedâ€** : nom de fichier invalide (`*Test.php`) ou fonction Pest non `test()/it()`.
* **JSON fragile** : prÃ©fÃ©rez `assertJsonFragment`/`assertJsonPath` plutÃ´t que `assertExactJson`.
* **Tests lents** : ce sont probablement des tests **Feature**. DÃ©placer la logique pure en **Unit**.

---

## ğŸ§ª Exercices

1. Ã‰crire un test **unitaire** AAA pour une fonction `sum(int...$n)` avec `assertEquals`.
2. Ã‰crire un test **Feature** AAA pour `POST /api/articles` avec `assertStatus(201)` et `assertJsonFragment(['title' => '...'])`.
3. Convertir un test PHPUnit existant en **Pest** (mÃªmes Arrange/Act/Assert).

